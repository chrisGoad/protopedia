
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="description" content="A prototype-oriented object model for infographics, with inspector">
<title>OpenChart</title>/
<link rel="stylesheet" type="text/css"  href="https://s3.amazonaws.com/openchart.net/style.css"/>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
</head>
<body style="margin:0px;overflow:hidden;">
<script src="https://s3.amazonaws.com/openchart.net/djs/topbar-0.9.3.js"></script>

<!--<script src="http://s3.amazonaws.com/prototypejungle.org/js/pjui-0.9.3.min.js"></script>
<script src="http://s3.amazonaws.com/prototypejungle.org/js/pjpage-0.9.3.min.js"></script>
<script>
pj.ui.checkBrowser();
</script>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="http://prototypejungle.org/js/color_picker.js"></script>
<script src="http://cdn.jsdelivr.net/ace/1.1.7/min/ace.js" type="text/javascript" charset="utf-8"></script>
-->
<script>

(function () {
var parseQueryString = function(){
  var nvpair = {};
  var qs = window.location.search.replace('?', '');
  var pairs = qs.split('&');
  pairs.forEach(function(v){
    var pair = v.split('=');
    if (pair.length>1) {
      nvpair[pair[0]] = pair[1];
    }
  });
  return nvpair;
}

var qs = parseQueryString();
var user = qs.user;
if (0 && !user) {
  location.href = "/sign_in.html"
}
var checkName = function (string) {
  if (string==='') return false;
  return !!string.match(/^(?:|_|[a-z]|[A-Z])(?:\w|-)*$/)
}
/*
var ready = function (fn) {
  if (document.readyState != 'loading'){
    fn();
  } else {
    document.addEventListener('DOMContentLoaded', fn);
  }
}
*/
var handleInput,okButton,errorMsg;
var displayError = function (msg) {
  errorMsg.innerHTML = msg;
}
var submitHandle =   function () {
  var handle = handleInput.value;
  if (handle === '') {
    displayError('No handle entered');
    return;
  }
  if (!checkName(handle)) {
    displayError("Handles may contain only numerals and letters");
    return;
  }
  //alert(handleInput.value);
  $.ajax({url:'https://prototype-jungle.org/api/setHandle',data:handle,cache:false,
         contentType:"text/plain",type:"POST",dataType:"text",
       success:function (irs) {debugger;
         var rs = JSON.parse(irs);
         if (rs.status === 'ok') {
          var uname = rs.value;
          var dst = 'http://openchart.net/after_sign_in.html?name='+uname;
          location.href = dst;
         } else {
           errorMsg.innerHTML = rs.msg;
         }
       },
       error:function (xhr,status,err) {
          debugger;alert('failure');}}
       );
};

$('document').ready(function () {
  var us = document.getElementById('userspan');
  us.innerHTML = user;
  handleInput = document.getElementById('handleInput');
  okButton = document.getElementById('okButton');
  errorMsg =  document.getElementById('error');
  okButton.addEventListener('click',submitHandle);
  handleInput.addEventListener('keyup', function (event) {
    if (event.keyCode === 13) {
      submitHandle();
    }
  });
  prototypeJungle.ui.standaloneInit();

   
});

})();


</script>
 

<div id="outerContainer"> 
  <div id="topbar"> 
    <div id="topbarOuter">
      <div id="title" style="display:inline-block">
        <div class="mainTitle">OpenChart</div>
      </div>
      <div id = "topbarInner" style="float:right"></div>
      <div id ="worker" style="position:absolute;left:180px;top:4px">
        <iframe style="border-width:0px;background-color:transparent" id="workerIframe" width="10" height="10"></iframe>
      </div>
    </div>
  </div>
  <div style="padding-top:40px" id="innerContainer">
     <p> Please select your handle:  (your items will appear under http://prototypejungle.org/<span id="userspan">item</span>/<i>handle</i>/)</p>
     <br/>
      <input id="handleInput" type="text" style="margin-left:20px;width:400px"/>
      <br/>
      <div class="button" style="margin-left:20px;margin-top:20px" id="okButton">Ok</div>
       <div style="color:red" id="error"></div>

  </div>
  <!--<div id="results"></div>-->
</div>





</body>
</html>
