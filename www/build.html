<head>
<title>Prototype Jungle</title>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<link rel="stylesheet" type="text/css"  href="/style.css"> 
</head>
<body style="background-color:#eeeeee">

  
<script src="/js/pj.js"></script>

<script src="/js/util.js"></script>

<script src="/js/om.js"></script>
<script src="/js/instantiate.js"></script>
<script src="/js/externalize.js"></script>
<script src="/js/jquery.js"></script>
<script src="/js/jqprotos.js"></script>

<script src="/js/geom.js"></script>
<script src="/js/draw.js"></script>
<script src="/js/shapes.js"></script>
<script src="/js/page.js"></script>

<script src="/js/error.js"></script>

<script>
    
var cb;

(function (){
 
  var om = __pj__.om;
  var draw = __pj__.draw;
  var page = __pj__.page
  
  page.elementsToHideOnError = [];

function buildError(url) {
  if (!buildDone) {
   __pj__.page.genError("<span style='color:red'>Error</span>: the build from <a href='"+url+"'>"+url+"</a> failed, either because the file is missing, or because there was a JavaScript error.");
  }
}

var buildTimeout = 4000;
var buildDone;
  
  function doTheBuild(url,prefix) {
    $('#mainDiv').hide(400);
    var handle = localStorage.handle;
     buildDone = false;
    setTimeout(function () {buildError(url);} ,buildTimeout);
    om.customSave = function (built,local) {
      buildDone = true;
      built.__source__ = url;
      var whenSaved = function (nm,dord) {
        var rs = $('#results');
        rs.empty();
        if (nm=='busy') {
          rs.append('<p>The site is too busy to do the build. Please try again later.</p>');
        } else {
          rs.append(om.mkCapLink('The build file:',url));
          rs.append(om.mkLinks(nm,dord));
        }
      }
      if (local) {
        om.save(built,prefix,whenSaved);
      } else {
        om.s3Save(built,prefix,whenSaved,false);  // no need to remove computed
      }
    }
    om.buildDest = "http://s3.prototypejungle.org/testRebuild";
    om.getScript(url);
  }
  
  $('document').ready(function () {
    page.genTopbar($('#topbar'),{includeTitle:1});
    var handle = localStorage.handle;
    $('#prefixAdvice').html(
        "Destination prefix (the result will be placed under http://s3.prototypejungle.org/<b>"+
        handle+"</b>/prefix/) :"
    );
    $('#buildButton').click(function () {
      var vl = $('#buildInput').attr('value');
      var pfx = $('#prefixInput').attr('value');
      if (vl) {
        $('#examples').hide();
        page.elementsToHideOnError.push($('#mainDiv'));
        doTheBuild(vl,pfx);
      }
    });
    $('#exampleButton').click(function () {
      $('#examples').show();
    
    });
    var exdir =  'http://'+(location.host)+'/gen/examples/';
    var examples = ['twoRectangles.js','nestedArcs.js','twoNestedArcs.js'];
    var inp = $('#buildInput');
    var exdiv = $('#examples');
    function genExample(n) {
      var exn = examples[n];
      var ed = $('<div class="example">'+exn+'</div>');
      exdiv.append(ed);
      ed.click(function () {
        inp.attr('value',exdir + exn);
      });
    }
    for (var i=0;i<3;i++) genExample(i);
   
    });
   
  
})();
  
  
  

</script>
<div id="outerContainer"> 
  <div id="topbar"></div>
  <div id="error"></div>
  <div id="mainDiv">
    <p> You can write your own JavaScript code to create items to which these tools apply. See the technical documentation. Then use this page
    to perform the builds. </p>
    <p> Source URL for build (anywhere on the web):<br/>
      <input id="buildInput" type="text" style="margin-left:20px;width:400px"></input>
   </p>
   <p id="prefixAdvice"> Destination prefix (the result will be placed at http://s3.prototypejungle.org/handle/prefix/path) :<br/>
      <input id="prefixInput" type="text" style="margin-left:20px;width:400px"></input>
   </p>
 <div id="buttons">
        <div class="button" id="buildButton">Perform build</div>
        <div class="button" id="exampleButton">Examples</div>
        <div class="examples" id="examples" style="display:none">
          <div class="examplesTitle">Click on the example of interest (simplest first)</div>
        </div>
    </div>
  </div>
  <div id="results"></div>


<!--
http://prototypejungle.org/gen/examples/twoRectangles.js
-->
</div>
</body>
</html>

    