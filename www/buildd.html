<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Prototype Jungle</title>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<link rel="stylesheet" type="text/css"  href="/style.css">
<script>
if (!Object.create) location.href = "archaicbrowser.html";
</script>
</head>
<body>

<script src="/js/pj.js"></script>

<script src="/js/util.js"></script>

<script src="/js/om.js"></script>
<script src="/js/instantiate.js"></script>
<script src="/js/externalize.js"></script>
<script src="/js/jquery.js"></script>
<script src="/js/jqprotos.js"></script>

<script src="/js/geom.js"></script>
<script src="/js/draw.js"></script>
<script src="/js/shapes.js"></script>
<script src="/js/page.js"></script>

<script src="/js/error.js"></script>

<script>
    
var cb;

(function (){
 
  var om = __pj__.om;
  var draw = __pj__.draw;
  var page = __pj__.page
  
  page.elementsToHideOnError = [];

function buildError(url) {
  if (!buildDone) {
   __pj__.page.genError("<span style='color:red'>Error</span>: the build from <a href='"+url+"'>"+url+"</a> failed, either because the file is missing, or because there was a JavaScript error. JavaScript debuggers are available in all modern browsers.");
  }
}

var buildTimeout = 4000;
var buildDone;
  
  function doTheBuild(url,prefix) {
    if (!om.checkName(prefix)) {
       $('#errorMessage').html("The prefix must be defined, and may contain only numerals, letters, and underbars, and may not start with a numeral.");
       return;
    } else if (prefix=="variant") {
      $('#errorMessage').html('"variant" is reserved, and may not be used as a prefix');
      return;
    } else {
      $('#errorMessage').empty();
    }
    $('#mainDiv').hide();
    localStorage.lastPrefix = prefix;
    localStorage.lastBuildUrl = url;
    var handle = localStorage.handle;
     buildDone = false;
    setTimeout(function () {buildError(url);} ,buildTimeout);
    om.customSave = function (built) {
      var paths = built.computePaths(prefix);
      buildDone = true;
      built.__source__ = url;
      var whenSaved = function (srs) {
        if (srs.status == "fail") {
          if (srs.msg == "busy") {
            emsg = "The server is overloaded just now. Please try again later";
          } else if ((srs.msg=="noSession")||(srs.msg == "timedOut")) {
            var emsg = 'Your session has timed out. Please sign in again.';
            page.logout();
          } else {
            emsg = "unexpected error- "+srs.msg; //should not happen
          }
          page.genError("Error: "+emsg);
          return;
        }
        var dst = "/build_results?source="+url+"&item="+paths.url;
        location.href = dst;
        return;
      }
      built.__origin__ = paths.url;
      om.s3Save(built,paths,whenSaved);
    }
    om.getScript(url);

  }
  
  $('document').ready(function () {
    
    om.checkSession(function (rs) {
        page.genTopbar($('#topbar'),{includeTitle:1,toExclude:'build'});
        var handle = localStorage.handle;
        if (!handle) {
          var nsi = $('#notSignedInDiv');
          nsi.show();
          $('#mainDiv').hide();
          var expaths = om.unpackUrl('http://s3.prototypejungle.org/pj/repo0/examples/TwoR');
          var host = location.host;
          nsi.append(om.mkCapLink('The build file:','http://'+host+'/gen/examples/twoRectangles.js'));
          nsi.append(om.mkLinks(expaths,'built'));
        }
        var lastPrefix = localStorage.lastPrefix;
        if (lastPrefix) {
           $('#prefixInput').prop('value',lastPrefix);
            //code
        }
        var lastBuildUrl = localStorage.lastBuildUrl;
        if (lastBuildUrl) {
           $('#buildInput').prop('value',lastBuildUrl);
            //code
        }
        $('#prefixAdvice').html(
            "Destination prefix (the result will be placed under http://s3.prototypejungle.org/<b>"+
            handle+"</b>/prefix/) :"
        );
        $('#buildButton').click(function () {
          var vl = $('#buildInput').prop('value');
          var pfx = $('#prefixInput').prop('value');
          
          if (vl) {
            $('#examples').hide();
            page.elementsToHideOnError.push($('#mainDiv'));
            doTheBuild(vl,pfx);
          }
        });
        $('#exampleButton').click(function () {
          $('#examples').show();
        
        });
        var exdir =  'http://'+(location.host)+'/gen/examples/';
        var examples = ['twoRectangles.js','nestedArcs.js','twoNestedArcs.js'];
        var inp = $('#buildInput');
        var exdiv = $('#examples');
        function genExample(n) {
          var exn = examples[n];
          var ed = $('<div class="example">'+exn+'</div>');
          exdiv.append(ed);
          ed.click(function () {
            inp.prop('value',exdir + exn);
          });
        }
        for (var i=0;i<3;i++) genExample(i);
       
        });
       
      });
  
})();
  
  
  

</script>
<div id="outerContainer"> 
  <div id="topbar"></div>
  <div id="error"></div>
  <div id="notSignedInDiv" style="display:none">
     <p> You can write your own JavaScript code to create items to which these tools apply. See the
     <a href="/tech.html">technical documentation</a>. Then use this page
    to perform the builds. </p>
     <p>You must be signed in to actually perform builds. Below is the kind of output you would see
     from performing a build</p>
     <hr/>
  </div>
        
  <div id="mainDiv">
    <p> You can write your own JavaScript code to create items to which these tools apply. See the
    <a href="/tech.html">technical documentation</a>. Then use this page
    to perform the builds. </p>
    <p> Source URL for build (anywhere on the web):<br/>
      <input id="buildInput" type="text" style="margin-left:20px;width:400px"/>
   </p>
   <p id="prefixAdvice"> Destination prefix (the result will be placed at http://s3.prototypejungle.org/handle/prefix/path) :</p>
   <p>
      <input id="prefixInput" type="text" style="margin-left:20px;width:200px"/>
   </p>
 <div id="buttons">
        <div class="button" id="buildButton">Perform build</div>
        <div class="button" id="exampleButton">Examples</div>
        <div class="examples" id="examples" style="display:none">
          <div class="examplesTitle">Click on the example of interest (simplest first)</div>
        </div>
    </div>
  </div>
  <div id="errorMessage" style="color:red;padding-top:20px"></div>
  <div id="results"></div>


<!--
http://prototypejungle.org/gen/examples/twoRectangles.js
-->
</div>
</body>
</html>

    