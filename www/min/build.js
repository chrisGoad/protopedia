var __pj__=function(){var t={};if(!Object.create){var e={};return e.om={},e.page={},e}var e=Object.create(t),n=Object.create(t);return n.DNode=t,e.om=n,e.page=Object.create(t),n.storage=localStorage,e}();if(function(t){var e=t.om,n=t.page,r=[],o=e.DNode;e.LNode=r,e.isDev=location.href.indexOf(":8000")>0,e.mapUrlToDev=function(t){return e.isDev&&0==t.indexOf("http://prototypejungle.org/")?"http://prototypejungle.org:8000"+t.substr(26):t},e.__parent__=t,e.__name__="om",o.__parent__=e,o.__name__="DNode",r.__parent__=e,r.__name__="LNode",n.__parent__=t,n.__name__="page",e.activeConsoleTags=["error"],e.itemHost="http://s3.prototypejungle.org",e.argsToString=function(t){if("undefined"==typeof console)return"";for(var e=[],n=t.length,r=0;n>r;r++)e.push(t[r]);return e.join(", ")},e.slog1=function(t){"undefined"!=typeof console&&console.log("SLOG1",t)},e.slog=function(){var t=e.argsToString(arguments);e.slog1(t)},e.startTime=Date.now()/1e3,e.resetClock=function(){e.startTime=Date.now()/1e3},e.elapsedTime=function(){var t=Date.now()/1e3,n=t-e.startTime;return Math.round(1e3*n)/1e3},e.tlog=function(){if("undefined"!=typeof console){for(var t=[],n=Date.now()/1e3,r=n-e.startTime,o=arguments.length,i=0;o>i;i++)t.push(arguments[i]);r=Math.round(1e3*r)/1e3;var a="AT "+r+": "+t.join(", ");console.log(a)}},e.log=function(t){if("undefined"!=typeof console&&($.inArray("all",e.activeConsoleTags)>=0||$.inArray(t,e.activeConsoleTags)>=0))if("undefined"==typeof window)system.stdout(t+JSON.stringify(arguments));else{for(var n=[],r=arguments.length,o=0;r>o;o++)n.push(arguments[o]);console.log(t,n.join(", "))}},e.error=function(){for(var t=[],e=arguments.length,n=0;e>n;n++)t.push(arguments[n]);throw console.log(t.join(", ")),"error"},e.ajaxPost=function(t,n,r,o){if("string"==typeof n)a=n;else{var i=e.storage.sessionId;i&&(n.sessionId=i,n.userName=e.storage.userName);var a=JSON.stringify(n)}o||(o=function(t,e){alert("ERROR (INTERNAL) IN POST "+e)}),$.ajax({url:t,data:a,cache:!1,contentType:"application/json",type:"POST",dataType:"json",success:r,error:o})},e.ajaxGet=function(t,e,n){var r={url:t,cache:!1,contentType:"application/json",type:"GET",dataType:"json",success:e};n&&(r.error=n),r.error=function(t,e){alert("ERROR (INTERNAL) IN get "+e)},$.ajax(r)},e.runCallbacks=function(t){if(void 0!=t){var n=arguments,r=[],o=n.length;for(i=1;o>i;i++)r.push(n[i]);e.arrayForEach(t,function(t){t.apply(void 0,r)})}},e.pathLast=function(t){if("string"==typeof t){var e=t.lastIndexOf("/");return t.substr(e+1)}return t[t.length-1]},e.pathExceptLast=function(t){if("string"==typeof t){var e=t.lastIndexOf("/");return t.substr(0,e+1)}var n=t.concat();return n.pop(),n},e.toInt=function(t){var e=parseFloat(t);return 0==e%1?e:void 0},e.removeFromArray=function(t,e){var n=[];return t.forEach(function(t){t!=e&&n.push(t)}),n},e.getScript=function(t,n){e.log("util","About to load ",t),$.ajax({crossDomain:!0,dataType:"script",url:t,success:function(){e.log("util","loaded ",t),n&&n()}})},e.parseQuerystring=function(){var t={},e=window.location.search.replace("?",""),n=e.split("&");return $.each(n,function(e,n){var r=n.split("=");r.length>1&&(t[r[0]]=r[1])}),t},e.nDigits=function(t,e){if("number"!=typeof t)return t;var n=String(t),r=n.indexOf(".");if(0>r)return n;var o=n.length;if(e>=o-r-1)return n;var i=n.substring(0,r),a=n.substring(r+1,r+e+1);return i+"."+a},e.toType=function(t){return{}.toString.call(t).match(/\s([a-zA-Z]+)/)[1].toLowerCase()},e.mkLink=function(t){return'<a href="'+t+'">'+t+"</a>"},e.mkCapLink=function(t,n){return"<div class='linkLine'><div class='caption'>"+t+"</div>"+e.mkLink(n)+"</div>"},e.mkEmbed=function(t){return'&lt;iframe width="500" height="500" src="'+t+'"&gt;\n '},e.mkLinks=function(t,n){var r=t.repo;e.itemHost;var o=e.itemHost+r,i=o+t.code,a=o+t.data,s=t.url,c=location.host,u="http://"+c+"/inspect?item="+s,h=s,f="<div class='links'>";return f+=e.mkCapLink("To inspect the item you just "+n+":",u),f+=e.mkCapLink("To view the item you just "+n+" (Developers: use this in code depdendencies too):",h),f+="<div class='embed'>",f+="<p>To embed the item you just "+n+":</p>",f+=e.mkEmbed(s),f+="<p>(adjust width and height to taste)</p>",f+="</div>",f+=e.mkCapLink("The JSON that describes the structure of this item:",a),f+=e.mkCapLink("The JavaScript functions associated with this item:",i)},e.check=function(t,e,n){var r=n(t);return void 0===r?{error:1,message:"<center><span class='errorTitle'>Error</span>: "+e+"</center>"}:r},e.checkNumber=function(t){return e.check(t,"expected number.",function(e){return isNaN(e)?void 0:parseFloat(t)})},e.checkInteger=function(t){return e.check(t,"expected integer.",function(e){if(isNaN(e))return void 0;var n=parseFloat(t);return 0==n%1?n:void 0})},e.checkPositiveInteger=function(t){return e.check(t,"expected positive integer.",function(e){if(isNaN(e))return void 0;var n=parseFloat(t);return n>0&&0==n%1?n:void 0})},e.checkPositiveNumber=function(t){return e.check(t,"expected positive number.",function(e){if(isNaN(e))return void 0;var n=parseFloat(t);return n>0?n:void 0})},e.checkNonNegative=function(t){return e.check(t,"expected non-negative number.",function(e){if(isNaN(e))return void 0;var n=parseFloat(t);return n>=0?n:void 0})},e.checkBoolean=function(t){return e.check(t,"No failure possible",function(t){if("false"==t)var e=0;else e=t?1:0;return e})},e.toBooleanOut=function(t){return t?"true":"false"},e.DNode.booleanField=function(t){this.setInputF(t,e,"checkBoolean"),this.setOutputF(t,e,"toBooleanOut")};var a={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};e.escapeHtml=function(t){return String(t).replace(/[&<>"'\/]/g,function(t){return a[t]})},e.afterChar=function(t,e){var n=t.indexOf(e);return 0>n?t:t.substr(n+1)},e.beforeChar=function(t,e){var n=t.indexOf(e);return 0>n?t:t.substr(0,n)},e.endsIn=function(t,e){var n=t.length,r=e.length;if(r>n)return!1;var o=t.substr(n-r);return o==e},e.mainName=function(t){var n=e.beforeChar(t,"_"),r=e.afterChar(t,"_");return"persona"==n?e.beforeChar(r,"@"):r},e.checkName=function(t){return""==t?!1:!!t.match(/^(?:|_|[a-z]|[A-Z])(?:\w|-)*$/)},e.checkPathName=function(t){var e=t.split("/"),n=e.length;if(0==n)return!1;for(var r=0;n>r;r++)if(!checkName(e[r]))return!1;return!0},e.setOnEnter=function(t,e){t.keyup(function(t){13==t.keyCode&&e(t)})},e.disableBackspace=function(){var t=/INPUT|SELECT|TEXTAREA/i;$(document).bind("keydown keypress",function(e){8==e.which&&(!t.test(e.target.tagName)||e.target.disabled||e.target.readOnly)&&e.preventDefault()})},e.clearStorageOnLogout=function(){e.storage.removeItem("sessionId"),e.storage.removeItem("userName"),e.storage.removeItem("handle"),e.storage.removeItem("signingInWithTwitter"),e.storage.removeItem("twitterToken"),e.storage.removeItem("lastPrefix"),e.storage.removeItem("lastBuildUrl"),e.storage.removeItem("email")},e.checkSession=function(t){e.storage.sessionId?e.ajaxPost("/api/checkSession",{},function(n){e.log("util","checked session; result:",JSON.stringify(n)),"fail"==n.status&&e.clearStorageOnLogout(),t(n)}):t({status:"fail",msg:"noSession"})}}(__pj__),function(t){function e(t,e,n){i.isNode(n)?(n.__name__=e,n.__parent__=t):n&&"object"==typeof n&&i.error('Only Nodes and atomic values can be set as children in <Node>.set("'+e+'",<val>)')}function n(t,n,r){e(t,n,r),t[n]=r}function r(t,e,n){if(e!=n){var o=Object.getOwnPropertyNames(e);o.forEach(function(e){i.internal(e)||(t[e]=1)}),r(t,Object.getPrototypeOf(e),n)}}function o(t,e){var n=i.getMethod(t,"update");n?n.call(t,e):t.iterTreeItems(function(t){if(e){var n=t.__name__,r=e[n];"object"!=typeof r&&(r=void 0)}o(t,r)},!0)}function r(t,e,n){if(e!=n){var o=Object.getOwnPropertyNames(e);o.forEach(function(e){i.internal(e)||(t[e]=1)}),r(t,Object.getPrototypeOf(e),n)}}var i=t.om;i.__externalReferences__=[],i.isObject=function(t){return t&&"object"==typeof t},i.isAtomic=function(t){return!i.isObject(t)},i.isNode=function(t){return i.DNode.isPrototypeOf(t)||i.LNode.isPrototypeOf(t)},i.nodeMethod=function(t,e){i.LNode[t]=i.DNode[t]=e},i.nodeMethod("createDescendant",function(t){var e=this;return t.forEach(function(n){if(""!=n){i.checkName(n)||i.error('Ill-formed name "'+n+'". Names may contain only letters, numerals, and underbars, and may not start with a numeral');var r=e[n];if(void 0===r){var o=i.DNode.mk();e.set(n,o),e=o}else e.hasOwnProperty(n)||i.error("Conflict in createDescencant",t.join("/")),i.isNode(r)||i.error("Conflict in createDescendant ",t.join("/")),e=r}}),e}),i.nodeMethod("computed",function(){return this.__computed__=1,this}),i.nodeMethod("mfreeze",function(t){return"string"==typeof t?this.setFieldStatus(t,"mfrozen"):this.__mfrozen__=1,this}),i.DNode.set=function(t,e,r){if("string"==typeof t)var o=t.indexOf("/");else o=-1;if(o>=0)var a=t.split("/"),s=a.pop(),c=this.createDescendant(a);else c=this,s=t;return i.checkName(s)||i.error('Ill-formed name "'+s+'". Names may contain only letters, numerals, and underbars, and may not start with a numeral'),n(c,s,e),"mfrozen"==r&&c.mfreeze(s),e},i.LNode.set=function(t,e){return n(this,t,e),e},i.LNode.pushChild=function(t){var n=this.length;e(this,n,t),this.push(t)},i.DNode.setf=function(t,e){return this.set(t,e,"mfrozen")},i.DNode.setN=function(t,e){return e?this.set(t,i.toNode(e)):void 0},i.DNode.setIfMissing=function(t){return void 0===this[t]&&this.set(t,i.DNode.mk()),this[t]},i.DNode.mk=function(){return Object.create(i.DNode)},i.LNode.mk=function(t){var e=Object.create(i.LNode);if(void 0==t)return e;for(var n=t.length,r=0;n>r;r++){var o=t[r];o.__parent__=e,o.__name__=""+r,e.push(o)}return e},i.mkLNode=i.LNode.mk,t.set("anon",i.DNode.mk()),i.toNode1=function(t,e,n){var r=typeof n;if(null===n||"object"!=r)return t[e]=n,void 0;if(i.isNode(n))var o=n;else if(Array.isArray(n))var o=i.toLNode(n,null);else var o=i.toDNode(n,null);o.__parent__=t,o.__name__=e,t[e]=o},i.toDNode=function(t,e){if(i.DNode.isPrototypeOf(t))return t;if(e)var n=e;else var n=i.DNode.mk();for(k in t)if(t.hasOwnProperty(k)){var r=t[k];i.toNode1(n,k,r)}return n},i.toLNode=function(t,e){if(e)var n=e;else n=i.LNode.mk();return t.forEach(function(t){n.pushChild(i.toNode(t))}),n},i.toNode=function(t){return Array.isArray(t)?i.toLNode(t):t&&"object"==typeof t?i.toDNode(t):t},i.lift=i.toNode,i.DNode.iterItems=function(t){for(var e in this)this.hasOwnProperty(e)&&!i.internal(e)&&t(this[e],e);return this},i.DNode.ownProperties=function(){var t=Object.getOwnPropertyNames(this),e=[];return t.forEach(function(t){i.internal(t)||e.push(t)}),e},i.DNode.properties=function(t){var e={};r(e,this,t?t:i.DNode);var n=[];for(var o in e)n.push(o);return n},i.DNode.iterTreeItems=function(t,e){var n=Object.getOwnPropertyNames(this),r=this;return n.forEach(function(n){r.treeProperty(n,e)&&t(r[n],n)}),this},i.DNode.iterInheritedItems=function(t,e,n){function r(n){var r=o[n];!e&&"function"==typeof r||i.internal(n)||t(r,n)}var o=this,a=this.properties();return n&&a.sort(),a.forEach(r),this},i.DNode.iterInheritedTreeItems=function(t,e){for(var n in this)this.inheritedTreeProperty(n)&&t(this[n],n);if(!e)return this;var r=this;return e.forEach(function(e){if(r.treeProperty(e)){var n=r[e];t(n,e)}}),this},i.LNode.iterItems=function(t){return this.forEach(t),this},i.LNode.iterTreeItems=function(t,e){var n=this;return this.forEach(function(r,o){n.treeProperty(o,e)&&t(r,o)}),this},i.LNode.iterInheritedItems=function(t){return this.forEach(t),this},i.DNode.iterValues=function(t){var e=!1;for(var n in this)this.treeProperty(n)&&t(this[n])&&(e=!0);return e},i.DNode.setProps=function(t){return i.setProperties(this,t)},i.DNode.keys=function(){var t=[];for(var e in this)this.hasOwnProperty(e)&&!i.internal(e)&&t.push(e);return t},i.nodeMethod("pathOf",function(e){var n=[],r=this.__parent__;if(!r)return void 0;for(var o=this;o;){if(o==e)return n;if(o==t)return n.unshift("/"),n;n.unshift(o.__name__),o=i.getval(o,"__parent__")}return void 0}),i.nodeMethod("topAncestorName",function(t){if(this==t)return void 0;var e=this.__parent__;return e?e==t?this.__name__:e.topAncestorName(t):void 0});var a={om:1};i.inStdLib=function(e){var n=e.topAncestorName(t);return a[n]},i.pathToString=function(t,e){e||(e="/");var n=t.length,r=t.join(e);return n>0&&t[0]==e?r.substr(1):r},i.nodeMethod("remove",function(){var t=this.__parent__,e=this.__name__;t[e]=void 0}),i.DNode.values=function(){var t=[];for(var e in this)this.hasOwnProperty(e)&&!i.internal(e)&&t.push(this[e]);return t},i.removeDups=function(t){var e={},n=[];return t.forEach(function(t){void 0===e[t]&&(e[t]=1,n.push(t))}),n},i.evalPath=function(e,n,r){if(n){if("string"==typeof n)var o=n.split("/");else o=n;var i=o[0];if(""==i||"/"==i){if(r)var a=r;else var a=t;var s=o.concat();s.shift()}else a=e,s=o;for(var c=s.length,u=0;c>u;u++){var h=s[u],f=typeof a;if(!a||"object"!=f&&"function"!=f)return void 0;a=a[h]}return a}},i.nodeMethod("pathSetValue",function(t,e,n){var r=e.length-1,o=e.slice(0,r),i=e[r],a=this.evalPath(o);a&&(a[i]=n)}),i.applyMethod=function(t,e,n){if(e&&("object"==typeof e||"function"==typeof e)){var r=e[t];if(r&&"function"==typeof r)return r.apply(e,n)}return e},i.internalProps={__parent__:1,__protoChild__:1,__value__:1,__hitColor__:1,__chain__:1,__copy__:1,__name__:1,widgetDiv:1,__protoLine__:1,__inCopyTree__:1,__headOfChain__:1},i.internal=function(t){return i.internalProps[t]},i.DNode.findPropertyOnInheritanceChain=function(t){var e=this.get(t);if("undefined"!=typeof e)return this;var n=Object.getPrototypeOf(this);return n.__parent__?n.findPropertyOnInheritanceChain(t):void 0},i.DNode.inheritedTreeProperty=function(t,e){if(i.internal(t))return!1;var n=this[t],r=typeof n;if(!n||"object"!=r&&"function"!=r){if(e)return!1;var o=this.findPropertyOnInheritanceChain(t);return o?!0:!1}var a=n.__parent__;return a==this},i.nodeMethod("treeProperty",function(t,e){if(!this.hasOwnProperty(t)||i.internal(t))return!1;var n=this[t];return i.isNode(n)?n.__parent__==this:!e}),i.nodeMethod("nonAtomicTreeProperty",function(t){return this.treeProperty(t,1)}),i.nodeMethod("children",function(){var t=[];return this.iterValues(function(e,n){i.isObject(n)&&t.push(n)}),t}),i.hasMethod=function(t,e){var n=typeof t;if(t&&"object"==n){var r=t[e];if("function"==typeof r)return r}return void 0},i.nodeMethod("getMethod",function(t,e){var n=typeof t;if(t&&"object"==n){var r=t[e];if("function"==typeof r)return r}return void 0}),i.nodeMethod("treeOfSelections",function(){var t;return this.iterTreeItems(function(e){var n=e.__name__;if(e.__selected__)t=t?t:{},t[n]=1;else{var r=e.treeOfSelections();r&&(t=t?t:{},t[n]=r)}},!0),t}),i.nodeMethod("installTreeOfSelections",function(e){1==e?(this.__selected__=!0,this.deepSetProp("__selectedPart__",1),this.setPropForAncestors("__descendantSelected__",1,t.draw.wsRoot)):e&&this.iterTreeItems(function(t){var n=t.__name__;t.installTreeOfSelections(e[n])},!0)}),i.nodeMethod("deepUpdate",function(t,e){e||(e=this.treeOfSelections()),o(this,t),t&&this.installOverrides(t),this.installTreeOfSelections(e)}),i.DNode.addOverride=function(t,e,n){var r=this[e],o=this.pathOf(n),a=t;o.forEach(function(t){var e=a[t];i.isObject(e)||(e={},a[t]=e),a=e}),a[e]=r},i.pathLookup=function(t,e){for(var n=e.length,r=t,o=0;n>o;o++){var i=e[o],r=r[i];if(void 0===r)return void 0}return r},i.DNode.findInOverride=function(t,e){var n=this.pathOf(e);return i.pathLookup(t,n)},i.DNode.transferToOverride=function(t,e,n){if(t){var r=this.findInOverride(t,e),o=this;r&&n.forEach(function(t){var e=o[t],n=typeof e;"object"==n&&e||(r[t]=e)})}},i.nodeMethod("removeComputed",function(){this.__computed__?this.remove():this.iterTreeItems(function(t){t.removeComputed()},!0)}),i.removeValues=function(t){t.deepApplyMeth("removeValue",null,!0)},i.arrayToDict=function(t){var e={};return t.forEach(function(t){e[t]=1}),e},i.DNode.xferProperty=function(t,e){var n=e[t];return void 0===n?void 0:(this[t]=n,n)},i.DNode.setProperties=function(t,e,n,r){if(t){if(e)var o=i.arrayToDict(e);for(var a in t)if(t.hasOwnProperty(a)){if(e&&void 0===o[a])continue;var s=t[a];if(void 0===s)continue;r&&(s=i.toNode(s)),this.set(a,s,n)}return this}},i.DNode.setPropertiesN=function(t,e,n){return this.setProperties(t,e,n,1)},i.nodeMethod("checkTree",function(){var t=this;this.iterTreeItems(function(e,n){e.__parent__!=t&&i.error(t,e,"bad parent"),e.__name__!=n&&i.error(t,e,"bad name"),e.checkTree()},!0)}),i.DNode.stripOm=function(){var t={};for(var e in this)if(this.nonAtomicTreeProperty(e)){var n=this[e];t[e]=n.stripOm()}else{n=this[e];var r=typeof n;n&&"object"!=r&&"function"!=r&&(t[e]=n)}return t},i.LNode.stripOm=function(){for(var t=[],e=this.length,n=0;e>n;n++)if(this.nonAtomicTreeProperty(n)){var r=this[n];t.push(r.stripOm())}else{r=this[n];var o=typeof r;r&&"object"!=o&&"function"!=o&&t.push(r)}return t},i.createJsFunction=function(){function t(t){return Function.apply(this,t)}return t.prototype=Function.prototype,function(e){return new t(e)}}(),i.pw="vMfm7i1r",i.parseFunctionText=function(t){xnc=t;var e=/\s*function\s*\w*\s*\(([^\)]*)\)/,n=xnc.match(e),r=n[1].split(","),o=xnc.indexOf(")"),a=xnc.substring(o+1),s=a.indexOf("{"),c=a.lastIndexOf("}"),u=a.slice(s+1,c),h=r.concat(u),f=i.createJsFunction(h);return f},i.toFunction=function(t){"function"!=typeof t&&i.error("Expected function");var e=i.parseFunctionText(t.toString());return new i.Function(e)},i.DNode.installType=function(t,e){if(e)n=e;else var n=i.DNode.mk();return n.__isType__=1,this.set(t,n),n},i.DNode.namedType=function(){return this.__isType__=1,this},i.DNode.protoPath=function(t){var e=Object.getPrototypeOf(this),n=i.getval(e,"__parent__");if(!n)return void 0;var r=i.pathOf(e,t);return r},i.nodeMethod("get",function(t){return this.hasOwnProperty(t)?this[t]:void 0}),i.getval=function(t,e){return t||i.error("null v"),t.hasOwnProperty(e)?t[e]:void 0},i.DNode.lastProtoInTree=function(){var t=Object.getPrototypeOf(this),e=t.__parent__;return e?t.lastProtoInTree():this},i.DNode.protoName=function(){var t=Object.getPrototypeOf(this),e=t.__parent__;if(!e)return"";if(t.get("__isType__")){var n=t.__name__;return n?n:""}return t.protoName()},i.LNode.protoName=function(){return"LNode"},i.DNode.hasTreeProto=function(){var t=Object.getPrototypeOf(this);return t&&t.__parent__},Function.prototype.hasTreeProto=function(){return!1},i.LNode.hasTreeProto=function(){return!1},i.nodeMethod("deepApplyFun",function(t){t(this),this.iterTreeItems(function(e){e.deepApplyFun(t)},!0)}),i.nodeMethod("applyFunToAncestors",function(t,e){if(t(this),this!=e){var n=this.__parent__;n&&n.applyFunToAncestors(t,e)}}),i.nodeMethod("deepApplyMeth",function(t,e,n){var r=i.getMethod(this,t),o=!0;r&&(r.apply(this,e),n||(o=!1)),o&&this.iterTreeItems(function(r){r.deepApplyMeth(t,e,n)},!0)}),i.nodeMethod("deepSetProp",function(t,e){this.deepApplyFun(function(n){n[t]=e})}),i.nodeMethod("deepDeleteProps",function(t){this.deepApplyFun(function(e){t.forEach(function(t){delete e[t]})})}),i.nodeMethod("setPropForAncestors",function(t,e,n){this.applyFunToAncestors(function(n){n[t]=e},n)}),i.LNode.maxOrMin=function(t,e){var n=e?-1/0:1/0;return this.forEach(function(r){var o=r[t];"number"==typeof n&&(n=e?Math.max(n,o):Math.min(n,o))}),n},i.LNode.min=function(t){return this.maxOrMin(t,!1)},i.LNode.max=function(t){return this.maxOrMin(t,!0)},i.nodeMethod("funstring1",function(t,e){this.iterTreeItems(function(n,r){if(i.isNode(n))n.funstring1(t,e+r+".");else if("function"==typeof n){var o=t[0],a=n.toString();o+=e+r+" = "+a,o+="\n\n",t[0]=o}})}),i.nodeMethod("funstring",function(e){if(e)var n="__pj__.anon.";else var r=this.pathOf(t),n="__pj__."+r.join(".")+".";var o=[""];return this.funstring1(o,n),o[0]}),i.DNode.findOwner=function(t){for(var e=this;e;){if(e.hasOwnProperty(t))return e;e=Object.getPrototypeOf(e)}},i.DNode.inheritsPropertyFrom=function(t,e){var n=!0;if(this==t)return this.hasOwnProperty(e);if(!t.isPrototypeOf(this))return!1;var r=t[e];if(void 0===r)return!1;for(var o=this;;){var i=Object.getPrototypeOf(o);if(i==t)return n?!0:i.hasOwnProperty(e);o=i}},i.LNode.inheritsPropertyFrom=function(){return!1},i.nodeMethod("treeInheritsPropertyFrom",function(t,e){if(this.inheritsPropertyFrom(t,e))return!0;for(var n in this)if(this.treeProperty(n,!0)){var r=this[n];if(r.treeInheritsPropertyFrom(t,e))return!0}return!1}),i.DNode.inheritsSomePropertyFrom=function(t){if(this==t)return!0;if(!t.isPrototypeOf(this))return!1;for(var e=Object.getOwnPropertyNames(t),n=e.length,r=0;n>r;r++){var o=e[r];if(!i.internal(o)&&this.inheritsPropertyFrom(t,o))return!0}return!1},i.LNode.inheritsSomePropertyFrom=function(){return!1},i.nodeMethod("treeInheritsSomePropertyFrom",function(t,e){if(this.inheritsSomePropertyFrom(t,e))return!0;for(var n in this)if(this.treeProperty(n,!0)){var r=this[n];if(r.treeInheritsSomePropertyFrom(t,e))return!0}return!1}),i.LNode.eval=function(){return this},i.DNode.createChild=function(t,e){var n=this[t];return n?n:(n=e(),this.set(t,n),n)},i.DNode.setNote=function(t,e){var n=this.setIfMissing("__notes__");n[t]=e},i.DNode.setInputF=function(e,n,r){var o=this.setIfMissing("__inputFunctions__"),a=i.pathToString(n.pathOf(t)),s=a+"/"+r;o[e]=s},i.DNode.setOutputF=function(e,n,r){var o=this.setIfMissing("__outputFunctions__"),a=i.pathToString(n.pathOf(t)),s=a+"/"+r;o[e]=s},i.DNode.getBeforeDNode=function(t){if(this==i.DNode)return void 0;var e=this.get(t);if(void 0!==e)return e;var n=Object.getPrototypeOf(this);return n.getBeforeDNode(t)},i.DNode.getInputF=function(e){var n=this.__inputFunctions__;if(n){var r=n.getBeforeDNode(e);return i.evalPath(t,r)}},i.LNode.getInputF=function(){return void 0},i.DNode.getOutputF=function(e){var n=this.__outputFunctions__;if(n){var r=n.getBeforeDNode(e);return i.evalPath(t,r)}},i.LNode.getOutputF=function(){return void 0},i.DNode.getNote=function(t){var e=this.__notes__;return e?e[t]:void 0},i.LNode.getNote=function(){return void 0},i.nodeMethod("isComputed",function(){return this.__computed__?!0:this==t?!1:this.__parent__.isComputed()}),i.nodeMethod("isMfrozen",function(){return this.__mfrozen__?!0:this==t?!1:this.__parent__.isMfrozen()}),i.DNode.setFieldStatus=function(t,e){var n=this.setIfMissing("__fieldStatus__");n[t]=e},i.DNode.getFieldStatus=function(t){var e=this.get("__fieldStatus__");return e?e[t]:void 0},i.DNode.fieldIsFrozen=function(t){if(this.isMfrozen())return!0;var e=this.getFieldStatus(t);return e&&0==e.indexOf("mfrozen")},i.nodeMethod("installOverrides",function(t){for(var e in t){var n=t[e];if(i.isObject(n)){var r=this[e];i.isNode(r)&&r.installOverrides(n)}else this[e]=n}}),i.installType("DataSource"),i.DataSource.mk=function(t){var e=Object.create(i.DataSource);return e.url=t,e.setf("link",""),i.setDataSourceLink(t,e),e},i.dataSourceBeingLoaded=null,i.loadedData=[],i.loadDataTimeout=2e3,t.loadData=function(t){var e=i.loadDataCallback;i.loadedData[i.dataSourceBeingLoaded]=1,e&&e(t)},i.loadDataError=function(e){t.page.genError("Could not load "+e)},i.DataSource.loadTheData=function(t){setTimeout(function(){var t=i.dataSourceBeingLoaded;i.loadedData[t]||i.loadDataError(t)},i.loadDataTimeout);var e=i.mapUrlToDev(this.url);i.dataSourceBeingLoaded=e,i.loadDataCallback=t,$.ajax({crossDomain:!0,dataType:"script",url:e})},i.collectedDataSources=void 0,i.DataSource.collectThisDataSource=function(){i.collectedDataSources.push(this)},i.collectDataSources=function(t){return i.collectedDataSources=[],t.deepApplyMeth("collectThisDataSource"),i.collectedDataSources},i.loadNextDataSource=function(t,e){var n=i.collectedDataSources,r=n.length;if(t==r)return e(),void 0;var o=n[t],a=function(n){o.set("data",i.toNode(n)),o.__current__=1,i.loadNextDataSource(t+1,e)};return o.__current__?(i.loadNextDataSource(t+1,e),void 0):(o.loadTheData(a),void 0)},i.loadTheDataSources=function(t,e){i.loadedData=[],t.forEach(function(t){i.collectDataSources(t)}),i.loadNextDataSource(0,e)},i.newDataSource=function(e,n){n.url=e,n.__current__=0;var r=function(e){n.set("data",i.toNode(e)),n.__current__=1,t.tree.updateAndShow()};return n.loadTheData(r),e},i.setDataSourceLink=function(t,e){var n=e.url;return e.link="<a href='"+n+"'>"+n+"</a>",t},i.DataSource.setInputF("url",i,"newDataSource"),i.DataSource.setOutputF("url",i,"setDataSourceLink"),i.DNode.ownProperties=function(){var t=Object.getOwnPropertyNames(this),e=[];return t.forEach(function(t){i.internal(t)||e.push(t)}),e},i.DNode.properties=function(t){var e={};r(e,this,t?t:i.DNode);var n=[];for(var o in e)n.push(o);return n}}(__pj__),function(){var t=__pj__.om;t.theChains=[],t.DNode.markCopyNode=function(){this.__inCopyTree__=1},t.DNode.markCopyTree=function(){this.deepApplyMeth("markCopyNode",null,!0)},t.DNode.addChain=function(t){if(this.hasOwnProperty("__chain__"))return this.__chain__;var e=Object.getPrototypeOf(this),n=typeof e;if("function"!=n&&"object"!=n||!e.get("__parent__")){if(t){var r=[this];return this.__chain__=r,r}return void 0}if(e.__inCopyTree__){var o=e.addChain(1).concat();o.push(this)}else var o=[this];return this.__chain__=o,o},t.DNode.addChains=function(){this.deepApplyMeth("addChain",null,!0)},t.DNode.collectChain=function(){var e=this.__chain__;e&&e.length>1&&!e.collected&&(t.theChains.push(e),e.collected=1)},t.DNode.collectChains=function(){this.deepApplyMeth("collectChain",null,!0)},t.buildCopiesForChain=function(t){for(var e=t[0],n=t.length,r=0;n>r;r++){var o=t[r];if(o.get("__copy__"))var i=o.__copy__;else i=Object.create(e),0==r&&(i.__headOfChain__=1),o.__name__&&(i.__name__=o.__name__),o.__copy__=i;e=i}},t.buildCopiesForChains=function(){t.theChains.forEach(function(e){t.buildCopiesForChain(e)})},t.DNode.buildCopyForNode=function(){var t=this.__copy__;if(!t){var t=Object.create(this);this.__copy__=t,t.__headOfChain__=1}},t.LNode.buildCopyForNode=function(){var e=this.__copy__;if(!e){var e=t.LNode.mk();this.__copy__=e}},t.DNode.buildCopiesForTree=function(){this.deepApplyMeth("buildCopyForNode",null,!0)},t.cnt=0,t.DNode.stitchCopyTogether=function(){var e=this.__copy__;e||t.error("unexpected"),t.cnt++;for(var n in this)if(this.hasOwnProperty(n)&&!t.internal(n)){var r=this[n];if(r&&"__isType__"==n){e[n]=r;continue}var o=typeof r;if(r&&"object"==o){var i=t.getval(r,"__copy__");i&&(e[n]=i,i.__name__=n,i.__parent__=e),t.getval(r,"__parent__")==this&&r.stitchCopyTogether()}else e.get("__headOfChain__")||(e[n]=r)}return e},t.LNode.stitchCopyTogether=function(){var e=this.get("__copy__");e||t.error("unexpected");for(var n=this.length,r=0;n>r;r++){var o=this[r],i=typeof o;if(o&&"object"==i){var a=o.get("__copy__");a?(e.push(a),a.__name__=r,a.__parent__=e):e.push(o),o.get("__parent__")==this&&o.stitchCopyTogether()}else e.push(o)}return e},t.DNode.cleanupSourceAfterCopy1=function(){delete this.__inCopyTree__,delete this.__chain__,delete this.__copy__},t.LNode.cleanupSourceAfterCopy1=function(){delete this.__inCopyTree__,delete this.__copy__},t.DNode.cleanupSourceAfterCopy=function(){this.deepApplyMeth("cleanupSourceAfterCopy1",null,!0),t.theChains=[]},t.DNode.instantiate=function(){this.markCopyTree(),this.addChains(),this.collectChains(),t.buildCopiesForChains(),this.buildCopiesForTree();var e=this.stitchCopyTogether();return this.cleanupSourceAfterCopy(),e},t.DNode.instantiationCount=function(t){var e=0;if(t.isPrototypeOf(this))var e=1;else e=0;return this.iterTreeItems(function(n){var r=n.instantiationCount(t);e+=r},!0),e},t.LNode.instantiationCount=t.DNode.instantiationCount,t.DNode.copyNode=function(){var t=Object.create(this);return this.iterTreeItems(function(e,n){var r=e.copyNode();r.__parent__=t,r.__name__=n,t[n]=r},!0),t},t.LNode.copyNode=function(){var e=t.LNode.mk();return this.forEach(function(n){if(t.isNode(n)){var r=n.copyNode();e.pushChild(r)}else e.push(n)}),e}}(),function(t){function e(t,e){var r=n.pathLast(t),o=n.pathExceptLast(t),i=o+e+"/"+r+".js";return i}var n=t.om;t.draw,n.DNode.isProtoChild=function(){var t=Object.getPrototypeOf(this);if(!t)return!1;var e=this.get("__parent__");if(!e)return!1;var r=Object.getPrototypeOf(e);if(!n.DNode.isPrototypeOf(r))return!1;var o=this.__name__,i=r[o];return i==t},Function.prototype.isProtoChild=function(){return!1};var r={__prototype__:1,__name__:1,__typePrototype__:1,__parent__:1,widgetDiv:1};n.DNode.assertExternalReferences=function(t){var e=this.__externalReferences__;e||(e=[]),this.__externalReferences__=e.concat(t)},n.externalReferences={},n.computeAllExternalReferences=function(e){var r={},o=e.__externalReferences__;if(o){var i=[];o.forEach(function(e){if(0==e.indexOf("http:")||0==e.indexOf("https:"))n.error("unexpected"),r[p]=e;else{p=e;var o=n.pathMap[p];o&&(r[p]=o)}var a=n.evalPath(t,p),s=n.computeAllExternalReferences(a);i=i.concat(s[0]),$.extend(r,s[1])}),i=i.concat(o);var a=n.removeDups(i);return[a,r]}return[]},n.externalizedAncestor=function(t){if(n.getval(t,"__externalReferences__"))return t;var e=n.getval(t,"__parent__");return e?n.externalizedAncestor(e):void 0},n.refPath=function(e,r){var o=e.pathOf(r);if(o){var i=n.pathToString(o);if("/"==i[0]){var a=e,s=n.externalizedAncestor(a);if(s){var c=s.pathOf(t),u="/"+n.pathToString(c),h=n.externalReferences;h[u]=1}else n.error("External dependency "+i+" has not been saved")}return i}},n.DNode.externalize=function(t){if(t)var e=t;else e=this;var o={},i=this.isProtoChild();if(i)o.__protoChild__=1;else{var a=Object.getPrototypeOf(this),s=n.refPath(a,e);s&&(o.__prototype__=s)}var c=this;return this.iterItems(function(t,i){if(!c.treeProperty(i)){var a=n.refPath(t,e);return a&&(o[i]={__reference__:a}),void 0}if(!r[i])if(n.isNode(t)){var s=t.externalize(e);o[i]=s}else o[i]=t}),o},n.LNode.externalize=function(t){if(t)var e=t;else e=this;for(var r=[],o=this.length,i=0;o>i;i++){var a=this[i];if(n.isNode(a))var s=a.externalize(e);else s=a;r.push(s)}return r},n.allEChains=[],n.installParentLinks1=function(t,e){if(e&&"object"==typeof e){for(var r in e)if(e.hasOwnProperty(r)){var o=e[r];o&&"object"==typeof o&&(o.__reference__||(n.installParentLinks1(e,o),o.__name__=r))}t&&(e.__parent__=t)}},n.installParentLinks=function(t){return n.installParentLinks1(null,t)},n.buildEChain=function(t,e,r){var o=r.__prototype__;if(r.__chain__,o){var i=o.split("/"),a=n.evalPath(e,i,t);if(n.log("untagged","setting prototypev for ",o),r.__prototypev__=a,""==i[0])var s=[a,r];else{var s=n.buildEChain(t,e,a);s||(s=[null,a]),s.push(r)}return r.__chain__=s,s}if(r.__protoChild__){var c=r.__parent__;c||n.error("__protoChild__ root of serialization not handled yet");var u=c.__prototypev__;if(u){var a=u[r.__name__],s=n.buildEChain(t,e,a);s||(s=[a])}else{n.error("Missing __prototypev__");var a=c[r.__name__],s=[a]}return s.push(r),r.__chain__=s,r.__prototypev__=a,s}};var o={__v__:1,__prototype__:1,__function__:1,__prototypev__:1,__parent__:1,__name__:1,__chain__:1,__reference__:1};n.buildEChains=function(t,e,r){if(r)var i=r;else i=e;n.buildEChain(t,e,i);for(var a in i)if(i.hasOwnProperty(a)&&!o[a]){var s=i[a];s&&"object"==typeof s&&n.buildEChains(t,e,s)}},n.allChains=[],n.allLNodes=[],n.collectEChains=function(t){var e=t.__chain__;e&&!e.__collected__&&(n.allChains.push(e),e.__collected__=!0);for(var r in t)if(t.hasOwnProperty(r)&&!o[r]){var i=t[r];i&&"object"==typeof i&&n.collectEChains(i)}},n.buildObjectsForChain=function(t){var e=t.length;if(t[0])var r=t[0];else r=n.DNode.mk();for(var o=1;e>o;o++){var i=t[o],a=i.__v__;if(!a){var s=i.__function__;if(s){error("Obsolete I think");var a=n.parseFunctionText(s)}else a=Object.create(r),a.__name__=i.__name__;i.__v__=a}r=a}"e0"==a.__name__},n.buildObjectsForChains=function(){n.allChains.forEach(function(t){n.buildObjectsForChain(t)})},n.buildObjectsForTree=function(t){if(!t.__v__){var e=t.__function__;if(e)var r=n.parseFunctionText(e);else r=Array.isArray(t)?n.LNode.mk():n.DNode.mk();t.__v__=r}for(var i in t)if(t.hasOwnProperty(i)&&!o[i]){var r=t[i];r&&"object"==typeof r&&(r.__reference__||n.buildObjectsForTree(r))}},n.stitchTogether=function(t){var e=t.__v__;if(Array.isArray(t))t.forEach(function(t){if(!t||"object"!=typeof t&&"function"!=typeof t)e.push(t);else{n.stitchTogether(t);var r=t.__v__;e.pushChild(r)}});else for(var r in t)if(t.hasOwnProperty(r)&&!o[r]){var i=t[r];
i&&"object"==typeof i?i.__reference__?referencesToResolve.push([e,r,i.__reference__]):(e[r]=i.__v__,n.stitchTogether(i)):e[r]=i}e.__name__=t.__name__;var a=t.__parent__;a&&(e.__parent__=a.__v__)},referencesToResolve=[],n.resolveReference=function(t,e,r){var o=r[0],i=r[1],a=r[2],s=n.evalPath(e,a,t);return o[i]=s,s},n.resolveReferences=function(t,e){referencesToResolve.forEach(function(r){n.resolveReference(t,e,r)})},n.DNode.cleanupAfterInternalize=function(){this.deepDeleteProps(["__prototypev__","__protoChild__","__prototype__"])},n.internalize=function(t,e,r){n.installParentLinks(r),n.buildEChains(t,r),n.collectEChains(r),n.buildObjectsForChains(),n.buildObjectsForTree(r),n.stitchTogether(r),n.log("untagged",referencesToResolve);var o=r.__v__;return n.resolveReferences(t,o),0==e.indexOf("http:")||0==e.indexOf("https:")?t.set("anon",o):t.set(e,o),o.cleanupAfterInternalize(),o},n.addExtrefs=function(t){n.externalReferences={};var e=t.externalize(t),r=Object.keys(n.externalReferences),o=t.__externalReferences__;t.__externalReferences__=o?o.concat(r):r;var i=n.computeAllExternalReferences(t),a=i[0],s=i[1],c={directExternalReferences:r,allExternalReferences:a,pathMap:s,value:e};return c},n.getFile=function(t,e){var r={path:t};n.ajaxPost("/api/getFile",r,function(t){e(t)})},n.grabbed={},n.pathMap={},n.urlToPath={},n.urlsGrabbed={},n.iiGrabbed=function(t){var e=n.grabbed[t];return e||(e=n.urlsGrabbed[t]),e},n.repoUrl=function(t){return url=n.itemHost+t},n.toUrl=function(t){if(0==t.indexOf("http:")||0==t.indexOf("https:"))var e=t;else e=n.pathMap[t];return e},n.toPath=function(t){if(0==t.indexOf("http:")||0==t.indexOf("https:")){var e=n.urlToPath[t];if(!e)throw n.error("No path for "+t),"noPath";return e}return t},n.toCodeVariant=function(t){return e(t,"code")},n.toDataVariant=function(t){return e(t,"data")},n.allInstalls=[],n.loadFunction=function(t){var e=t.path,r=t.value,o=t.url;n.log("untagged","LoadFunction  path ",e," url ",o),n.grabbed[e]=r,n.urlsGrabbed[o]=r,n.pathMap[e]=o,n.urlToPath[o]=e,$.extend(n.pathMap,r.pathMap);var i=n.grabCallbacks[o];n.log("untagged","looked up grabCallback of ",o,e," found? ",i?"yes":"no"),i&&i(r)},n.loadCodeFunction=function(t){return},n.grabCallbacks={},n.grabCode=function(t,e){var r=n.toUrl(t),o=n.toCodeVariant(r);$.ajax({crossDomain:!0,dataType:"script",url:o,success:function(){e&&e()}})},n.grabTimeout=4e3,n.grabError=function(e,n){t.page.genError("<span class='errorTitle'>Error:</span> Could not load "+n)},n.grabOne=function(t,e){var r=n.toUrl(t);if(!r)return n.grabError(t,t),void 0;var o=n.toDataVariant(r),i=function(){n.urlsGrabbed[r]||n.grabError(t,r),n.log("untagged","timout with no error for url ",r," indicator",t)};n.grabCallbacks[r]=e,setTimeout(i,n.grabTimeout),$.ajax({crossDomain:!0,dataType:"jsonp",url:o})},n.grabM=function(t,e,r){var o=t.length;if(0==o)return e&&e(),void 0;for(var i=[],a=0,s=function(){a++,n.log("untagged","numInstalled",a),a==o&&e&&e(i)},c=0;o>c;c++){var u=t[c];r?n.grabCode(u,s):n.grabOne(u,s)}},n.restore=function(e,r){function o(e){var r=n.toPath(e);u=n.grabbed[r],u||n.error("Failed to load "+e);var o=n.internalize(t,r,u.value);return o.__externalReferences__=u.directExternalReferences,o.__overrides__=u.overrides,o.__from__=e,n.allInstalls.push(o),o}function i(t){if(t.forEach(function(t){o(t)}),h)for(var i=[],a=e.length,s=0;a>s;s++)i.push(o(e[s]));else var i=[o(e)];var c=Object.keys(n.urlsGrabbed),u=c;n.grabM(u,function(){r(i)},!0)}function a(e,r){var o=n.urlsGrabbed[e],i=o.allExternalReferences;i.forEach(function(e){void 0===n.evalPath(t,e)&&r.push(e)})}function s(){var t=[];a(e,t),n.grabM(t,function(){i(t)})}function c(){var t=[];e.forEach(function(e){a(e,t)}),n.grabM(t,function(){i(t)})}var u;if(!e||0==e.length)return r(),void 0;if(e instanceof Array)var h=1;else h=0;n.grabbed={},n.grabbedUrls={},h?n.grabM(e,c):n.grabOne(e,s)},n.install=n.restore,n.dayOrdinal=function(){var t=new Date,e=Math.floor(t.getTime()/864e5);return e-15904},n.numToLetter=function(t,e){if(10>t)if(e)n=97+t;else var n=48+t;else n=87+t;return String.fromCharCode(n)},n.randomName=function(){for(var t="i",e=0;9>e;e++)t+=n.numToLetter(Math.floor(35*Math.random()),1);return t},n.DNode.computePaths=function(t,e){var r=this.pathOf(),o=localStorage.handle;if(pth=n.pathToString(r),e)var i=n.randomName(),a="/variant"+n.pathToString(pth);else i=r.pop(),a=n.pathToString(r);var s="/"+o+"/"+t,c=n.itemHost+s+a;return{url:c+"/"+i,host:n.itemHost,repo:s,path:pth,spath:s+a+"/"+i,data:a+"/data/"+i+".js",code:a+"/code/"+i+".js"}},n.unpackUrl=function(t,e){this.pathOf();var n=/(http\:\/\/[^\/]*)\/([^\/]*)\/([^\/]*)\/(.*)\/([^\/]*)$/,r=t.match(n);if(r){var o=r[5],i="/"+r[4],a=i+"/"+o;if(e)var s=i;else var s=a;var c="/"+r[2]+"/"+r[3];return{url:t,host:r[1],handle:r[2],prefix:r[3],repo:c,path:s,spath:c+a,data:i+"/data/"+o+".js",code:i+"/code/"+o+".js",image:i+"/image/"+o+".jpg"}}},n.s3Save=function(e,r,o,i){n.unselect();var a=t.draw.overrides;i&&e.removeComputed(),delete e.__changedThisSession__;var s=n.addExtrefs(e);s.overrides=a,i&&(s.value.__autonamed__=1);var c=e.funstring();""==c&&(c="//No JavaScript was defined for this item");var u={value:s,url:r.url,path:r.path,repo:r.repo},h={pw:n.pw,path:r.repo+r.data,value:"__pj__.om.loadFunction("+JSON.stringify(u)+")",isImage:0};h.viewFile=r.spath;var f={path:r.repo+r.code,value:c,pw:n.pw,isImage:0},l="/api/toS3";n.ajaxPost(l,h,function(){n.ajaxPost(l,f,function(t){i&&e.deepUpdate(),o&&o(t)})})},n.save=function(t){var e=n.customSave;e?e(t):alert("not yet")}}(__pj__),function(t){var e=t.om;t.set("dom",e.DNode.mk());var n=t.dom;n.installType("JQ"),n.newJQ=function(t,r){if(r)var o=Object.create(r);else var o=Object.create(n.JQ);return t&&(o.setProperties(t,["tag","html","click","id","type"]),o.setN("hoverIn",t.hoverIn),o.setN("hoverOut",t.hoverOut),o.setN("style",t.style),o.setN("attributes",t.attributes)),o.set("theChildren",e.LNode.mk()),o},n.JQ.addChild=function(t,e){return e?(this.theChildren.pushChild(e),void 0!==t&&(e.id=t),e):(this.theChildren.pushChild(t),t)},n.JQ.removeChildren=function(){var t=this.__element__;t&&t.empty(),this.theChildren.length=0},n.JQ.lastChild=function(){var t=this.theChildren,e=t.length;return e>0?t[e-1]:void 0},n.JQ.addBefore=function(t){for(var e=this.__parent__,r=n.LNode.mk(),o=e.length,i=0;o>i;i++){var a=e[i];a==this&&r.pushChild(t),r.pushChild(a)}var s=e.__parent__;s.set("theChildren",r)},n.JQ.selectChild=function(t){for(var e=this.theChildren,n=e.length,r=0;n>r;r++){var o=e[r];if(o.id==t)return o}},n.JQ.parent=function(){var t=this.get("__parent__");if(e.LNode.isPrototypeOf(t)){var r=t.get("__parent__");if(n.JQ.isPrototypeOf(r))return r}},n.JQ.cssSelect=function(t){for(var e=t.split(">"),n=e.map(function(t){return t.substr(1)}),r=n.length,o=this,i=0;r>i;i++)if(o=o.selectChild(n[i]),!o)return o;return o},n.JQ.install=function(t,e,n){function r(t,e){t[e]&&("enter"==e?t.__element__.keyup(function(n){13==n.keyCode&&t[e]()}):t.__element__[e](t[e]))}function o(t,e){e.forEach(function(e){r(t,e)})}n||(n=0);var i=this.parent();t?this.__treeTop__=1:i&&i.__element__&&(t=i.__element__);var a=this.__element__,s=this.id;if(s||(s=this.__name__),s||(s="uiRoot"),!a){var c=this.html,u=this.tag;u?(a=$("<"+u+"/>"),c&&a.html(c)):a=$(c),e?e.__element__.after(a):t.append(a),this.__element__=a,a.attr("id",s),o(this,["click","blur","focus","enter"]);var h,f,l=this.hoverIn;if(l){var d=l.stripOm();h=function(){a.css(d)}}var p=this.hoverOut;if(p){var _=p.stripOm();f=function(){a.css(_)}}(l||p)&&a.hover(h,f),this.hidden&&a.hide()}var v=this.style;if(v){var m=v.stripOm();a.css(m)}var g=this.attributes;g&&g.iterInheritedTreeItems(function(t,e){a.attr(e,t)});for(var y=n+1,N=this.theChildren,b=void 0,C=N.length,P=0;C>P;P++){var D=N[P];D.install(null,b,y),b=D}},n.JQ.hide=function(){if(!this.hidden){this.hidden=1;var t=this.__element__;t&&t.hide()}},n.JQ.show=function(){if(this.hidden){this.hidden=0;var t=this.__element__;t&&t.show()}},n.JQ.dpytree=function(){var t={};t.tag=this.tag,t.html=this.html,t.id=this.id;var e=this.style;e&&(t.style=e.stripOm());var n=this.attributes;n&&(t.attributes=n.stripOm());var r=this.theChildren,o=[];t.theChildren=o;for(var i=r.length,a=0;i>a;a++){var s=r[a],c=s.dpytree();o.push(c)}return t},n.toHtml=function(t){var e="",r=t.tag;e+="<"+r+">";var o=t.html;o&&(e+=o);var i=t.theChildren;return i&&i.forEach(function(t){e+=n.toHtml(t)}),e+="</"+r+">"},n.JQ.toHtml=function(){var t=this.dpytree();return n.toHtml(t)},n.JQ.dpy=function(){return JSON.stringify(this.dpytree())},n.JQ.css=function(t){var e=this.__element__;e&&e.css(t)},n.JQ.attr=function(t,e){var n=this.__element__;n&&n.attr(t,e)},n.JQ.prop=function(t,e){var n=this.__element__;n&&n.prop(t,e)},n.JQ.empty=function(){var t=this.__element__;t&&t.empty()},n.JQ.setHtml=function(t){this.html=t;var e=this.__element__;e&&e.html(t)},n.JQ.offset=function(){var t=this.__element__;return t?t.offset():void 0},n.JQ.width=function(){var t=this.__element__;return t?t.width():void 0},n.JQ.height=function(){var t=this.__element__;return t?t.height():void 0},n.JQ.html=function(t){var e=this.__element__;return e?e.html(t):void 0},n.installType("Select"),n.Select.mk=function(t){var e=Object.create(n.Select);return e.setProperties(e,t),e},n.Select.toJQ=function(){function t(t){return function(){a.select(t)}}var e=this.jq;if(e)return e;for(var n=this.options,r=this.containerP.instantiate(),o=this.optionP,i=n.length,a=this,s=[],c=this.selected,u=0;i>u;u++){var h=n[u],f=o.instantiate();s.push(f),f.html=u===c?"&#x25CF; "+h:h,r.addChild(f),f.click=t(u)}return this.optionElements=s,this.jq=r,r},n.Select.select=function(t){this.selected=t;for(var e=this.options,n=this.optionElements,r=e.length,o=0;r>o;o++){var i=e[o],a=n[o];o==t?a.__element__.html("&#x25CF; "+i):a.__element__.html(i)}this.onSelect&&this.onSelect(t)},n.popped={},n.popFromButton=function(t,e,r){n.unpop(t);var o=n.popped;if(o[t])return r.css({display:"none"}),o[t]=0,void 0;var i=r.parent(),a=i.offset(),s=e.height(),c=e.offset(),u=c.left-a.left,h=c.top-a.top;r.css({display:"block",left:u+"px",top:h+s+"px"}),o[t]=r},n.unpop=function(t){var e=n.popped;for(k in e)if(k!=t){var r=e[k];r&&(r.css({display:"none"}),e[k]=0)}}}(__pj__),function(t){var e=t.om,n=t.dom,r=e.DNode.mk();t.set("jqPrototypes",r),r.set("button",n.newJQ({tag:"div",html:"prototype",hoverOut:{"background-color":"#444444"},hoverIn:{"background-color":"#777777"},style:{cursor:"pointer",color:"white",display:"inline-block","margin-left":"10px","padding-left":"5px","padding-right":"5px",border:"solid thin black",font:"11pt arial","background-color":"#444444"}})),r.set("textInput",n.newJQ({tag:"input",type:"input",style:{display:"inline-block",width:"150px","background-color":"white","margin-left":"10px"}})),r.set("pulldown",n.newJQ({tag:"div",style:{position:"absolute","padding-left":"5px","padding-right":"5px",border:"solid thin black","background-color":"white"}})),r.set("pulldownEntry",n.newJQ({tag:"div",html:"prototype",style:{cursor:"pointer",color:"black","padding-left":"5px","padding-right":"5px","background-color":"white"}}))}(__pj__),function(t){var e=t.om,n=_=t.set("geom",t.om.DNode.mk());n.__externalReferences__=[],n.installType("Point"),n.set("Shape",e.DNode.mk()).namedType(),n.Shape.mk=function(){return n.Shape.instantiate()},n.shapeOrLNodeChild=function(t,r){var o=t[r];if(n.Shape.isPrototypeOf(o)||e.LNode.isPrototypeOf(o)){var i=o.get("__parent__");if(i!=t)return;return o}},e.DNode.shapeTreeIterate=function(t){var e=Object.getOwnPropertyNames(this),r=this;e.forEach(function(e){var o=n.shapeOrLNodeChild(r,e);o&&t(o)})},e.LNode.shapeTreeIterate=function(t){var e=this;this.forEach(function(r){var o=n.shapeOrLNodeChild(e,r.__name__);o&&t(o)})},n.Point.mk=function(t,e){var r=Object.create(n.Point);return"number"==typeof t?(r.x=t,r.y=e):(r.x=0,r.y=0),r},n.toPoint=function(t){return Array.isArray(t)?n.Point.mk(t[0],t[1]):t},e.DNode.setPoint=function(t,e){if(e)var r=n.toPoint(e);else r=n.Point.mk();return this.set(t,r),r},n.Point.x=0,n.Point.y=0,n.Point.plus=function(t){var e=this;return n.Point.mk(e.x+t.x,e.y+t.y)},n.Point.length=function(){var t=this.x,e=this.y;return Math.sqrt(t*t+e*e)},n.Point.direction=function(){return n.normalizeAngle(Math.atan2(this.y,this.x))},n.Point.difference=function(t){var e=this;return n.Point.mk(e.x-t.x,e.y-t.y)},n.installType("Interval"),n.mkInterval=function(t,e){var r=Object.create(n.Interval);return r.lb=t,r.ub=e,r},n.Point.setCoords=function(t,e){this.set("x",t),this.set("y",e)},n.Point.distance=function(t){if(t)var e=this.x-t.x,n=this.y-t.y;else e=this.x,n=this.y;return Math.sqrt(e*e+n*n)},n.Point.times=function(t){var e=this;return n.Point.mk(t*e.x,t*e.y)},n.Point.normalize=function(){var t=this.length();return n.Point.mk(this.x/t,this.y/t)},n.Point.normal=function(){return n.Point.mk(-this.y,this.x)},n.Point.minus=function(){return n.Point.mk(-this.y,-this.x)},n.Point.dotp=function(t){return this.x*t.x+this.y*t.y},n.mkRadialPoint=function(t,e){return n.Point.mk(t*Math.cos(e),t*Math.sin(e))},n.Point.interpolate=function(t,e){var n=t.difference(this),r=n.times(e),o=this.plus(r);return o},n.Point.toRectangle=function(){var t=this.x,e=this.y,r=n.Point.mk(Math.abs(t),Math.abs(e)),o=0>t?t:0,i=0>e?e:0,a=n.Point.mk(o,i);return n.Rectangle.mk({corner:a,extent:r})},n.Point.toString=function(){var t=this.x,e=this.y;return"["+t+","+e+"]"},n.installType("Transform"),n.Transform.mk=function(t){var e=Object.create(n.Transform);return e.scale=1,e.rotation=0,e.setProperties(t,["scale","rotation"]),e.setPoint("translation",t?t.translation:void 0),e},e.DNode.addTransform=function(){var t=this.transform;return t||(t=n.Transform.mk(),this.set("transform",t)),t},n.normalizeAngle=function(t){var e=t%(2*Math.PI);return 0>e&&(e+=2*Math.PI),e},n.rotate=function(t){var e=n.Transform.mk();return e.rotation=t,e},n.pointify=function(t,e,r){if(void 0===e)var o=n.Point.mk(0,0);else o="number"==typeof r?n.Point.mk(e,r):Array.isArray(e)?n.Point.mk(e[0],e[1]):t?n.Point.mk(e.x,e.y):e;return o},n.toPoint=function(t,e){return n.pointify(0,t,e)},n.newPoint=function(t,e){return n.pointify(1,t,e)},n.mkTranslation=function(t,e){var r=n.newPoint(t,e),o=n.Transform.mk({translation:r});return o},n.scaling=function(t){var e=n.Transform.mk({translation:p});return e.scale=t,e},e.DNode.moveto=function(t,e){var r=n.toPoint(t,e),o=this.__parent__,i=o.toLocalCoords(r),a=this.transform,s={};if(a)a.scale=a.scale,a.rotation=a.rotation,a.translation.setTo(i);else{s.translation=i;var c=n.Transform.mk(s);this.set("transform",c)}},e.LNode.moveto=e.DNode.moveto,n.Transform.inverse=function(){var t=this.scale;t||(t=1);var e=1/t,r=this.translation;if(r){var o=-r.x*e,i=-r.y*e;return n.Transform.mk({scale:e,translation:n.Point.mk(o,i)})}return n.Transform.mk({scale:e})},n.Point.applyTransform=function(t){var e=t.translation,r=e.x,o=e.y,i=t.scale,a=t.rotation,s=this.x,c=this.y;if(0==a)var u=s,h=c;else var f=Math.sin(a),l=Math.cos(a),u=l*s-f*c,h=f*s+l*c;var d=i*u+r,p=i*h+o;return n.Point.mk(d,p)},n.Transform.applyInverse=function(t){var e=this.translation,r=this.scale,o=this.rotation;px=t.x-e.x,py=t.y-e.y;var i=1/r;if(px*=i,py*=i,0==o)var a=px,s=py;else var c=Math.sin(-o),u=Math.cos(-o),a=u*px-c*py,s=c*px+u*py;return n.Point.mk(a,s)},e.DNode.toGlobalCoords=function(t,e){var r=t?t:n.Point.mk(0,0);if(this==e)return r;var o=this.getTransform();o&&(r=r.applyTransform(o));var i=this.get("__parent__");return i?i.toGlobalCoords(r,e):r},e.LNode.toGlobalCoords=e.DNode.toGlobalCoords,e.DNode.toLocalCoords=function(t){var e=t?t:n.Point.mk(0,0),r=this.get("__parent__");r&&(e=r.toLocalCoords(e));var o=this.getTransform();return o&&(e=o.applyInverse(e)),e},e.LNode.toLocalCoords=e.DNode.toLocalCoords,e.DNode.translate=function(t,e){var r=this.transform;if(r)return r.set("translation",n.newPoint(t,e)),void 0;var r=n.mkTranslation(t,e);this.set("transform",r)},e.DNode.setScale=function(t){var e=this.transform;if(e)return e.scale=t,void 0;var e=n.scaling(t);this.set("transform",e)},e.DNode.rotate=function(t){var e=this.transform;if(e)return e.rotation=t,e;var e=n.rotate(t);this.set("transform",e)},n.Point.setTo=function(t){this.x=t.x,this.y=t.y},n.Point.setXY=function(t,e){this.x=t,this.y=e},n.set("Rectangle",n.Shape.mk()).namedType(),n.Rectangle.mk=function(t){var e=n.Rectangle.instantiate();return t&&(e.style&&e.style.setProperties(t.style),e.setPoint("corner",t.corner),e.setPoint("extent",t.extent)),e},n.Rectangle.set("corner",n.Point.mk()),n.Rectangle.set("extent",n.Point.mk(1,1)),n.Rectangle.corners=function(){var t=[],e=this.corner,r=e.x,o=e.y,i=this.extent,a=i.x,s=i.y;return t.push(e),t.push(n.Point.mk(r,o+s)),t.push(n.Point.mk(r+a,o+s)),t.push(n.Point.mk(r+a,o)),t},n.boundingRectangle=function(t){var e=t.length;if(0==e)return void 0;for(var r=t[0],o=r.x,i=o,a=r.y,s=a,c=1;e>c;c++){var u=t[c],h=u.x,f=u.y;i=Math.max(i,h),o=Math.min(o,h),s=Math.max(s,f),a=Math.min(a,f)}return n.Rectangle.mk({corner:n.Point.mk(o,a),extent:n.Point.mk(i-o,s-a)})},n.Rectangle.extendBy=function(t){var e=this.corners().concat(t.corners());return n.boundingRectangle(e)},n.Rectangle.center=function(){var t=this.extent,e=this.corner;return n.Point.mk(e.x+.5*t.x,e.y+.5*t.y)},n.Rectangle.width=function(){return this.extent.x},n.Rectangle.height=function(){return this.extent.y},n.Rectangle.scaleCentered=function(t){var e=this.width(),r=this.height(),o=this.center(),i=t*e,a=t*r,s=o.plus(n.Point.mk(-.5*i,-.5*a)),c=n.Point.mk(i,a);return n.Rectangle.mk({corner:s,extent:c})},n.Rectangle.plus=function(t){var e=n.Rectangle.mk({corner:this.corner.plus(t),extent:this.extent});return e},n.Rectangle.contains1=function(t){var e=this.corner,n=t.x;if(n<e.x)return!1;var r=t.y;if(r<e.y)return!1;var o=this.extent;return n>e.x+o.x?!1:r>e.y+o.y?!1:!0},n.Rectangle.distance2=function(t,e){if(!this.contains1(t))return void 0;var n=this.corner,r=this.extent,o=n.x+r.x,i=n.y+r.y,a=Math.min(t.x-n.x,o-t.x,t.y-n.y,i-t.y);return e>a?a:void 0},n.Rectangle.applyTransform=function(t){var e=t.rotation;if(0==e){var r=this.corner,o=this.extent,i=t.scale,a=r.applyTransform(t),s=o.times(i);return n.Rectangle.mk({corner:a,extent:s})}var c=this.corners(),u=c.map(function(e){return e.applyTransform(t)});return n.boundingRectangle(u)},n.Rectangle.transformTo=function(t){this.corner,t.corner;var e=this.center(),r=t.center(),o=this.width(),i=this.height(),a=t.width(),s=t.height(),c=a/o,u=s/i,h=Math.min(c,u),f=r.x-e.x*h,l=r.y-e.y*h,d=n.Transform.mk({translation:n.Point.mk(f,l),scale:h});return d},e.DNode.countShapes=function(){var t=1;return this.shapeTreeIterate(function(e){t+=e.countShapes()}),t},e.LNode.countShapes=e.DNode.countShapes,e.DNode.countNodes=function(){var t=1;return this.iterTreeItems(function(e){t+=e.countNodes()},!0),t},e.LNode.countNodes=e.DNode.countNodes,e.DNode.deepBounds=function(){if(this.style&&this.style.hidden)return void 0;var t=e.hasMethod(this,"bounds");if(t)var n=t.call(this);if(this.shapeTreeIterate(function(t){var e=t.deepBounds();if(e)if(n){n=n.extendBy(e);var r=n}else n=e,r=n}),!n)return n;var r=this.transform;return r?n.applyTransform(r):n},e.LNode.deepBounds=n.Shape.deepBounds}(__pj__),function(t){function e(t,n){n.__selected__?t.push(n):n.iterTreeItems(function(n){e(t,n)},!0)}function n(t){var e=s.rootTransform(),n=e.scale;s.setZoom(e,n*t),s.refresh()}function r(){u&&(n(cZoomFactor),setTimeout(r,f))}var o=t.om,i=t.dom,a=t.geom,s=t.set("draw",t.om.DNode.mk());s.__externalReferences__=[],s.viewerMode=0,s.theContext=void 0,s.hitContext=void 0,s.defaultLineWidth=1,s.hitCanvasDebug=0,s.computeBoundsEnabled=1,s.computeBoundsFromHitCanvas=0,s.hitCanvasEnabled=1,s.hitCanvasActive=1,s.dragEnabled=1,s.selectionEnabled=1,s.autoFit=0,s.panEnabled=1,s.set("Style",o.DNode.mk()).namedType(),s.Style.mk=function(t){return rs=Object.create(s.Style),rs.setProperties(t),rs},s.installType("Rgb"),s.mainCanvasActive=1,s.drawOps=o.DNode.mk(),s.drawOps.beginPath=function(){s.mainCanvasActive&&s.theContext.beginPath(),s.hitCanvasActive&&s.hitContext.beginPath()},s.test=function(){var t=s.theContext;t.fillStyle="rgba(255,0,0,1)",t.fillRect(25,25,100,100)},s.mainSaveDepth=0,s.hitSaveDepth=0,s.drawOps.save=function(){s.mainCanvasActive&&(s.theContext.save(),s.mainSaveDepth++,o.log("saveDepth","mainSaveDepth up",s.mainSaveDepth)),s.hitCanvasActive&&(s.hitContext.save(),s.hitSaveDepth++,o.log("saveDepth","hitSaveDepth up",s.hitSaveDepth))},s.drawOps.moveTo=function(t,e){if("number"==typeof t)var n=t,r=e;else var n=t.x,r=t.y;s.mainCanvasActive&&s.theContext.moveTo(n,r),s.hitCanvasActive&&s.hitContext.moveTo(n,r)},s.drawOps.lineTo=function(t,e){if("number"==typeof t)var n=t,r=e;else var n=t.x,r=t.y;s.mainCanvasActive&&s.theContext.lineTo(n,r),s.hitCanvasActive&&s.hitContext.lineTo(n,r)},s.drawOps.arc=function(t,e,n,r,o,i){s.mainCanvasActive&&s.theContext.arc(t,e,n,r,o,i),s.hitCanvasActive&&s.hitContext.arc(t,e,n,r,o,i)},s.drawOps.bezierCurveTo=function(t,e,n,r,o,i){s.mainCanvasActive&&s.theContext.bezierCurveTo(t,e,n,r,o,i),s.hitCanvasActive&&s.hitContext.bezierCurveTo(t,e,n,r,o,i)},s.drawOps.fillRect=function(t,e,n,r){s.mainCanvasActive&&s.theContext.fillRect(t,e,n,r),s.hitCanvasActive&&s.hitContext.fillRect(t,e,n,r)},s.drawOps.clearRect=function(t,e,n,r){s.mainCanvasActive&&s.theContext.clearRect(t,e,n,r),s.hitCanvasActive&&s.hitContext.clearRect(t,e,n,r)},s.drawOps.strokeRect=function(t,e,n,r){s.mainCanvasActive&&s.theContext.strokeRect(t,e,n,r),s.hitCanvasActive&&s.hitContext.strokeRect(t,e,n,r)},s.drawOps.restore=function(){s.mainCanvasActive&&(s.theContext.restore(),s.mainSaveDepth--,o.log("saveDepth","mainSaveDepth up",s.mainSaveDepth)),s.hitCanvasActive&&(s.hitContext.restore(),s.hitSaveDepth--,o.log("saveDepth","hitSaveDepth down",s.hitSaveDepth))},s.drawOps.stroke=function(){s.mainCanvasActive&&s.theContext.stroke(),s.hitCanvasActive&&s.hitContext.stroke()},s.drawOps.fill=function(){s.mainCanvasActive&&s.theContext.fill(),s.hitCanvasActive&&s.hitContext.fill()},s.drawOps.fillText=function(t,e,n){s.mainCanvasActive&&s.theContext.fillText(t,e,n),s.hitCanvasActive&&s.hitContext.fillText(t,e,n)},s.drawOps.measureText=function(t){return s.theContext.measureText(t)},s.Rgb.mk=function(t,e,n,r){var o=Object.create(s.Rgb);if("number"==typeof t)return o.r=t,o.g=e,o.b=n,"number"==typeof r&&(o.alpha=r),o;if("string"==typeof t){var i=e,a=/rgb\((\d*)\,(\d*)\,(\d*)\)$/,c=t.match(a);if(c)return s.Rgb.mk(parseInt(c[1]),parseInt(c[2]),parseInt(c[3]));if(i)return void 0;var a=/rgba\((\d*)\,(\d*)\,(\d*)\,(1|(?:\d*\.\d*))\)/,c=t.match(a);return c?s.Rgb.mk(parseInt(c[1]),parseInt(c[2]),parseInt(c[3]),parseFloat(c[4])):c}},s.Rgb.toString=function(){var t=this.alpha,e=this.r,n=this.g,r=this.b;return"number"==typeof t?"rgba("+e+","+n+","+r+","+t+")":"rgb("+e+","+n+","+r+")"},s.checkRgb=function(t){return o.check(t,"expected rgb(r,g,b)",function(t){var e=s.Rgb.mk(t,!0);return e?e.toString():void 0})},s.checkColor=function(t){return o.check(t,"expected a lower case color name, or rgb(r,g,b) or rgba(r,g,b,a)",function(t){var e=String(t),n=/^[a-z]+$/;if(e.match(n))return e;var r=s.Rgb.mk(t);return r?r.toString():void 0})},s.Style.setInputF("strokeStyle",s,"checkColor"),s.Style.setInputF("fillStyle",s,"checkColor"),s.randomRgb=function(){function t(){return Math.floor(255*Math.random())}return s.Rgb.mk(t(),t(),t()).toString()},s.randomColor=function(t,e,n){function r(t,e){return Math.floor(t+(e-t)*Math.random())}if("string"==typeof t)var o=s.Rgb.mk(t),i=s.Rgb.mk(e);else o=t,i=e;return s.Rgb.mk(r(o.r,i.r),r(o.g,i.g),r(o.b,i.b),n).toString()},s.indexToRgb=function(t){var e=30*t,n=256,r=e%n,o=Math.floor(e/n)%n,i=n*n,a=Math.floor(e/i)%n;return"rgba("+a+","+o+","+r+",1)"},s.rgbToIndex=function(t,e,n){var r=256,o=r*r;return n+r*e+o*t},o.DNode.setStrokeStyle=function(t){var e=this.get("__hitColor__");s.mainCanvasActive&&(s.theContext.strokeStyle=t),s.hitCanvasActive&&(s.hitContext.strokeStyle=e)},o.DNode.setLineWidth=function(t){return s.mainCanvasActive&&(s.theContext.lineWidth=t),s.hitCanvasActive&&(s.hitContext.lineWidth=Math.max(2,t)),!0},o.DNode.isSelected=function(){return this.get("__selected__")||this.get("__selectedPart__")},o.DNode.setFillStyle=function(t){var e=this.get("__hitColor__");s.mainCanvasActive&&(s.theContext.fillStyle=t),s.hitCanvasActive&&(s.hitContext.fillStyle=e)},s.drawOps.setFillStyle=function(t){s.mainCanvasActive&&(s.theContext.fillStyle=t),s.hitCanvasActive&&(s.hitContext.fillStyle="black")},s.drawOps.setFont=function(t){s.mainCanvasActive&&(s.theContext.font=t),s.hitCanvasActive&&(s.hitContext.font=t)};var c=s.drawOps;o.DNode.draw1d=function(t){var e=this.isSelected(),n=this.style;e&&(this.setStrokeStyle(s.highlightColor),this.setLineWidth(n.lineWidth+3),t()),this.setStrokeStyle(n.strokeStyle),this.setLineWidth(n.lineWidth),t()},o.DNode.draw2d=function(t,e){if(this.style){var n=this.style,r=n.fillStyle,o=n.strokeStyle,i=n.lineWidth;i||(i=1);var a=this.isSelected();r&&e&&(this.setFillStyle(r),e()),a&&t&&(this.setStrokeStyle(s.highlightColor),this.setLineWidth(i+2),t()),!t||!o||a&&r||(this.setStrokeStyle(o),this.setLineWidth(i),t())}},s.highlightColor="magenta",o.DNode.inWs=function(){if(this==s.wsRoot)return!0;var t=this.get("__parent__");return t?t.inWs():!1},o.LNode.inWs=o.DNode.inWs,o.DNode.select=function(t){if("canvas"==t&&o.unselect(),this.__selected__=1,this.deepSetProp("__selectedPart__",1),this.setPropForAncestors("__descendantSelected__",1,s.wsRoot),s.refresh(),"canvas"==t){this.expandToHere();var e=this.widgetDiv;e&&e.selectThisLine()}},o.LNode.select=o.DNode.select,s.mSelect=function(t){o.unselect(),t.forEach(function(t){t.select("tree")}),s.refresh()},s.allSelected=function(){var t=[];return e(t,s.wsRoot),t},o.DNode.unselect=function(){var t=this.__descendantSelected__;t&&(this.__descendantSelected__=0,this.__selected__&&(this.deepSetProp("__selectedPart__",0),this.__selected__=0),this.iterTreeItems(function(t){t.unselect()},!0))},o.LNode.unselect=o.DNode.unselect,o.unselect=function(){var t=s.wsRoot;t&&t.unselect()},s.clear=function(){var t=s.theCanvas.width(),e=s.theCanvas.height();c.clearRect(0,0,t,e)},s.setBkColor=function(){var t=s.theCanvas.width(),e=s.theCanvas.height(),n=s.theContext,r=s.hitContext;c.save(),s.mainCanvasActive&&(n.globalCompositeOperation="destination-over"),s.hitCanvasActive&&(r.globalCompositeOperation="destination-over"),s.mainCanvasActive&&(n.fillStyle=s.bkColor),s.hitCanvasActive&&(r.fillStyle="white"),c.fillRect(0,0,t,e),c.restore()},a.Transform.applyToContext=function(t){var e=this,n=e.translation;if(n)var r=n.x,o=n.y;var i=e.scale,a=e.rotation;n&&t.translate(r,o),i&&t.scale(i,i),"number"==typeof a&&t.rotate(a)},s.clearHitColors=function(){var t=s.shapesByHitColor;if(t)for(var e in t){var n=t[e];delete n.__hitColor__}s.shapesByHitColor={}},o.DNode.getTransform=function(){return this.get("transform")},o.LNode.getTransform=o.DNode.getTransform,o.DNode.deepDraw=function(t){if(t&&s.clearHitColors(),!this.style||!this.style.hidden){var e=this.getTransform();if(e){var n=s.theContext,r=s.hitContext;c.save(),s.mainCanvasActive&&e.applyToContext(n),s.hitCanvasActive&&e.applyToContext(r)}var i=o.hasMethod(this,"draw");if(i){if(this.style){var a=this.get("__hitColor__");a||(this.__hitColor__=a=s.randomRgb(),s.shapesByHitColor[a]=this);var u=this.draw;u.call(this)}}else this.shapeTreeIterate(function(t){o.isNode(t)&&t.deepDraw()});e&&c.restore()}},o.LNode.deepDraw=function(){var t=this.getTransform();if(t){alert("TRANSORM of LNODE");var e=s.theContext;c.save(),s.mainCanvasActive&&t.applyToContext(e)}this.shapeTreeIterate(function(t){o.isNode(t)&&t.deepDraw()}),t&&c.restore()},s.relCanvas=function(t,e){var n=t.offset();e.clientX-n.left,e.clientY-n.top;var r=e.pageX-n.left,o=e.pageY-n.top;return a.Point.mk(r,o)},s.dataDim=15,s.hitImageData=function(t){var e=Math.floor(s.dataDim/2);return s.hitContext.getImageData(t.x-e,t.y-e,s.dataDim,s.dataDim)},s.hitDim=400,s.hitDivs=40,s.computeBounds1=function(){function t(t,e,n){var r=4*(n*h+e);return 0==t[r]&&0==t[r+1]&&0==t[r+2]&&0==t[r+3]}var e=1/0,n=-1/0,r=1/0,o=-1/0,i=s.hitDim,c=s.hitDim,u=s.hitDivs,h=i/u,f=c/u;for(qx=0;u>qx;qx++)for(qy=0;u>qy;qy++)for(var l=qx*h,d=qy*f,p=s.hitContext.getImageData(l,d,h,f),_=p.data,v=0;h>v;v++)for(var m=0;f>m;m++){var g=t(_,v,m);if(!g){var y=v+l,N=m+d;e>y&&(e=y),y>n&&(n=y),r>N&&(r=N),N>o&&(o=N)}}return 1/0==e?void 0:a.Rectangle.mk({corner:[e,r],extent:[n-e,o-r]})},s.boundsTransform=a.Transform.mk({scale:.2,translation:[s.hitDim/2,s.hitDim/2]}),s.boundsTransformI=s.boundsTransform.inverse(),s.defaultBounds=a.Rectangle.mk({corner:[0,0],extent:[1e3,1e3]}),s.computeBounds=function(){var t=s.wsRoot;if(!s.computeBoundsFromHitCanvas){var e=t.deepBounds();return e?e:s.defaultBounds}if(!s.hitCanvasActive||!s.computeBoundsEnabled)return s.defaultBounds;t.transform,t.set("transform",s.boundsTransform),s.hitCanvas.attr({width:s.hitDim,height:s.hitDim}),s.mainCanvasActive=0,s.refresh();var n=s.computeBounds1(),r=t.deepBounds();if(o.log("draw","bounds from image ",n,"bounds from computation ",r),s.mainCanvasActive=1,s.hitCanvas.attr({width:s.canvasWidth,height:s.canvasHeight}),n)var n=n.applyTransform(s.boundsTransformI);else n=s.defaultBounds;return n},s.fitTransform=function(t){var e=t.deepBounds();if(e)return s.fitIntoCanvas(e,.95)},s.fitContents=function(){if(s.autoFit){var t=s.computeBounds();if(t){var e=s.fitIntoCanvas(t,.95);s.wsRoot.set("transform",e)}}},s.fitIntoPage=function(){var t=s.computeBounds();s.canvasWidth=$(window).width(),s.canvasHeight=$(window).height();var e=s.fitIntoCanvas(t,.8);s.wsRoot.set("transform",e),s.refresh()},s.refPoint=null,s.interpretedImageData=[],o.nodeMethod("draggableAncestor",function(){return this==t?void 0:this.draggable?this:this.__parent__.draggableAncestor()}),o.nodeMethod("uncomputedAncestor",function(){return this.isComputed()?this.__parent__.uncomputedAncestor():this}),s.interpretImageData=function(e){for(var n=e.length/4,r=s.dataDim,i=Math.floor(r/2),c=1/0,u=0;n>u;u++){var h=u%r-i,f=Math.floor(u/r)-i,l=h*h+f*f;if(c>l){var d=4*u,p=e[d],_=e[d+1],v=e[d+2],m=s.Rgb.mk(p,_,v).toString(),g=s.shapesByHitColor[m];if(g){if(a.Text.isPrototypeOf(g))return g;var y=g;c=l,o.log("untagged","cdist ",g.pathOf(t),c)}}}return y},s.rootTransform=function(){var t=s.wsRoot;if(t){var e=t.transform;return e||(e=a.Transform.mk(),t.set("transform",e)),e}},s.setZoom=function(t,e){var n=a.Point.mk(s.canvasWidth/2,s.canvasHeight/2),r=t.applyInverse(n);t.scale=e;var o=n.x-r.x*e,i=n.y-r.y*e,c=t.translation;c.x=o,c.y=i},s.adjustTransform=function(t,e){if(t){var n=Math.min(e.x,e.y),r=Math.min(s.canvasWidth,s.canvasHeight),o=t.scale,i=o*r/n,a=e.times(.5),c=t.applyInverse(a),u=.5*s.canvasWidth,h=.5*s.canvasHeight,f=u-c.x*i,l=h-c.y*i,d=t.translation;d.x=f,d.y=l,t.scale=i,c.applyTransform(t)}},s.init=function(){if(s.hitCanvasActive&&!s.hitCanvasDebug&&s.hitCanvas.css({display:"none"}),s.selectionEnabled||s.panEnabled){s.theCanvas.__element__.mousedown(function(t){i.unpop();var e=s.relCanvas(s.theCanvas.__element__,t);o.log("untagged","relCanvas",e.x,e.y),s.refPoint=e;var n=s.rootTransform(),r=n.translation;if(s.refTranslation=a.Point.mk(r.x,r.y),o.log("untagged",e.x,e.y),s.selectionEnabled){var c=s.hitImageData(e),u=c.data,h=s.interpretImageData(u);if(o.log("drag","SELECTED ",h),u=void 0,h){if(o.log("drag","selected",h.__name__),h.select("canvas"),s.dragEnabled&&h){var f=h.draggableAncestor();o.log("drag","DRAGGING ",f),f?(s.dragees=[f],s.refPos=[f.toGlobalCoords()],o.log("drag","refPos",s.refPos)):s.dragees=void 0}}else if(o.log("drag","No shape selected"),s.dragEnabled&&!s.panEnabled){var l=s.allSelected(),d=[],p=[];l.forEach(function(t){t.draggable&&(d.push(t),p.push(t.toGlobalCoords()))}),d.length?(s.dragees=d,s.refPos=p):s.dragees=void 0}if(s.dragEnabled&&(s.tree_of_selections=s.wsRoot.treeOfSelections()),s.dragees){var _="";s.dragees.forEach(function(t){_+=" "+t.__name__}),o.log("drag","starting drag of ",_)}}});var e=function(t){if(o.log("drag","doMove"),s.dragees)for(var e=s.relCanvas(s.theCanvas.__element__,t),n=e.difference(s.refPoint),r=s.dragees.length,i=0;r>i;i++){var a=s.dragees[i],c=s.refPos[i],u=c.plus(n);
o.log("drag",a.__name__,"delta",n,"npos",u),a.moveto(u);var h=a.transform;h.translation.transferToOverride(s.overrides,s.wsRoot,["x","y"]),h.transferToOverride(s.overrides,["scale","rotation"])}},n=function(t){var e=s.relCanvas(s.theCanvas.__element__,t),n=e.difference(s.refPoint);o.log("drag","doPan",n.x,n.y);var r=s.rootTransform(),i=r.translation;r.scale,i.x=s.refTranslation.x+n.x,i.y=s.refTranslation.y+n.y},r=function(){o.log("drag","mouseup"),s.refPoint=void 0,s.dragees=void 0,s.wsRoot&&(s.viewerMode||(s.wsRoot.deepUpdate(s.overrides),s.fitContents(),t.tree.adjust()),s.refresh())};s.theCanvas.__element__.mouseup(r),s.theCanvas.__element__.mouseleave(r),s.theCanvas.__element__.mousemove(function(t){s.dragees?(e(t),s.wsRoot.deepUpdate(s.overrides,s.tree_of_selections)):s.panEnabled&&s.refPoint&&n(t),s.refresh()})}},s.bkColor="rgb(10,10,30)",s.refresh=function(t){if(!t&&(s.clear(),s.mainCanvasActive&&s.theContext)){c.save();var e=s.theContext;if(s.wsRoot)var n=s.wsRoot.backgroundColor;n||(n=s.bkColor),e.fillStyle=n;var r=s.theCanvas.__element__.width(),o=s.theCanvas.__element__.height();e.fillRect(0,0,r,o),c.restore()}s.wsRoot&&s.wsRoot.deepDraw(1)},s.postFrame=function(t,e,n){this.theCanvas;var r=canvas.toDataURL("image/jpeg"),i="/api/addFrame",a={movie:t,frameNum:e,jpeg:r};o.log("untagged","posting Frame ",e),o.post(i,a,function(t){o.log("untagged","POSTED"),n&&n(t)})},s.postCanvas=function(t,e){this.theCanvas;var n=canvas.toDataURL("image/jpeg"),r="/api/postCanvas",i={path:t,jpeg:n};o.log("untagged","posting Frame ",t),o.ajaxPost(r,i,function(t){o.log("untagged","POSTED"),e&&e(t)})},s.emptyWs=function(e,n){if(n){var r=n.width,o=n.height,i=n.offset;if(i)var c=i.x,u=i.y;else c=0,u=0}var h=s.wsRoot=a.Shape.mk();if(t.set(e,h),n){var f=a.mkTranslation(a.Point.mk(c+r/2,u+o/2));h.set("transform",f),n.scale&&(f.scale=n.scale)}return h},s.clearWs=function(){var e=s.wsRoot;if(e){var n=e.__name__;delete t.top[n]}},s.update=function(){o.deepUpdate(o.root)},o.DNode.visibleProtoEffects1=function(t,e,n){if(o.hasMethod(this,"draw")){var r=void 0!==n;r?this.treeInheritsPropertyFrom(e,n)&&t.push(this):this.treeInheritsSomePropertyFrom(e)&&t.push(this)}else this.iterTreeItems(function(r){r.visibleProtoEffects1(t,e,n)},!0)},o.LNode.visibleProtoEffects1=o.DNode.visibleProtoEffects1,o.DNode.visibleProtoEffects=function(t){var e=[];return s.wsRoot.visibleProtoEffects1(e,this,t),e},o.DNode.drawnAncestor=function(){for(var t=this,e=void 0;t!==s.wsRoot;)o.hasMethod(t,"draw")&&(e=t),t=t.__parent__;return e},o.LNode.drawnAncestor=o.DNode.drawnAncestor,o.DNode.drawnDescendants1=function(t){return o.hasMethod(this,"draw")?(t.push(this),void 0):(this.iterTreeItems(function(e){e.drawnDescendants1(t)},!0),void 0)},o.LNode.drawnDescendants1=o.DNode.drawnDescendants1,o.DNode.drawnDescendants=function(){var t=[];return this.drawnDescendants1(t),t},o.LNode.drawnDescendants=o.DNode.drawnDescendants,s.fitIntoCanvas=function(t,e){var n=a.Point.mk(s.canvasWidth,s.canvasHeight).toRectangle().scaleCentered(e),r=t.transformTo(n);return r},o.DNode.hide=function(){var t=this.style;if(!t)var t=this.set("style",o.DNode.mk());return t.hidden=1,this},o.DNode.show=function(){var t=this.style;return t&&(t.hidden=0),this},s.animateStep=function(){var t=s.wsRoot.step;t&&"function"==typeof t&&(t(),s.refresh())},s.animate=function(){var t=s.wsRoot.framesPerSecond,e=s.wsRoot.frameCount,n=s.wsRoot.initialState(),r=0,o=1e3/t,i=function(){r+=1,e&&r>e||(n=s.wsRoot.step(n),s.refresh(),setTimeout(i,o))};i()},s.manimd=500,s.manimate=function(t){0!=t&&(s.animate(),setTimeout(function(){s.manimate(t-1)},s.manimd))};var u=!1,h=1.1,f=150;s.startZooming=function(){cZoomFactor=h,u||(u=1,r())},s.startUnZooming=function(){cZoomFactor=1/h,u||(u=1,r())},s.stopZooming=function(){u=0}}(__pj__),function(t){var e=t.om,n=t.geom,r=t.draw,o=r.drawOps;n.Point.setInputF("x",e,"checkNumber"),n.Point.setInputF("y",e,"checkNumber"),n.Transform.setInputF("scale",e,"checkPositiveNumber"),n.set("Line",n.Shape.mk()).namedType(),n.Line.set("style",r.Style.mk({strokeStyle:"black",lineWidth:1})),r.Style.setInputF("lineWidth",e,"checkPositiveNumber"),n.Line.mk=function(t){var e=n.toPoint(t.e0),r=n.toPoint(t.e1),o=n.Line.instantiate();return o.set("e0",e),o.set("e1",r),o.style.setProperties(t.style),o},n.Line.setTo=function(t){this.e0.setTo(t.e0),this.e1.setTo(t.e1)},n.Line.pathLength=function(){var t=this.e0,e=this.e1;return t.distance(e)},n.Line.pathPosition=function(t){var e=this.e0,n=this.e1,r=n.difference(e),o=r.times(t);return e.plus(o)},n.Line.pointAtDistance=function(t){var e=this.pathLength(),n=t/e;return this.pathPosition(n)},n.distanceToLine=function(t,e,n){var r=n.difference(t),o=e.difference(t),i=r.dotp(o);if(0>=i)return n.distance(t);var a=n.difference(e),s=a.dotp(o);if(s>=0)return n.distance(e);var c=o.normal().normalize(),u=Math.abs(r.dotp(c));return u},n.Line.draw=function(){var t=this.e0,e=this.e1,n=function(){o.beginPath(),o.moveTo(t.x,t.y),o.lineTo(e.x,e.y),o.stroke()};o.save(),this.draw1d(n),o.restore()},n.Rectangle.set("style",r.Style.mk({strokeStyle:"black",fillStyle:"red",lineWidth:1})),n.Rectangle.draw=function(){var t=this.style;if(t){var e=this.corner,n=this.extent,r=n.x,i=n.y,a=e.x,s=e.y;o.save();var c=function(){o.strokeRect(a,s,r,i)},u=function(){o.fillRect(a,s,r,i)};this.draw2d(c,u),o.restore()}},n.Rectangle.bounds=function(){return this},n.set("BezierSegment",n.Shape.mk()).namedType(),n.set("Bezier",n.Shape.mk()).namedType(),n.Bezier.set("style",r.Style.mk({strokeStyle:"black",lineWidth:1})),n.Bezier.draw=function(){var t=this.segments;if(t){var e=this.startPoint,n=t.length,r=function(){o.beginPath(),o.moveTo(e.x,e.y);for(var r=0;n>r;r++){var i=t[r],a=i.cp1,s=i.cp2,c=i.dest;o.bezierCurveTo(a.x,a.y,s.x,s.y,c.x,c.y)}o.stroke()};o.save(),this.draw1d(r),o.restore()}},n.set("Arc",n.Shape.mk()).namedType(),n.Arc.set("style",r.Style.mk({strokeStyle:"black",lineWidth:1})),n.Arc.radius=100,n.Arc.startAngle=0,n.Arc.endAngle=2*Math.PI,n.mkArcFromEndPoints=function(t,e,r){var o=e.difference(t),i=.5*o.length(),a=Math.sqrt(r*r-i*i);0>r&&(a=-a);var s=o.normalize(),c=s.normal(),u=t.plus(o.times(.5)),h=u.plus(c.times(a)),f=t.difference(h),l=e.difference(h),d=n.angle2normalRange(Math.atan2(f.y,f.x)),p=n.angle2normalRange(Math.atan2(l.y,l.x)),_=n.Arc.instantiate();return _.startAngle=d,_.endAngle=p,_.set("center",h),_.radius=Math.abs(r),_},n.Arc.mk=function(t){var e=n.Arc.instantiate();return e.setProperties(t,["startAngle","endAngle","radius"]),e.style.setProperties(t.style),e.setPoint("center",t.center),e},n.degreesToRadians=function(t){return Math.PI*(t/180)},n.radiansToDegrees=function(t){return 180*(t/Math.PI)},n.Arc.bounds=function(){for(var t=this.startAngle,e=this.endAngle,r=e-t,o=5,i=r/o,a=this.center,s=[],c=this.radius,u=0;o>u;u++){var h=t+u*i,f=n.Point.mk(Math.cos(h),Math.sin(h)),l=a.plus(f.times(c));s.push(l)}var d=n.boundingRectangle(s);return d},n.checkAngle=function(t){return e.check(t,"expected number in units of degrees",function(){return isNaN(t)?void 0:n.degreesToRadians(t)})},e.DNode.degreesField=function(t){this.setInputF(t,n,"checkAngle"),this.setOutputF(t,n,"radiansToDegrees")},n.Arc.degreesField("startAngle"),n.Arc.degreesField("endAngle"),n.Arc.setInputF("radius",e,"checkPositiveNumber"),n.Arc.pathLength=function(){var t=this.startAngle,e=this.endAngle,n=this.radius,r=Math.abs(e-t)*n;return r},n.Arc.pathPosition=function(t){var e=this.center,r=n.angle2normalRange(this.startAngle),o=n.angle2normalRange(this.endAngle),i=this.radius,a=t*(o-r),s=r+a,c=n.Point.mk(i*Math.cos(s),i*Math.sin(s)).plus(e);return c},n.angle2normalRange=function(t){if(t==2*Math.PI)return t;var e=2*Math.PI;if(0>t){var n=Math.floor(-t/e);t+=(n+1)*e}return t%e},n.angleIsBetween=function(t,e,r){var o=n.angle2normalRange(t-e),i=n.angle2normalRange(r-e);return i>o},n.Arc.draw=function(){var t=this.startAngle,e=this.endAngle,n=this.radius,r=this.center;if(r)var i=r.x,a=r.y;else i=0,a=0;var s=function(){o.beginPath(),o.arc(i,a,n,t,e,e>t?0:1),o.stroke()};o.save(),this.draw1d(s),o.restore()},n.set("Circle",n.Arc.instantiate()).namedType(),n.Circle.setf("startAngle",0),n.Circle.setf("endAngle",2*Math.PI),n.Circle.mk=function(t){var e=n.Circle.instantiate();return e.setProperties(t,["radius"]),e.style.setProperties(t.style),e.setPoint("center",t.center),e},n.Circle.xIntercepts=function(t,e){t||(t=0);var n=this,r=n.center,o=n.radius+e,i=r.x,a=r.y-t,s=Math.abs(a);if(s>o)return[];var c=Math.sqrt(o*o-a*a);return[i-c,i+c]},n.Circle.containsPoint=function(t){var e=this.center,n=this.radius,r=e.distance(t);return n>=r},n.Circle.draw=function(){if(0!=this.radius){var t=this.radius,e=this.center;if(e)var n=e.x,r=e.y;else n=0,r=0;var i=function(){o.beginPath(),o.arc(n,r,t,0,2*Math.PI,0),o.stroke()},a=function(){o.beginPath(),o.arc(n,r,t,0,2*Math.PI,0),o.fill()};o.save(),this.draw2d(i,a),o.restore()}},n.set("Text",n.Shape.mk()).namedType(),n.Text.set("style",r.Style.mk({align:"center",font:"arial",height:10})),n.Text.style.setInputF("height",e,"checkPositiveNumber"),n.Text.mk=function(t){var e=n.Text.instantiate();return e.text=t.text,t.pos?e.set("pos",n.toPoint(t.pos)):e.set("pos",n.Point.mk()),e.style.setProperties(t.style),e},n.Text.draw=function(){var t=this.pos,e=this.style,n=e.font,i=e.height,a=e.align;i&&(n=i+"px "+n);var s=this.text,c=this.isSelected();if(o.save(),o.setFont(n),c||"center"==a)var u=o.measureText(s).width;if("center"==a)var h=t.x-.5*u;else h=t.x;c&&(this.setFillStyle(r.highlightColor),o.fillRect(h,t.y-i,u,Math.floor(1.4*i))),this.setFillStyle(e.fillStyle),o.fillText(s,h,t.y),o.restore()}}(__pj__),"undefined"==typeof __pj__)var __pj__={};!function(t){var e=t.om,n=t.page;n.genButtons=function(t,r){function o(e,n){var r=$('<div class="button">'+e+"</div>");return t.append(r),r.click(function(){location.href=n}),r}if(toExclude=r.toExclude,o("GitHub","https://github.com/chrisGoad/prototypejungle"),"build"!=toExclude&&o("Build","/build"),"tech"!=toExclude&&o("Tech Docs","/tech"),"about"!=toExclude&&o("About","/about"),"sign_in"!=toExclude){n.logoutButton=o("logout","/logout"),n.signInButton=o("Sign in","/sign_in");var i=e.storage?e.storage.sessionId:null;i?n.signInButton.hide():n.logoutButton.hide()}},n.genTopbar=function(t,e){t.empty(),t.append($('<div id="topbarOuter" style="padding-bottom:30px"><div id = "topbarInner" style="float:right;"></div>'));var r=$("#topbarInner");e.includeTitle&&n.genMainTitle($("#topbarOuter"),"Prototype Jungle"),n.genButtons(r,e)},n.genMainTitle=function(t,e){var n=$('<span class="mainTitle">'+e+"</span>");n.css({cursor:"pointer"}),t.append(n),n.click(function(){location.href="/"})},n.logout=function(){e.log("util","page.logout"),n.logoutButton.hide(),n.signInButton.show(),e.clearStorageOnLogout()}}(__pj__),function(t){t.om;var e=t.page;e.genError=function(t){e.errorOccurred||(e.genTopbar($("#topbar"),{includeTitle:1}),e.elementsToHideOnError.forEach(function(t){t.hide()}),e.errorOccurred=1,$("#error").show(),$("#error").html(t))}}(__pj__);