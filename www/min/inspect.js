var __pj__=function(){var t={};if(!Object.create){var e={};return e.om={},e.page={},e}var e=Object.create(t),n=Object.create(t);return n.DNode=t,e.om=n,e.page=Object.create(t),n.storage=localStorage,e}();if(function(t){var e=t.om,n=t.page,r=[],o=e.DNode;e.LNode=r,e.isDev=location.href.indexOf(":8000")>0,e.mapUrlToDev=function(t){return e.isDev&&0==t.indexOf("http://prototypejungle.org/")?"http://prototypejungle.org:8000"+t.substr(26):t},e.__parent__=t,e.__name__="om",o.__parent__=e,o.__name__="DNode",r.__parent__=e,r.__name__="LNode",n.__parent__=t,n.__name__="page",e.activeConsoleTags=["error"],e.itemHost="http://s3.prototypejungle.org",e.argsToString=function(t){if("undefined"==typeof console)return"";for(var e=[],n=t.length,r=0;n>r;r++)e.push(t[r]);return e.join(", ")},e.slog1=function(t){"undefined"!=typeof console&&console.log("SLOG1",t)},e.slog=function(){var t=e.argsToString(arguments);e.slog1(t)},e.startTime=Date.now()/1e3,e.resetClock=function(){e.startTime=Date.now()/1e3},e.elapsedTime=function(){var t=Date.now()/1e3,n=t-e.startTime;return Math.round(1e3*n)/1e3},e.tlog=function(){if("undefined"!=typeof console){for(var t=[],n=Date.now()/1e3,r=n-e.startTime,o=arguments.length,i=0;o>i;i++)t.push(arguments[i]);r=Math.round(1e3*r)/1e3;var a="AT "+r+": "+t.join(", ");console.log(a)}},e.log=function(t){if("undefined"!=typeof console&&($.inArray("all",e.activeConsoleTags)>=0||$.inArray(t,e.activeConsoleTags)>=0))if("undefined"==typeof window)system.stdout(t+JSON.stringify(arguments));else{for(var n=[],r=arguments.length,o=0;r>o;o++)n.push(arguments[o]);console.log(t,n.join(", "))}},e.error=function(){for(var t=[],e=arguments.length,n=0;e>n;n++)t.push(arguments[n]);throw console.log(t.join(", ")),"error"},e.ajaxPost=function(t,n,r,o){if("string"==typeof n)a=n;else{var i=e.storage.sessionId;i&&(n.sessionId=i,n.userName=e.storage.userName);var a=JSON.stringify(n)}o||(o=function(t,e){alert("ERROR (INTERNAL) IN POST "+e)}),$.ajax({url:t,data:a,cache:!1,contentType:"application/json",type:"POST",dataType:"json",success:r,error:o})},e.ajaxGet=function(t,e,n){var r={url:t,cache:!1,contentType:"application/json",type:"GET",dataType:"json",success:e};n&&(r.error=n),r.error=function(t,e){alert("ERROR (INTERNAL) IN get "+e)},$.ajax(r)},e.runCallbacks=function(t){if(void 0!=t){var n=arguments,r=[],o=n.length;for(i=1;o>i;i++)r.push(n[i]);e.arrayForEach(t,function(t){t.apply(void 0,r)})}},e.pathLast=function(t){if("string"==typeof t){var e=t.lastIndexOf("/");return t.substr(e+1)}return t[t.length-1]},e.pathExceptLast=function(t){if("string"==typeof t){var e=t.lastIndexOf("/");return t.substr(0,e+1)}var n=t.concat();return n.pop(),n},e.toInt=function(t){var e=parseFloat(t);return 0==e%1?e:void 0},e.removeFromArray=function(t,e){var n=[];return t.forEach(function(t){t!=e&&n.push(t)}),n},e.getScript=function(t,n){e.log("util","About to load ",t),$.ajax({crossDomain:!0,dataType:"script",url:t,success:function(){e.log("util","loaded ",t),n&&n()}})},e.parseQuerystring=function(){var t={},e=window.location.search.replace("?",""),n=e.split("&");return $.each(n,function(e,n){var r=n.split("=");r.length>1&&(t[r[0]]=r[1])}),t},e.nDigits=function(t,e){if("number"!=typeof t)return t;var n=String(t),r=n.indexOf(".");if(0>r)return n;var o=n.length;if(e>=o-r-1)return n;var i=n.substring(0,r),a=n.substring(r+1,r+e+1);return i+"."+a},e.toType=function(t){return{}.toString.call(t).match(/\s([a-zA-Z]+)/)[1].toLowerCase()},e.mkLink=function(t){return'<a href="'+t+'">'+t+"</a>"},e.mkCapLink=function(t,n){return"<div class='linkLine'><div class='caption'>"+t+"</div>"+e.mkLink(n)+"</div>"},e.mkEmbed=function(t){return'&lt;iframe width="500" height="500" src="'+t+'"&gt;\n '},e.mkLinks=function(t,n){var r=t.repo;e.itemHost;var o=e.itemHost+r,i=o+t.code,a=o+t.data,s=t.url,c=location.host,u="http://"+c+"/inspect?item="+s,h=s,l="<div class='links'>";return l+=e.mkCapLink("To inspect the item you just "+n+":",u),l+=e.mkCapLink("To view the item you just "+n+" (Developers: use this in code depdendencies too):",h),l+="<div class='embed'>",l+="<p>To embed the item you just "+n+":</p>",l+=e.mkEmbed(s),l+="<p>(adjust width and height to taste)</p>",l+="</div>",l+=e.mkCapLink("The JSON that describes the structure of this item:",a),l+=e.mkCapLink("The JavaScript functions associated with this item:",i)},e.check=function(t,e,n){var r=n(t);return void 0===r?{error:1,message:"<center><span class='errorTitle'>Error</span>: "+e+"</center>"}:r},e.checkNumber=function(t){return e.check(t,"expected number.",function(e){return isNaN(e)?void 0:parseFloat(t)})},e.checkInteger=function(t){return e.check(t,"expected integer.",function(e){if(isNaN(e))return void 0;var n=parseFloat(t);return 0==n%1?n:void 0})},e.checkPositiveInteger=function(t){return e.check(t,"expected positive integer.",function(e){if(isNaN(e))return void 0;var n=parseFloat(t);return n>0&&0==n%1?n:void 0})},e.checkPositiveNumber=function(t){return e.check(t,"expected positive number.",function(e){if(isNaN(e))return void 0;var n=parseFloat(t);return n>0?n:void 0})},e.checkNonNegative=function(t){return e.check(t,"expected non-negative number.",function(e){if(isNaN(e))return void 0;var n=parseFloat(t);return n>=0?n:void 0})},e.checkBoolean=function(t){return e.check(t,"No failure possible",function(t){if("false"==t)var e=0;else e=t?1:0;return e})},e.toBooleanOut=function(t){return t?"true":"false"},e.DNode.booleanField=function(t){this.setInputF(t,e,"checkBoolean"),this.setOutputF(t,e,"toBooleanOut")};var a={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};e.escapeHtml=function(t){return String(t).replace(/[&<>"'\/]/g,function(t){return a[t]})},e.afterChar=function(t,e){var n=t.indexOf(e);return 0>n?t:t.substr(n+1)},e.beforeChar=function(t,e){var n=t.indexOf(e);return 0>n?t:t.substr(0,n)},e.endsIn=function(t,e){var n=t.length,r=e.length;if(r>n)return!1;var o=t.substr(n-r);return o==e},e.mainName=function(t){var n=e.beforeChar(t,"_"),r=e.afterChar(t,"_");return"persona"==n?e.beforeChar(r,"@"):r},e.checkName=function(t){return""==t?!1:!!t.match(/^(?:|_|[a-z]|[A-Z])(?:\w|-)*$/)},e.checkPathName=function(t){var e=t.split("/"),n=e.length;if(0==n)return!1;for(var r=0;n>r;r++)if(!checkName(e[r]))return!1;return!0},e.setOnEnter=function(t,e){t.keyup(function(t){13==t.keyCode&&e(t)})},e.disableBackspace=function(){var t=/INPUT|SELECT|TEXTAREA/i;$(document).bind("keydown keypress",function(e){8==e.which&&(!t.test(e.target.tagName)||e.target.disabled||e.target.readOnly)&&e.preventDefault()})},e.clearStorageOnLogout=function(){e.storage.removeItem("sessionId"),e.storage.removeItem("userName"),e.storage.removeItem("handle"),e.storage.removeItem("signingInWithTwitter"),e.storage.removeItem("twitterToken"),e.storage.removeItem("lastPrefix"),e.storage.removeItem("lastBuildUrl"),e.storage.removeItem("email")},e.checkSession=function(t){e.storage.sessionId?e.ajaxPost("/api/checkSession",{},function(n){e.log("util","checked session; result:",JSON.stringify(n)),"fail"==n.status&&e.clearStorageOnLogout(),t(n)}):t({status:"fail",msg:"noSession"})}}(__pj__),function(t){function e(t,e,n){i.isNode(n)?(n.__name__=e,n.__parent__=t):n&&"object"==typeof n&&i.error('Only Nodes and atomic values can be set as children in <Node>.set("'+e+'",<val>)')}function n(t,n,r){e(t,n,r),t[n]=r}function r(t,e,n){if(e!=n){var o=Object.getOwnPropertyNames(e);o.forEach(function(e){i.internal(e)||(t[e]=1)}),r(t,Object.getPrototypeOf(e),n)}}function o(t,e){var n=i.getMethod(t,"update");n?n.call(t,e):t.iterTreeItems(function(t){if(e){var n=t.__name__,r=e[n];"object"!=typeof r&&(r=void 0)}o(t,r)},!0)}function r(t,e,n){if(e!=n){var o=Object.getOwnPropertyNames(e);o.forEach(function(e){i.internal(e)||(t[e]=1)}),r(t,Object.getPrototypeOf(e),n)}}var i=t.om;i.__externalReferences__=[],i.isObject=function(t){return t&&"object"==typeof t},i.isAtomic=function(t){return!i.isObject(t)},i.isNode=function(t){return i.DNode.isPrototypeOf(t)||i.LNode.isPrototypeOf(t)},i.nodeMethod=function(t,e){i.LNode[t]=i.DNode[t]=e},i.nodeMethod("createDescendant",function(t){var e=this;return t.forEach(function(n){if(""!=n){i.checkName(n)||i.error('Ill-formed name "'+n+'". Names may contain only letters, numerals, and underbars, and may not start with a numeral');var r=e[n];if(void 0===r){var o=i.DNode.mk();e.set(n,o),e=o}else e.hasOwnProperty(n)||i.error("Conflict in createDescencant",t.join("/")),i.isNode(r)||i.error("Conflict in createDescendant ",t.join("/")),e=r}}),e}),i.nodeMethod("computed",function(){return this.__computed__=1,this}),i.nodeMethod("mfreeze",function(t){return"string"==typeof t?this.setFieldStatus(t,"mfrozen"):this.__mfrozen__=1,this}),i.DNode.set=function(t,e,r){if("string"==typeof t)var o=t.indexOf("/");else o=-1;if(o>=0)var a=t.split("/"),s=a.pop(),c=this.createDescendant(a);else c=this,s=t;return i.checkName(s)||i.error('Ill-formed name "'+s+'". Names may contain only letters, numerals, and underbars, and may not start with a numeral'),n(c,s,e),"mfrozen"==r&&c.mfreeze(s),e},i.LNode.set=function(t,e){return n(this,t,e),e},i.LNode.pushChild=function(t){var n=this.length;e(this,n,t),this.push(t)},i.DNode.setf=function(t,e){return this.set(t,e,"mfrozen")},i.DNode.setN=function(t,e){return e?this.set(t,i.toNode(e)):void 0},i.DNode.setIfMissing=function(t){return void 0===this[t]&&this.set(t,i.DNode.mk()),this[t]},i.DNode.mk=function(){return Object.create(i.DNode)},i.LNode.mk=function(t){var e=Object.create(i.LNode);if(void 0==t)return e;for(var n=t.length,r=0;n>r;r++){var o=t[r];o.__parent__=e,o.__name__=""+r,e.push(o)}return e},i.mkLNode=i.LNode.mk,t.set("anon",i.DNode.mk()),i.toNode1=function(t,e,n){var r=typeof n;if(null===n||"object"!=r)return t[e]=n,void 0;if(i.isNode(n))var o=n;else if(Array.isArray(n))var o=i.toLNode(n,null);else var o=i.toDNode(n,null);o.__parent__=t,o.__name__=e,t[e]=o},i.toDNode=function(t,e){if(i.DNode.isPrototypeOf(t))return t;if(e)var n=e;else var n=i.DNode.mk();for(k in t)if(t.hasOwnProperty(k)){var r=t[k];i.toNode1(n,k,r)}return n},i.toLNode=function(t,e){if(e)var n=e;else n=i.LNode.mk();return t.forEach(function(t){n.pushChild(i.toNode(t))}),n},i.toNode=function(t){return Array.isArray(t)?i.toLNode(t):t&&"object"==typeof t?i.toDNode(t):t},i.lift=i.toNode,i.DNode.iterItems=function(t){for(var e in this)this.hasOwnProperty(e)&&!i.internal(e)&&t(this[e],e);return this},i.DNode.ownProperties=function(){var t=Object.getOwnPropertyNames(this),e=[];return t.forEach(function(t){i.internal(t)||e.push(t)}),e},i.DNode.properties=function(t){var e={};r(e,this,t?t:i.DNode);var n=[];for(var o in e)n.push(o);return n},i.DNode.iterTreeItems=function(t,e){var n=Object.getOwnPropertyNames(this),r=this;return n.forEach(function(n){r.treeProperty(n,e)&&t(r[n],n)}),this},i.DNode.iterInheritedItems=function(t,e,n){function r(n){var r=o[n];!e&&"function"==typeof r||i.internal(n)||t(r,n)}var o=this,a=this.properties();return n&&a.sort(),a.forEach(r),this},i.DNode.iterInheritedTreeItems=function(t,e){for(var n in this)this.inheritedTreeProperty(n)&&t(this[n],n);if(!e)return this;var r=this;return e.forEach(function(e){if(r.treeProperty(e)){var n=r[e];t(n,e)}}),this},i.LNode.iterItems=function(t){return this.forEach(t),this},i.LNode.iterTreeItems=function(t,e){var n=this;return this.forEach(function(r,o){n.treeProperty(o,e)&&t(r,o)}),this},i.LNode.iterInheritedItems=function(t){return this.forEach(t),this},i.DNode.iterValues=function(t){var e=!1;for(var n in this)this.treeProperty(n)&&t(this[n])&&(e=!0);return e},i.DNode.setProps=function(t){return i.setProperties(this,t)},i.DNode.keys=function(){var t=[];for(var e in this)this.hasOwnProperty(e)&&!i.internal(e)&&t.push(e);return t},i.nodeMethod("pathOf",function(e){var n=[],r=this.__parent__;if(!r)return void 0;for(var o=this;o;){if(o==e)return n;if(o==t)return n.unshift("/"),n;n.unshift(o.__name__),o=i.getval(o,"__parent__")}return void 0}),i.nodeMethod("topAncestorName",function(t){if(this==t)return void 0;var e=this.__parent__;return e?e==t?this.__name__:e.topAncestorName(t):void 0});var a={om:1};i.inStdLib=function(e){var n=e.topAncestorName(t);return a[n]},i.pathToString=function(t,e){e||(e="/");var n=t.length,r=t.join(e);return n>0&&t[0]==e?r.substr(1):r},i.nodeMethod("remove",function(){var t=this.__parent__,e=this.__name__;t[e]=void 0}),i.DNode.values=function(){var t=[];for(var e in this)this.hasOwnProperty(e)&&!i.internal(e)&&t.push(this[e]);return t},i.removeDups=function(t){var e={},n=[];return t.forEach(function(t){void 0===e[t]&&(e[t]=1,n.push(t))}),n},i.evalPath=function(e,n,r){if(n){if("string"==typeof n)var o=n.split("/");else o=n;var i=o[0];if(""==i||"/"==i){if(r)var a=r;else var a=t;var s=o.concat();s.shift()}else a=e,s=o;for(var c=s.length,u=0;c>u;u++){var h=s[u],l=typeof a;if(!a||"object"!=l&&"function"!=l)return void 0;a=a[h]}return a}},i.nodeMethod("pathSetValue",function(t,e,n){var r=e.length-1,o=e.slice(0,r),i=e[r],a=this.evalPath(o);a&&(a[i]=n)}),i.applyMethod=function(t,e,n){if(e&&("object"==typeof e||"function"==typeof e)){var r=e[t];if(r&&"function"==typeof r)return r.apply(e,n)}return e},i.internalProps={__parent__:1,__protoChild__:1,__value__:1,__hitColor__:1,__chain__:1,__copy__:1,__name__:1,widgetDiv:1,__protoLine__:1,__inCopyTree__:1,__headOfChain__:1},i.internal=function(t){return i.internalProps[t]},i.DNode.findPropertyOnInheritanceChain=function(t){var e=this.get(t);if("undefined"!=typeof e)return this;var n=Object.getPrototypeOf(this);return n.__parent__?n.findPropertyOnInheritanceChain(t):void 0},i.DNode.inheritedTreeProperty=function(t,e){if(i.internal(t))return!1;var n=this[t],r=typeof n;if(!n||"object"!=r&&"function"!=r){if(e)return!1;var o=this.findPropertyOnInheritanceChain(t);return o?!0:!1}var a=n.__parent__;return a==this},i.nodeMethod("treeProperty",function(t,e){if(!this.hasOwnProperty(t)||i.internal(t))return!1;var n=this[t];return i.isNode(n)?n.__parent__==this:!e}),i.nodeMethod("nonAtomicTreeProperty",function(t){return this.treeProperty(t,1)}),i.nodeMethod("children",function(){var t=[];return this.iterValues(function(e,n){i.isObject(n)&&t.push(n)}),t}),i.hasMethod=function(t,e){var n=typeof t;if(t&&"object"==n){var r=t[e];if("function"==typeof r)return r}return void 0},i.nodeMethod("getMethod",function(t,e){var n=typeof t;if(t&&"object"==n){var r=t[e];if("function"==typeof r)return r}return void 0}),i.nodeMethod("treeOfSelections",function(){var t;return this.iterTreeItems(function(e){var n=e.__name__;if(e.__selected__)t=t?t:{},t[n]=1;else{var r=e.treeOfSelections();r&&(t=t?t:{},t[n]=r)}},!0),t}),i.nodeMethod("installTreeOfSelections",function(e){1==e?(this.__selected__=!0,this.deepSetProp("__selectedPart__",1),this.setPropForAncestors("__descendantSelected__",1,t.draw.wsRoot)):e&&this.iterTreeItems(function(t){var n=t.__name__;t.installTreeOfSelections(e[n])},!0)}),i.nodeMethod("deepUpdate",function(t,e){e||(e=this.treeOfSelections()),o(this,t),t&&this.installOverrides(t),this.installTreeOfSelections(e)}),i.DNode.addOverride=function(t,e,n){var r=this[e],o=this.pathOf(n),a=t;o.forEach(function(t){var e=a[t];i.isObject(e)||(e={},a[t]=e),a=e}),a[e]=r},i.pathLookup=function(t,e){for(var n=e.length,r=t,o=0;n>o;o++){var i=e[o],r=r[i];if(void 0===r)return void 0}return r},i.DNode.findInOverride=function(t,e){var n=this.pathOf(e);return i.pathLookup(t,n)},i.DNode.transferToOverride=function(t,e,n){if(t){var r=this.findInOverride(t,e),o=this;r&&n.forEach(function(t){var e=o[t],n=typeof e;"object"==n&&e||(r[t]=e)})}},i.nodeMethod("removeComputed",function(){this.__computed__?this.remove():this.iterTreeItems(function(t){t.removeComputed()},!0)}),i.removeValues=function(t){t.deepApplyMeth("removeValue",null,!0)},i.arrayToDict=function(t){var e={};return t.forEach(function(t){e[t]=1}),e},i.DNode.xferProperty=function(t,e){var n=e[t];return void 0===n?void 0:(this[t]=n,n)},i.DNode.setProperties=function(t,e,n,r){if(t){if(e)var o=i.arrayToDict(e);for(var a in t)if(t.hasOwnProperty(a)){if(e&&void 0===o[a])continue;var s=t[a];if(void 0===s)continue;r&&(s=i.toNode(s)),this.set(a,s,n)}return this}},i.DNode.setPropertiesN=function(t,e,n){return this.setProperties(t,e,n,1)},i.nodeMethod("checkTree",function(){var t=this;this.iterTreeItems(function(e,n){e.__parent__!=t&&i.error(t,e,"bad parent"),e.__name__!=n&&i.error(t,e,"bad name"),e.checkTree()},!0)}),i.DNode.stripOm=function(){var t={};for(var e in this)if(this.nonAtomicTreeProperty(e)){var n=this[e];t[e]=n.stripOm()}else{n=this[e];var r=typeof n;n&&"object"!=r&&"function"!=r&&(t[e]=n)}return t},i.LNode.stripOm=function(){for(var t=[],e=this.length,n=0;e>n;n++)if(this.nonAtomicTreeProperty(n)){var r=this[n];t.push(r.stripOm())}else{r=this[n];var o=typeof r;r&&"object"!=o&&"function"!=o&&t.push(r)}return t},i.createJsFunction=function(){function t(t){return Function.apply(this,t)}return t.prototype=Function.prototype,function(e){return new t(e)}}(),i.pw="vMfm7i1r",i.parseFunctionText=function(t){xnc=t;var e=/\s*function\s*\w*\s*\(([^\)]*)\)/,n=xnc.match(e),r=n[1].split(","),o=xnc.indexOf(")"),a=xnc.substring(o+1),s=a.indexOf("{"),c=a.lastIndexOf("}"),u=a.slice(s+1,c),h=r.concat(u),l=i.createJsFunction(h);return l},i.toFunction=function(t){"function"!=typeof t&&i.error("Expected function");var e=i.parseFunctionText(t.toString());return new i.Function(e)},i.DNode.installType=function(t,e){if(e)n=e;else var n=i.DNode.mk();return n.__isType__=1,this.set(t,n),n},i.DNode.namedType=function(){return this.__isType__=1,this},i.DNode.protoPath=function(t){var e=Object.getPrototypeOf(this),n=i.getval(e,"__parent__");if(!n)return void 0;var r=i.pathOf(e,t);return r},i.nodeMethod("get",function(t){return this.hasOwnProperty(t)?this[t]:void 0}),i.getval=function(t,e){return t||i.error("null v"),t.hasOwnProperty(e)?t[e]:void 0},i.DNode.lastProtoInTree=function(){var t=Object.getPrototypeOf(this),e=t.__parent__;return e?t.lastProtoInTree():this},i.DNode.protoName=function(){var t=Object.getPrototypeOf(this),e=t.__parent__;if(!e)return"";if(t.get("__isType__")){var n=t.__name__;return n?n:""}return t.protoName()},i.LNode.protoName=function(){return"LNode"},i.DNode.hasTreeProto=function(){var t=Object.getPrototypeOf(this);return t&&t.__parent__},Function.prototype.hasTreeProto=function(){return!1},i.LNode.hasTreeProto=function(){return!1},i.nodeMethod("deepApplyFun",function(t){t(this),this.iterTreeItems(function(e){e.deepApplyFun(t)},!0)}),i.nodeMethod("applyFunToAncestors",function(t,e){if(t(this),this!=e){var n=this.__parent__;n&&n.applyFunToAncestors(t,e)}}),i.nodeMethod("deepApplyMeth",function(t,e,n){var r=i.getMethod(this,t),o=!0;r&&(r.apply(this,e),n||(o=!1)),o&&this.iterTreeItems(function(r){r.deepApplyMeth(t,e,n)},!0)}),i.nodeMethod("deepSetProp",function(t,e){this.deepApplyFun(function(n){n[t]=e})}),i.nodeMethod("deepDeleteProps",function(t){this.deepApplyFun(function(e){t.forEach(function(t){delete e[t]})})}),i.nodeMethod("setPropForAncestors",function(t,e,n){this.applyFunToAncestors(function(n){n[t]=e},n)}),i.LNode.maxOrMin=function(t,e){var n=e?-1/0:1/0;return this.forEach(function(r){var o=r[t];"number"==typeof n&&(n=e?Math.max(n,o):Math.min(n,o))}),n},i.LNode.min=function(t){return this.maxOrMin(t,!1)},i.LNode.max=function(t){return this.maxOrMin(t,!0)},i.nodeMethod("funstring1",function(t,e){this.iterTreeItems(function(n,r){if(i.isNode(n))n.funstring1(t,e+r+".");else if("function"==typeof n){var o=t[0],a=n.toString();o+=e+r+" = "+a,o+="\n\n",t[0]=o}})}),i.nodeMethod("funstring",function(e){if(e)var n="__pj__.anon.";else var r=this.pathOf(t),n="__pj__."+r.join(".")+".";var o=[""];return this.funstring1(o,n),o[0]}),i.DNode.findOwner=function(t){for(var e=this;e;){if(e.hasOwnProperty(t))return e;e=Object.getPrototypeOf(e)}},i.DNode.inheritsPropertyFrom=function(t,e){var n=!0;if(this==t)return this.hasOwnProperty(e);if(!t.isPrototypeOf(this))return!1;var r=t[e];if(void 0===r)return!1;for(var o=this;;){var i=Object.getPrototypeOf(o);if(i==t)return n?!0:i.hasOwnProperty(e);o=i}},i.LNode.inheritsPropertyFrom=function(){return!1},i.nodeMethod("treeInheritsPropertyFrom",function(t,e){if(this.inheritsPropertyFrom(t,e))return!0;for(var n in this)if(this.treeProperty(n,!0)){var r=this[n];if(r.treeInheritsPropertyFrom(t,e))return!0}return!1}),i.DNode.inheritsSomePropertyFrom=function(t){if(this==t)return!0;if(!t.isPrototypeOf(this))return!1;for(var e=Object.getOwnPropertyNames(t),n=e.length,r=0;n>r;r++){var o=e[r];if(!i.internal(o)&&this.inheritsPropertyFrom(t,o))return!0}return!1},i.LNode.inheritsSomePropertyFrom=function(){return!1},i.nodeMethod("treeInheritsSomePropertyFrom",function(t,e){if(this.inheritsSomePropertyFrom(t,e))return!0;for(var n in this)if(this.treeProperty(n,!0)){var r=this[n];if(r.treeInheritsSomePropertyFrom(t,e))return!0}return!1}),i.LNode.eval=function(){return this},i.DNode.createChild=function(t,e){var n=this[t];return n?n:(n=e(),this.set(t,n),n)},i.DNode.setNote=function(t,e){var n=this.setIfMissing("__notes__");n[t]=e},i.DNode.setInputF=function(e,n,r){var o=this.setIfMissing("__inputFunctions__"),a=i.pathToString(n.pathOf(t)),s=a+"/"+r;o[e]=s},i.DNode.setOutputF=function(e,n,r){var o=this.setIfMissing("__outputFunctions__"),a=i.pathToString(n.pathOf(t)),s=a+"/"+r;o[e]=s},i.DNode.getBeforeDNode=function(t){if(this==i.DNode)return void 0;var e=this.get(t);if(void 0!==e)return e;var n=Object.getPrototypeOf(this);return n.getBeforeDNode(t)},i.DNode.getInputF=function(e){var n=this.__inputFunctions__;if(n){var r=n.getBeforeDNode(e);return i.evalPath(t,r)}},i.LNode.getInputF=function(){return void 0},i.DNode.getOutputF=function(e){var n=this.__outputFunctions__;if(n){var r=n.getBeforeDNode(e);return i.evalPath(t,r)}},i.LNode.getOutputF=function(){return void 0},i.DNode.getNote=function(t){var e=this.__notes__;return e?e[t]:void 0},i.LNode.getNote=function(){return void 0},i.nodeMethod("isComputed",function(){return this.__computed__?!0:this==t?!1:this.__parent__.isComputed()}),i.nodeMethod("isMfrozen",function(){return this.__mfrozen__?!0:this==t?!1:this.__parent__.isMfrozen()}),i.DNode.setFieldStatus=function(t,e){var n=this.setIfMissing("__fieldStatus__");n[t]=e},i.DNode.getFieldStatus=function(t){var e=this.get("__fieldStatus__");return e?e[t]:void 0},i.DNode.fieldIsFrozen=function(t){if(this.isMfrozen())return!0;var e=this.getFieldStatus(t);return e&&0==e.indexOf("mfrozen")},i.nodeMethod("installOverrides",function(t){for(var e in t){var n=t[e];if(i.isObject(n)){var r=this[e];i.isNode(r)&&r.installOverrides(n)}else this[e]=n}}),i.installType("DataSource"),i.DataSource.mk=function(t){var e=Object.create(i.DataSource);return e.url=t,e.setf("link",""),i.setDataSourceLink(t,e),e},i.dataSourceBeingLoaded=null,i.loadedData=[],i.loadDataTimeout=2e3,t.loadData=function(t){var e=i.loadDataCallback;i.loadedData[i.dataSourceBeingLoaded]=1,e&&e(t)},i.loadDataError=function(e){t.page.genError("Could not load "+e)},i.DataSource.loadTheData=function(t){setTimeout(function(){var t=i.dataSourceBeingLoaded;i.loadedData[t]||i.loadDataError(t)},i.loadDataTimeout);var e=i.mapUrlToDev(this.url);i.dataSourceBeingLoaded=e,i.loadDataCallback=t,$.ajax({crossDomain:!0,dataType:"script",url:e})},i.collectedDataSources=void 0,i.DataSource.collectThisDataSource=function(){i.collectedDataSources.push(this)},i.collectDataSources=function(t){return i.collectedDataSources=[],t.deepApplyMeth("collectThisDataSource"),i.collectedDataSources},i.loadNextDataSource=function(t,e){var n=i.collectedDataSources,r=n.length;if(t==r)return e(),void 0;var o=n[t],a=function(n){o.set("data",i.toNode(n)),o.__current__=1,i.loadNextDataSource(t+1,e)};return o.__current__?(i.loadNextDataSource(t+1,e),void 0):(o.loadTheData(a),void 0)},i.loadTheDataSources=function(t,e){i.loadedData=[],t.forEach(function(t){i.collectDataSources(t)}),i.loadNextDataSource(0,e)},i.newDataSource=function(e,n){n.url=e,n.__current__=0;var r=function(e){n.set("data",i.toNode(e)),n.__current__=1,t.tree.updateAndShow()};return n.loadTheData(r),e},i.setDataSourceLink=function(t,e){var n=e.url;return e.link="<a href='"+n+"'>"+n+"</a>",t},i.DataSource.setInputF("url",i,"newDataSource"),i.DataSource.setOutputF("url",i,"setDataSourceLink"),i.DNode.ownProperties=function(){var t=Object.getOwnPropertyNames(this),e=[];return t.forEach(function(t){i.internal(t)||e.push(t)}),e},i.DNode.properties=function(t){var e={};r(e,this,t?t:i.DNode);var n=[];for(var o in e)n.push(o);return n}}(__pj__),function(){var t=__pj__.om;t.theChains=[],t.DNode.markCopyNode=function(){this.__inCopyTree__=1},t.DNode.markCopyTree=function(){this.deepApplyMeth("markCopyNode",null,!0)},t.DNode.addChain=function(t){if(this.hasOwnProperty("__chain__"))return this.__chain__;var e=Object.getPrototypeOf(this),n=typeof e;if("function"!=n&&"object"!=n||!e.get("__parent__")){if(t){var r=[this];return this.__chain__=r,r}return void 0}if(e.__inCopyTree__){var o=e.addChain(1).concat();o.push(this)}else var o=[this];return this.__chain__=o,o},t.DNode.addChains=function(){this.deepApplyMeth("addChain",null,!0)},t.DNode.collectChain=function(){var e=this.__chain__;e&&e.length>1&&!e.collected&&(t.theChains.push(e),e.collected=1)},t.DNode.collectChains=function(){this.deepApplyMeth("collectChain",null,!0)},t.buildCopiesForChain=function(t){for(var e=t[0],n=t.length,r=0;n>r;r++){var o=t[r];if(o.get("__copy__"))var i=o.__copy__;else i=Object.create(e),0==r&&(i.__headOfChain__=1),o.__name__&&(i.__name__=o.__name__),o.__copy__=i;e=i}},t.buildCopiesForChains=function(){t.theChains.forEach(function(e){t.buildCopiesForChain(e)})},t.DNode.buildCopyForNode=function(){var t=this.__copy__;if(!t){var t=Object.create(this);this.__copy__=t,t.__headOfChain__=1}},t.LNode.buildCopyForNode=function(){var e=this.__copy__;if(!e){var e=t.LNode.mk();this.__copy__=e}},t.DNode.buildCopiesForTree=function(){this.deepApplyMeth("buildCopyForNode",null,!0)},t.cnt=0,t.DNode.stitchCopyTogether=function(){var e=this.__copy__;e||t.error("unexpected"),t.cnt++;for(var n in this)if(this.hasOwnProperty(n)&&!t.internal(n)){var r=this[n];if(r&&"__isType__"==n){e[n]=r;continue}var o=typeof r;if(r&&"object"==o){var i=t.getval(r,"__copy__");i&&(e[n]=i,i.__name__=n,i.__parent__=e),t.getval(r,"__parent__")==this&&r.stitchCopyTogether()}else e.get("__headOfChain__")||(e[n]=r)}return e},t.LNode.stitchCopyTogether=function(){var e=this.get("__copy__");e||t.error("unexpected");for(var n=this.length,r=0;n>r;r++){var o=this[r],i=typeof o;if(o&&"object"==i){var a=o.get("__copy__");a?(e.push(a),a.__name__=r,a.__parent__=e):e.push(o),o.get("__parent__")==this&&o.stitchCopyTogether()}else e.push(o)}return e},t.DNode.cleanupSourceAfterCopy1=function(){delete this.__inCopyTree__,delete this.__chain__,delete this.__copy__},t.LNode.cleanupSourceAfterCopy1=function(){delete this.__inCopyTree__,delete this.__copy__},t.DNode.cleanupSourceAfterCopy=function(){this.deepApplyMeth("cleanupSourceAfterCopy1",null,!0),t.theChains=[]},t.DNode.instantiate=function(){this.markCopyTree(),this.addChains(),this.collectChains(),t.buildCopiesForChains(),this.buildCopiesForTree();var e=this.stitchCopyTogether();return this.cleanupSourceAfterCopy(),e},t.DNode.instantiationCount=function(t){var e=0;if(t.isPrototypeOf(this))var e=1;else e=0;return this.iterTreeItems(function(n){var r=n.instantiationCount(t);e+=r},!0),e},t.LNode.instantiationCount=t.DNode.instantiationCount,t.DNode.copyNode=function(){var t=Object.create(this);return this.iterTreeItems(function(e,n){var r=e.copyNode();r.__parent__=t,r.__name__=n,t[n]=r},!0),t},t.LNode.copyNode=function(){var e=t.LNode.mk();return this.forEach(function(n){if(t.isNode(n)){var r=n.copyNode();e.pushChild(r)}else e.push(n)}),e}}(),function(t){function e(t,e){var r=n.pathLast(t),o=n.pathExceptLast(t),i=o+e+"/"+r+".js";return i}var n=t.om;t.draw,n.DNode.isProtoChild=function(){var t=Object.getPrototypeOf(this);if(!t)return!1;var e=this.get("__parent__");if(!e)return!1;var r=Object.getPrototypeOf(e);if(!n.DNode.isPrototypeOf(r))return!1;var o=this.__name__,i=r[o];return i==t},Function.prototype.isProtoChild=function(){return!1};var r={__prototype__:1,__name__:1,__typePrototype__:1,__parent__:1,widgetDiv:1};n.DNode.assertExternalReferences=function(t){var e=this.__externalReferences__;e||(e=[]),this.__externalReferences__=e.concat(t)},n.externalReferences={},n.computeAllExternalReferences=function(e){var r={},o=e.__externalReferences__;if(o){var i=[];o.forEach(function(e){if(0==e.indexOf("http:")||0==e.indexOf("https:"))n.error("unexpected"),r[p]=e;else{p=e;var o=n.pathMap[p];o&&(r[p]=o)}var a=n.evalPath(t,p),s=n.computeAllExternalReferences(a);i=i.concat(s[0]),$.extend(r,s[1])}),i=i.concat(o);var a=n.removeDups(i);return[a,r]}return[]},n.externalizedAncestor=function(t){if(n.getval(t,"__externalReferences__"))return t;var e=n.getval(t,"__parent__");return e?n.externalizedAncestor(e):void 0},n.refPath=function(e,r){var o=e.pathOf(r);if(o){var i=n.pathToString(o);if("/"==i[0]){var a=e,s=n.externalizedAncestor(a);if(s){var c=s.pathOf(t),u="/"+n.pathToString(c),h=n.externalReferences;h[u]=1}else n.error("External dependency "+i+" has not been saved")}return i}},n.DNode.externalize=function(t){if(t)var e=t;else e=this;var o={},i=this.isProtoChild();if(i)o.__protoChild__=1;else{var a=Object.getPrototypeOf(this),s=n.refPath(a,e);s&&(o.__prototype__=s)}var c=this;return this.iterItems(function(t,i){if(!c.treeProperty(i)){var a=n.refPath(t,e);return a&&(o[i]={__reference__:a}),void 0}if(!r[i])if(n.isNode(t)){var s=t.externalize(e);o[i]=s}else o[i]=t}),o},n.LNode.externalize=function(t){if(t)var e=t;else e=this;for(var r=[],o=this.length,i=0;o>i;i++){var a=this[i];if(n.isNode(a))var s=a.externalize(e);else s=a;r.push(s)}return r},n.allEChains=[],n.installParentLinks1=function(t,e){if(e&&"object"==typeof e){for(var r in e)if(e.hasOwnProperty(r)){var o=e[r];o&&"object"==typeof o&&(o.__reference__||(n.installParentLinks1(e,o),o.__name__=r))}t&&(e.__parent__=t)}},n.installParentLinks=function(t){return n.installParentLinks1(null,t)},n.buildEChain=function(t,e,r){var o=r.__prototype__;if(r.__chain__,o){var i=o.split("/"),a=n.evalPath(e,i,t);if(n.log("untagged","setting prototypev for ",o),r.__prototypev__=a,""==i[0])var s=[a,r];else{var s=n.buildEChain(t,e,a);s||(s=[null,a]),s.push(r)}return r.__chain__=s,s}if(r.__protoChild__){var c=r.__parent__;c||n.error("__protoChild__ root of serialization not handled yet");var u=c.__prototypev__;if(u){var a=u[r.__name__],s=n.buildEChain(t,e,a);s||(s=[a])}else{n.error("Missing __prototypev__");var a=c[r.__name__],s=[a]}return s.push(r),r.__chain__=s,r.__prototypev__=a,s}};var o={__v__:1,__prototype__:1,__function__:1,__prototypev__:1,__parent__:1,__name__:1,__chain__:1,__reference__:1};n.buildEChains=function(t,e,r){if(r)var i=r;else i=e;n.buildEChain(t,e,i);for(var a in i)if(i.hasOwnProperty(a)&&!o[a]){var s=i[a];s&&"object"==typeof s&&n.buildEChains(t,e,s)}},n.allChains=[],n.allLNodes=[],n.collectEChains=function(t){var e=t.__chain__;e&&!e.__collected__&&(n.allChains.push(e),e.__collected__=!0);for(var r in t)if(t.hasOwnProperty(r)&&!o[r]){var i=t[r];i&&"object"==typeof i&&n.collectEChains(i)}},n.buildObjectsForChain=function(t){var e=t.length;if(t[0])var r=t[0];else r=n.DNode.mk();for(var o=1;e>o;o++){var i=t[o],a=i.__v__;if(!a){var s=i.__function__;if(s){error("Obsolete I think");var a=n.parseFunctionText(s)}else a=Object.create(r),a.__name__=i.__name__;i.__v__=a}r=a}"e0"==a.__name__},n.buildObjectsForChains=function(){n.allChains.forEach(function(t){n.buildObjectsForChain(t)})},n.buildObjectsForTree=function(t){if(!t.__v__){var e=t.__function__;if(e)var r=n.parseFunctionText(e);else r=Array.isArray(t)?n.LNode.mk():n.DNode.mk();t.__v__=r}for(var i in t)if(t.hasOwnProperty(i)&&!o[i]){var r=t[i];r&&"object"==typeof r&&(r.__reference__||n.buildObjectsForTree(r))}},n.stitchTogether=function(t){var e=t.__v__;if(Array.isArray(t))t.forEach(function(t){if(!t||"object"!=typeof t&&"function"!=typeof t)e.push(t);else{n.stitchTogether(t);var r=t.__v__;e.pushChild(r)}});else for(var r in t)if(t.hasOwnProperty(r)&&!o[r]){var i=t[r];
i&&"object"==typeof i?i.__reference__?referencesToResolve.push([e,r,i.__reference__]):(e[r]=i.__v__,n.stitchTogether(i)):e[r]=i}e.__name__=t.__name__;var a=t.__parent__;a&&(e.__parent__=a.__v__)},referencesToResolve=[],n.resolveReference=function(t,e,r){var o=r[0],i=r[1],a=r[2],s=n.evalPath(e,a,t);return o[i]=s,s},n.resolveReferences=function(t,e){referencesToResolve.forEach(function(r){n.resolveReference(t,e,r)})},n.DNode.cleanupAfterInternalize=function(){this.deepDeleteProps(["__prototypev__","__protoChild__","__prototype__"])},n.internalize=function(t,e,r){n.installParentLinks(r),n.buildEChains(t,r),n.collectEChains(r),n.buildObjectsForChains(),n.buildObjectsForTree(r),n.stitchTogether(r),n.log("untagged",referencesToResolve);var o=r.__v__;return n.resolveReferences(t,o),0==e.indexOf("http:")||0==e.indexOf("https:")?t.set("anon",o):t.set(e,o),o.cleanupAfterInternalize(),o},n.addExtrefs=function(t){n.externalReferences={};var e=t.externalize(t),r=Object.keys(n.externalReferences),o=t.__externalReferences__;t.__externalReferences__=o?o.concat(r):r;var i=n.computeAllExternalReferences(t),a=i[0],s=i[1],c={directExternalReferences:r,allExternalReferences:a,pathMap:s,value:e};return c},n.getFile=function(t,e){var r={path:t};n.ajaxPost("/api/getFile",r,function(t){e(t)})},n.grabbed={},n.pathMap={},n.urlToPath={},n.urlsGrabbed={},n.iiGrabbed=function(t){var e=n.grabbed[t];return e||(e=n.urlsGrabbed[t]),e},n.repoUrl=function(t){return url=n.itemHost+t},n.toUrl=function(t){if(0==t.indexOf("http:")||0==t.indexOf("https:"))var e=t;else e=n.pathMap[t];return e},n.toPath=function(t){if(0==t.indexOf("http:")||0==t.indexOf("https:")){var e=n.urlToPath[t];if(!e)throw n.error("No path for "+t),"noPath";return e}return t},n.toCodeVariant=function(t){return e(t,"code")},n.toDataVariant=function(t){return e(t,"data")},n.allInstalls=[],n.loadFunction=function(t){var e=t.path,r=t.value,o=t.url;n.log("untagged","LoadFunction  path ",e," url ",o),n.grabbed[e]=r,n.urlsGrabbed[o]=r,n.pathMap[e]=o,n.urlToPath[o]=e,$.extend(n.pathMap,r.pathMap);var i=n.grabCallbacks[o];n.log("untagged","looked up grabCallback of ",o,e," found? ",i?"yes":"no"),i&&i(r)},n.loadCodeFunction=function(t){return},n.grabCallbacks={},n.grabCode=function(t,e){var r=n.toUrl(t),o=n.toCodeVariant(r);$.ajax({crossDomain:!0,dataType:"script",url:o,success:function(){e&&e()}})},n.grabTimeout=4e3,n.grabError=function(e,n){t.page.genError("<span class='errorTitle'>Error:</span> Could not load "+n)},n.grabOne=function(t,e){var r=n.toUrl(t);if(!r)return n.grabError(t,t),void 0;var o=n.toDataVariant(r),i=function(){n.urlsGrabbed[r]||n.grabError(t,r),n.log("untagged","timout with no error for url ",r," indicator",t)};n.grabCallbacks[r]=e,setTimeout(i,n.grabTimeout),$.ajax({crossDomain:!0,dataType:"jsonp",url:o})},n.grabM=function(t,e,r){var o=t.length;if(0==o)return e&&e(),void 0;for(var i=[],a=0,s=function(){a++,n.log("untagged","numInstalled",a),a==o&&e&&e(i)},c=0;o>c;c++){var u=t[c];r?n.grabCode(u,s):n.grabOne(u,s)}},n.restore=function(e,r){function o(e){var r=n.toPath(e);u=n.grabbed[r],u||n.error("Failed to load "+e);var o=n.internalize(t,r,u.value);return o.__externalReferences__=u.directExternalReferences,o.__overrides__=u.overrides,o.__from__=e,n.allInstalls.push(o),o}function i(t){if(t.forEach(function(t){o(t)}),h)for(var i=[],a=e.length,s=0;a>s;s++)i.push(o(e[s]));else var i=[o(e)];var c=Object.keys(n.urlsGrabbed),u=c;n.grabM(u,function(){r(i)},!0)}function a(e,r){var o=n.urlsGrabbed[e],i=o.allExternalReferences;i.forEach(function(e){void 0===n.evalPath(t,e)&&r.push(e)})}function s(){var t=[];a(e,t),n.grabM(t,function(){i(t)})}function c(){var t=[];e.forEach(function(e){a(e,t)}),n.grabM(t,function(){i(t)})}var u;if(!e||0==e.length)return r(),void 0;if(e instanceof Array)var h=1;else h=0;n.grabbed={},n.grabbedUrls={},h?n.grabM(e,c):n.grabOne(e,s)},n.install=n.restore,n.dayOrdinal=function(){var t=new Date,e=Math.floor(t.getTime()/864e5);return e-15904},n.numToLetter=function(t,e){if(10>t)if(e)n=97+t;else var n=48+t;else n=87+t;return String.fromCharCode(n)},n.randomName=function(){for(var t="i",e=0;9>e;e++)t+=n.numToLetter(Math.floor(35*Math.random()),1);return t},n.DNode.computePaths=function(t,e){var r=this.pathOf(),o=localStorage.handle;if(pth=n.pathToString(r),e)var i=n.randomName(),a="/variant"+n.pathToString(pth);else i=r.pop(),a=n.pathToString(r);var s="/"+o+"/"+t,c=n.itemHost+s+a;return{url:c+"/"+i,host:n.itemHost,repo:s,path:pth,spath:s+a+"/"+i,data:a+"/data/"+i+".js",code:a+"/code/"+i+".js"}},n.unpackUrl=function(t,e){this.pathOf();var n=/(http\:\/\/[^\/]*)\/([^\/]*)\/([^\/]*)\/(.*)\/([^\/]*)$/,r=t.match(n);if(r){var o=r[5],i="/"+r[4],a=i+"/"+o;if(e)var s=i;else var s=a;var c="/"+r[2]+"/"+r[3];return{url:t,host:r[1],handle:r[2],prefix:r[3],repo:c,path:s,spath:c+a,data:i+"/data/"+o+".js",code:i+"/code/"+o+".js",image:i+"/image/"+o+".jpg"}}},n.s3Save=function(e,r,o,i){n.unselect();var a=t.draw.overrides;i&&e.removeComputed(),delete e.__changedThisSession__;var s=n.addExtrefs(e);s.overrides=a,i&&(s.value.__autonamed__=1);var c=e.funstring();""==c&&(c="//No JavaScript was defined for this item");var u={value:s,url:r.url,path:r.path,repo:r.repo},h={pw:n.pw,path:r.repo+r.data,value:"__pj__.om.loadFunction("+JSON.stringify(u)+")",isImage:0};h.viewFile=r.spath;var l={path:r.repo+r.code,value:c,pw:n.pw,isImage:0},d="/api/toS3";n.ajaxPost(d,h,function(){n.ajaxPost(d,l,function(t){i&&e.deepUpdate(),o&&o(t)})})},n.save=function(t){var e=n.customSave;e?e(t):alert("not yet")}}(__pj__),function(t){var e=t.om;t.set("dom",e.DNode.mk());var n=t.dom;n.installType("JQ"),n.newJQ=function(t,r){if(r)var o=Object.create(r);else var o=Object.create(n.JQ);return t&&(o.setProperties(t,["tag","html","click","id","type"]),o.setN("hoverIn",t.hoverIn),o.setN("hoverOut",t.hoverOut),o.setN("style",t.style),o.setN("attributes",t.attributes)),o.set("theChildren",e.LNode.mk()),o},n.JQ.addChild=function(t,e){return e?(this.theChildren.pushChild(e),void 0!==t&&(e.id=t),e):(this.theChildren.pushChild(t),t)},n.JQ.removeChildren=function(){var t=this.__element__;t&&t.empty(),this.theChildren.length=0},n.JQ.lastChild=function(){var t=this.theChildren,e=t.length;return e>0?t[e-1]:void 0},n.JQ.addBefore=function(t){for(var e=this.__parent__,r=n.LNode.mk(),o=e.length,i=0;o>i;i++){var a=e[i];a==this&&r.pushChild(t),r.pushChild(a)}var s=e.__parent__;s.set("theChildren",r)},n.JQ.selectChild=function(t){for(var e=this.theChildren,n=e.length,r=0;n>r;r++){var o=e[r];if(o.id==t)return o}},n.JQ.parent=function(){var t=this.get("__parent__");if(e.LNode.isPrototypeOf(t)){var r=t.get("__parent__");if(n.JQ.isPrototypeOf(r))return r}},n.JQ.cssSelect=function(t){for(var e=t.split(">"),n=e.map(function(t){return t.substr(1)}),r=n.length,o=this,i=0;r>i;i++)if(o=o.selectChild(n[i]),!o)return o;return o},n.JQ.install=function(t,e,n){function r(t,e){t[e]&&("enter"==e?t.__element__.keyup(function(n){13==n.keyCode&&t[e]()}):t.__element__[e](t[e]))}function o(t,e){e.forEach(function(e){r(t,e)})}n||(n=0);var i=this.parent();t?this.__treeTop__=1:i&&i.__element__&&(t=i.__element__);var a=this.__element__,s=this.id;if(s||(s=this.__name__),s||(s="uiRoot"),!a){var c=this.html,u=this.tag;u?(a=$("<"+u+"/>"),c&&a.html(c)):a=$(c),e?e.__element__.after(a):t.append(a),this.__element__=a,a.attr("id",s),o(this,["click","blur","focus","enter"]);var h,l,d=this.hoverIn;if(d){var f=d.stripOm();h=function(){a.css(f)}}var p=this.hoverOut;if(p){var _=p.stripOm();l=function(){a.css(_)}}(d||p)&&a.hover(h,l),this.hidden&&a.hide()}var v=this.style;if(v){var m=v.stripOm();a.css(m)}var g=this.attributes;g&&g.iterInheritedTreeItems(function(t,e){a.attr(e,t)});for(var y=n+1,b=this.theChildren,C=void 0,N=b.length,x=0;N>x;x++){var P=b[x];P.install(null,C,y),C=P}},n.JQ.hide=function(){if(!this.hidden){this.hidden=1;var t=this.__element__;t&&t.hide()}},n.JQ.show=function(){if(this.hidden){this.hidden=0;var t=this.__element__;t&&t.show()}},n.JQ.dpytree=function(){var t={};t.tag=this.tag,t.html=this.html,t.id=this.id;var e=this.style;e&&(t.style=e.stripOm());var n=this.attributes;n&&(t.attributes=n.stripOm());var r=this.theChildren,o=[];t.theChildren=o;for(var i=r.length,a=0;i>a;a++){var s=r[a],c=s.dpytree();o.push(c)}return t},n.toHtml=function(t){var e="",r=t.tag;e+="<"+r+">";var o=t.html;o&&(e+=o);var i=t.theChildren;return i&&i.forEach(function(t){e+=n.toHtml(t)}),e+="</"+r+">"},n.JQ.toHtml=function(){var t=this.dpytree();return n.toHtml(t)},n.JQ.dpy=function(){return JSON.stringify(this.dpytree())},n.JQ.css=function(t){var e=this.__element__;e&&e.css(t)},n.JQ.attr=function(t,e){var n=this.__element__;n&&n.attr(t,e)},n.JQ.prop=function(t,e){var n=this.__element__;n&&n.prop(t,e)},n.JQ.empty=function(){var t=this.__element__;t&&t.empty()},n.JQ.setHtml=function(t){this.html=t;var e=this.__element__;e&&e.html(t)},n.JQ.offset=function(){var t=this.__element__;return t?t.offset():void 0},n.JQ.width=function(){var t=this.__element__;return t?t.width():void 0},n.JQ.height=function(){var t=this.__element__;return t?t.height():void 0},n.JQ.html=function(t){var e=this.__element__;return e?e.html(t):void 0},n.installType("Select"),n.Select.mk=function(t){var e=Object.create(n.Select);return e.setProperties(e,t),e},n.Select.toJQ=function(){function t(t){return function(){a.select(t)}}var e=this.jq;if(e)return e;for(var n=this.options,r=this.containerP.instantiate(),o=this.optionP,i=n.length,a=this,s=[],c=this.selected,u=0;i>u;u++){var h=n[u],l=o.instantiate();s.push(l),l.html=u===c?"&#x25CF; "+h:h,r.addChild(l),l.click=t(u)}return this.optionElements=s,this.jq=r,r},n.Select.select=function(t){this.selected=t;for(var e=this.options,n=this.optionElements,r=e.length,o=0;r>o;o++){var i=e[o],a=n[o];o==t?a.__element__.html("&#x25CF; "+i):a.__element__.html(i)}this.onSelect&&this.onSelect(t)},n.popped={},n.popFromButton=function(t,e,r){n.unpop(t);var o=n.popped;if(o[t])return r.css({display:"none"}),o[t]=0,void 0;var i=r.parent(),a=i.offset(),s=e.height(),c=e.offset(),u=c.left-a.left,h=c.top-a.top;r.css({display:"block",left:u+"px",top:h+s+"px"}),o[t]=r},n.unpop=function(t){var e=n.popped;for(k in e)if(k!=t){var r=e[k];r&&(r.css({display:"none"}),e[k]=0)}}}(__pj__),function(t){var e=t.om,n=t.dom,r=e.DNode.mk();t.set("jqPrototypes",r),r.set("button",n.newJQ({tag:"div",html:"prototype",hoverOut:{"background-color":"#444444"},hoverIn:{"background-color":"#777777"},style:{cursor:"pointer",color:"white",display:"inline-block","margin-left":"10px","padding-left":"5px","padding-right":"5px",border:"solid thin black",font:"11pt arial","background-color":"#444444"}})),r.set("textInput",n.newJQ({tag:"input",type:"input",style:{display:"inline-block",width:"150px","background-color":"white","margin-left":"10px"}})),r.set("pulldown",n.newJQ({tag:"div",style:{position:"absolute","padding-left":"5px","padding-right":"5px",border:"solid thin black","background-color":"white"}})),r.set("pulldownEntry",n.newJQ({tag:"div",html:"prototype",style:{cursor:"pointer",color:"black","padding-left":"5px","padding-right":"5px","background-color":"white"}}))}(__pj__),function(t){var e=t.om,n=_=t.set("geom",t.om.DNode.mk());n.__externalReferences__=[],n.installType("Point"),n.set("Shape",e.DNode.mk()).namedType(),n.Shape.mk=function(){return n.Shape.instantiate()},n.shapeOrLNodeChild=function(t,r){var o=t[r];if(n.Shape.isPrototypeOf(o)||e.LNode.isPrototypeOf(o)){var i=o.get("__parent__");if(i!=t)return;return o}},e.DNode.shapeTreeIterate=function(t){var e=Object.getOwnPropertyNames(this),r=this;e.forEach(function(e){var o=n.shapeOrLNodeChild(r,e);o&&t(o)})},e.LNode.shapeTreeIterate=function(t){var e=this;this.forEach(function(r){var o=n.shapeOrLNodeChild(e,r.__name__);o&&t(o)})},n.Point.mk=function(t,e){var r=Object.create(n.Point);return"number"==typeof t?(r.x=t,r.y=e):(r.x=0,r.y=0),r},n.toPoint=function(t){return Array.isArray(t)?n.Point.mk(t[0],t[1]):t},e.DNode.setPoint=function(t,e){if(e)var r=n.toPoint(e);else r=n.Point.mk();return this.set(t,r),r},n.Point.x=0,n.Point.y=0,n.Point.plus=function(t){var e=this;return n.Point.mk(e.x+t.x,e.y+t.y)},n.Point.length=function(){var t=this.x,e=this.y;return Math.sqrt(t*t+e*e)},n.Point.direction=function(){return n.normalizeAngle(Math.atan2(this.y,this.x))},n.Point.difference=function(t){var e=this;return n.Point.mk(e.x-t.x,e.y-t.y)},n.installType("Interval"),n.mkInterval=function(t,e){var r=Object.create(n.Interval);return r.lb=t,r.ub=e,r},n.Point.setCoords=function(t,e){this.set("x",t),this.set("y",e)},n.Point.distance=function(t){if(t)var e=this.x-t.x,n=this.y-t.y;else e=this.x,n=this.y;return Math.sqrt(e*e+n*n)},n.Point.times=function(t){var e=this;return n.Point.mk(t*e.x,t*e.y)},n.Point.normalize=function(){var t=this.length();return n.Point.mk(this.x/t,this.y/t)},n.Point.normal=function(){return n.Point.mk(-this.y,this.x)},n.Point.minus=function(){return n.Point.mk(-this.y,-this.x)},n.Point.dotp=function(t){return this.x*t.x+this.y*t.y},n.mkRadialPoint=function(t,e){return n.Point.mk(t*Math.cos(e),t*Math.sin(e))},n.Point.interpolate=function(t,e){var n=t.difference(this),r=n.times(e),o=this.plus(r);return o},n.Point.toRectangle=function(){var t=this.x,e=this.y,r=n.Point.mk(Math.abs(t),Math.abs(e)),o=0>t?t:0,i=0>e?e:0,a=n.Point.mk(o,i);return n.Rectangle.mk({corner:a,extent:r})},n.Point.toString=function(){var t=this.x,e=this.y;return"["+t+","+e+"]"},n.installType("Transform"),n.Transform.mk=function(t){var e=Object.create(n.Transform);return e.scale=1,e.rotation=0,e.setProperties(t,["scale","rotation"]),e.setPoint("translation",t?t.translation:void 0),e},e.DNode.addTransform=function(){var t=this.transform;return t||(t=n.Transform.mk(),this.set("transform",t)),t},n.normalizeAngle=function(t){var e=t%(2*Math.PI);return 0>e&&(e+=2*Math.PI),e},n.rotate=function(t){var e=n.Transform.mk();return e.rotation=t,e},n.pointify=function(t,e,r){if(void 0===e)var o=n.Point.mk(0,0);else o="number"==typeof r?n.Point.mk(e,r):Array.isArray(e)?n.Point.mk(e[0],e[1]):t?n.Point.mk(e.x,e.y):e;return o},n.toPoint=function(t,e){return n.pointify(0,t,e)},n.newPoint=function(t,e){return n.pointify(1,t,e)},n.mkTranslation=function(t,e){var r=n.newPoint(t,e),o=n.Transform.mk({translation:r});return o},n.scaling=function(t){var e=n.Transform.mk({translation:p});return e.scale=t,e},e.DNode.moveto=function(t,e){var r=n.toPoint(t,e),o=this.__parent__,i=o.toLocalCoords(r),a=this.transform,s={};if(a)a.scale=a.scale,a.rotation=a.rotation,a.translation.setTo(i);else{s.translation=i;var c=n.Transform.mk(s);this.set("transform",c)}},e.LNode.moveto=e.DNode.moveto,n.Transform.inverse=function(){var t=this.scale;t||(t=1);var e=1/t,r=this.translation;if(r){var o=-r.x*e,i=-r.y*e;return n.Transform.mk({scale:e,translation:n.Point.mk(o,i)})}return n.Transform.mk({scale:e})},n.Point.applyTransform=function(t){var e=t.translation,r=e.x,o=e.y,i=t.scale,a=t.rotation,s=this.x,c=this.y;if(0==a)var u=s,h=c;else var l=Math.sin(a),d=Math.cos(a),u=d*s-l*c,h=l*s+d*c;var f=i*u+r,p=i*h+o;return n.Point.mk(f,p)},n.Transform.applyInverse=function(t){var e=this.translation,r=this.scale,o=this.rotation;px=t.x-e.x,py=t.y-e.y;var i=1/r;if(px*=i,py*=i,0==o)var a=px,s=py;else var c=Math.sin(-o),u=Math.cos(-o),a=u*px-c*py,s=c*px+u*py;return n.Point.mk(a,s)},e.DNode.toGlobalCoords=function(t,e){var r=t?t:n.Point.mk(0,0);if(this==e)return r;var o=this.getTransform();o&&(r=r.applyTransform(o));var i=this.get("__parent__");return i?i.toGlobalCoords(r,e):r},e.LNode.toGlobalCoords=e.DNode.toGlobalCoords,e.DNode.toLocalCoords=function(t){var e=t?t:n.Point.mk(0,0),r=this.get("__parent__");r&&(e=r.toLocalCoords(e));var o=this.getTransform();return o&&(e=o.applyInverse(e)),e},e.LNode.toLocalCoords=e.DNode.toLocalCoords,e.DNode.translate=function(t,e){var r=this.transform;if(r)return r.set("translation",n.newPoint(t,e)),void 0;var r=n.mkTranslation(t,e);this.set("transform",r)},e.DNode.setScale=function(t){var e=this.transform;if(e)return e.scale=t,void 0;var e=n.scaling(t);this.set("transform",e)},e.DNode.rotate=function(t){var e=this.transform;if(e)return e.rotation=t,e;var e=n.rotate(t);this.set("transform",e)},n.Point.setTo=function(t){this.x=t.x,this.y=t.y},n.Point.setXY=function(t,e){this.x=t,this.y=e},n.set("Rectangle",n.Shape.mk()).namedType(),n.Rectangle.mk=function(t){var e=n.Rectangle.instantiate();return t&&(e.style&&e.style.setProperties(t.style),e.setPoint("corner",t.corner),e.setPoint("extent",t.extent)),e},n.Rectangle.set("corner",n.Point.mk()),n.Rectangle.set("extent",n.Point.mk(1,1)),n.Rectangle.corners=function(){var t=[],e=this.corner,r=e.x,o=e.y,i=this.extent,a=i.x,s=i.y;return t.push(e),t.push(n.Point.mk(r,o+s)),t.push(n.Point.mk(r+a,o+s)),t.push(n.Point.mk(r+a,o)),t},n.boundingRectangle=function(t){var e=t.length;if(0==e)return void 0;for(var r=t[0],o=r.x,i=o,a=r.y,s=a,c=1;e>c;c++){var u=t[c],h=u.x,l=u.y;i=Math.max(i,h),o=Math.min(o,h),s=Math.max(s,l),a=Math.min(a,l)}return n.Rectangle.mk({corner:n.Point.mk(o,a),extent:n.Point.mk(i-o,s-a)})},n.Rectangle.extendBy=function(t){var e=this.corners().concat(t.corners());return n.boundingRectangle(e)},n.Rectangle.center=function(){var t=this.extent,e=this.corner;return n.Point.mk(e.x+.5*t.x,e.y+.5*t.y)},n.Rectangle.width=function(){return this.extent.x},n.Rectangle.height=function(){return this.extent.y},n.Rectangle.scaleCentered=function(t){var e=this.width(),r=this.height(),o=this.center(),i=t*e,a=t*r,s=o.plus(n.Point.mk(-.5*i,-.5*a)),c=n.Point.mk(i,a);return n.Rectangle.mk({corner:s,extent:c})},n.Rectangle.plus=function(t){var e=n.Rectangle.mk({corner:this.corner.plus(t),extent:this.extent});return e},n.Rectangle.contains1=function(t){var e=this.corner,n=t.x;if(n<e.x)return!1;var r=t.y;if(r<e.y)return!1;var o=this.extent;return n>e.x+o.x?!1:r>e.y+o.y?!1:!0},n.Rectangle.distance2=function(t,e){if(!this.contains1(t))return void 0;var n=this.corner,r=this.extent,o=n.x+r.x,i=n.y+r.y,a=Math.min(t.x-n.x,o-t.x,t.y-n.y,i-t.y);return e>a?a:void 0},n.Rectangle.applyTransform=function(t){var e=t.rotation;if(0==e){var r=this.corner,o=this.extent,i=t.scale,a=r.applyTransform(t),s=o.times(i);return n.Rectangle.mk({corner:a,extent:s})}var c=this.corners(),u=c.map(function(e){return e.applyTransform(t)});return n.boundingRectangle(u)},n.Rectangle.transformTo=function(t){this.corner,t.corner;var e=this.center(),r=t.center(),o=this.width(),i=this.height(),a=t.width(),s=t.height(),c=a/o,u=s/i,h=Math.min(c,u),l=r.x-e.x*h,d=r.y-e.y*h,f=n.Transform.mk({translation:n.Point.mk(l,d),scale:h});return f},e.DNode.countShapes=function(){var t=1;return this.shapeTreeIterate(function(e){t+=e.countShapes()}),t},e.LNode.countShapes=e.DNode.countShapes,e.DNode.countNodes=function(){var t=1;return this.iterTreeItems(function(e){t+=e.countNodes()},!0),t},e.LNode.countNodes=e.DNode.countNodes,e.DNode.deepBounds=function(){if(this.style&&this.style.hidden)return void 0;var t=e.hasMethod(this,"bounds");if(t)var n=t.call(this);if(this.shapeTreeIterate(function(t){var e=t.deepBounds();if(e)if(n){n=n.extendBy(e);var r=n}else n=e,r=n}),!n)return n;var r=this.transform;return r?n.applyTransform(r):n},e.LNode.deepBounds=n.Shape.deepBounds}(__pj__),function(t){function e(t,n){n.__selected__?t.push(n):n.iterTreeItems(function(n){e(t,n)},!0)}function n(t){var e=s.rootTransform(),n=e.scale;s.setZoom(e,n*t),s.refresh()}function r(){u&&(n(cZoomFactor),setTimeout(r,l))}var o=t.om,i=t.dom,a=t.geom,s=t.set("draw",t.om.DNode.mk());s.__externalReferences__=[],s.viewerMode=0,s.theContext=void 0,s.hitContext=void 0,s.defaultLineWidth=1,s.hitCanvasDebug=0,s.computeBoundsEnabled=1,s.computeBoundsFromHitCanvas=0,s.hitCanvasEnabled=1,s.hitCanvasActive=1,s.dragEnabled=1,s.selectionEnabled=1,s.autoFit=0,s.panEnabled=1,s.set("Style",o.DNode.mk()).namedType(),s.Style.mk=function(t){return rs=Object.create(s.Style),rs.setProperties(t),rs},s.installType("Rgb"),s.mainCanvasActive=1,s.drawOps=o.DNode.mk(),s.drawOps.beginPath=function(){s.mainCanvasActive&&s.theContext.beginPath(),s.hitCanvasActive&&s.hitContext.beginPath()},s.test=function(){var t=s.theContext;t.fillStyle="rgba(255,0,0,1)",t.fillRect(25,25,100,100)},s.mainSaveDepth=0,s.hitSaveDepth=0,s.drawOps.save=function(){s.mainCanvasActive&&(s.theContext.save(),s.mainSaveDepth++,o.log("saveDepth","mainSaveDepth up",s.mainSaveDepth)),s.hitCanvasActive&&(s.hitContext.save(),s.hitSaveDepth++,o.log("saveDepth","hitSaveDepth up",s.hitSaveDepth))},s.drawOps.moveTo=function(t,e){if("number"==typeof t)var n=t,r=e;else var n=t.x,r=t.y;s.mainCanvasActive&&s.theContext.moveTo(n,r),s.hitCanvasActive&&s.hitContext.moveTo(n,r)},s.drawOps.lineTo=function(t,e){if("number"==typeof t)var n=t,r=e;else var n=t.x,r=t.y;s.mainCanvasActive&&s.theContext.lineTo(n,r),s.hitCanvasActive&&s.hitContext.lineTo(n,r)},s.drawOps.arc=function(t,e,n,r,o,i){s.mainCanvasActive&&s.theContext.arc(t,e,n,r,o,i),s.hitCanvasActive&&s.hitContext.arc(t,e,n,r,o,i)},s.drawOps.bezierCurveTo=function(t,e,n,r,o,i){s.mainCanvasActive&&s.theContext.bezierCurveTo(t,e,n,r,o,i),s.hitCanvasActive&&s.hitContext.bezierCurveTo(t,e,n,r,o,i)},s.drawOps.fillRect=function(t,e,n,r){s.mainCanvasActive&&s.theContext.fillRect(t,e,n,r),s.hitCanvasActive&&s.hitContext.fillRect(t,e,n,r)},s.drawOps.clearRect=function(t,e,n,r){s.mainCanvasActive&&s.theContext.clearRect(t,e,n,r),s.hitCanvasActive&&s.hitContext.clearRect(t,e,n,r)},s.drawOps.strokeRect=function(t,e,n,r){s.mainCanvasActive&&s.theContext.strokeRect(t,e,n,r),s.hitCanvasActive&&s.hitContext.strokeRect(t,e,n,r)},s.drawOps.restore=function(){s.mainCanvasActive&&(s.theContext.restore(),s.mainSaveDepth--,o.log("saveDepth","mainSaveDepth up",s.mainSaveDepth)),s.hitCanvasActive&&(s.hitContext.restore(),s.hitSaveDepth--,o.log("saveDepth","hitSaveDepth down",s.hitSaveDepth))},s.drawOps.stroke=function(){s.mainCanvasActive&&s.theContext.stroke(),s.hitCanvasActive&&s.hitContext.stroke()},s.drawOps.fill=function(){s.mainCanvasActive&&s.theContext.fill(),s.hitCanvasActive&&s.hitContext.fill()},s.drawOps.fillText=function(t,e,n){s.mainCanvasActive&&s.theContext.fillText(t,e,n),s.hitCanvasActive&&s.hitContext.fillText(t,e,n)},s.drawOps.measureText=function(t){return s.theContext.measureText(t)},s.Rgb.mk=function(t,e,n,r){var o=Object.create(s.Rgb);if("number"==typeof t)return o.r=t,o.g=e,o.b=n,"number"==typeof r&&(o.alpha=r),o;if("string"==typeof t){var i=e,a=/rgb\((\d*)\,(\d*)\,(\d*)\)$/,c=t.match(a);if(c)return s.Rgb.mk(parseInt(c[1]),parseInt(c[2]),parseInt(c[3]));if(i)return void 0;var a=/rgba\((\d*)\,(\d*)\,(\d*)\,(1|(?:\d*\.\d*))\)/,c=t.match(a);return c?s.Rgb.mk(parseInt(c[1]),parseInt(c[2]),parseInt(c[3]),parseFloat(c[4])):c}},s.Rgb.toString=function(){var t=this.alpha,e=this.r,n=this.g,r=this.b;return"number"==typeof t?"rgba("+e+","+n+","+r+","+t+")":"rgb("+e+","+n+","+r+")"},s.checkRgb=function(t){return o.check(t,"expected rgb(r,g,b)",function(t){var e=s.Rgb.mk(t,!0);return e?e.toString():void 0})},s.checkColor=function(t){return o.check(t,"expected a lower case color name, or rgb(r,g,b) or rgba(r,g,b,a)",function(t){var e=String(t),n=/^[a-z]+$/;if(e.match(n))return e;var r=s.Rgb.mk(t);return r?r.toString():void 0})},s.Style.setInputF("strokeStyle",s,"checkColor"),s.Style.setInputF("fillStyle",s,"checkColor"),s.randomRgb=function(){function t(){return Math.floor(255*Math.random())}return s.Rgb.mk(t(),t(),t()).toString()},s.randomColor=function(t,e,n){function r(t,e){return Math.floor(t+(e-t)*Math.random())}if("string"==typeof t)var o=s.Rgb.mk(t),i=s.Rgb.mk(e);else o=t,i=e;return s.Rgb.mk(r(o.r,i.r),r(o.g,i.g),r(o.b,i.b),n).toString()},s.indexToRgb=function(t){var e=30*t,n=256,r=e%n,o=Math.floor(e/n)%n,i=n*n,a=Math.floor(e/i)%n;return"rgba("+a+","+o+","+r+",1)"},s.rgbToIndex=function(t,e,n){var r=256,o=r*r;return n+r*e+o*t},o.DNode.setStrokeStyle=function(t){var e=this.get("__hitColor__");s.mainCanvasActive&&(s.theContext.strokeStyle=t),s.hitCanvasActive&&(s.hitContext.strokeStyle=e)},o.DNode.setLineWidth=function(t){return s.mainCanvasActive&&(s.theContext.lineWidth=t),s.hitCanvasActive&&(s.hitContext.lineWidth=Math.max(2,t)),!0},o.DNode.isSelected=function(){return this.get("__selected__")||this.get("__selectedPart__")},o.DNode.setFillStyle=function(t){var e=this.get("__hitColor__");s.mainCanvasActive&&(s.theContext.fillStyle=t),s.hitCanvasActive&&(s.hitContext.fillStyle=e)},s.drawOps.setFillStyle=function(t){s.mainCanvasActive&&(s.theContext.fillStyle=t),s.hitCanvasActive&&(s.hitContext.fillStyle="black")},s.drawOps.setFont=function(t){s.mainCanvasActive&&(s.theContext.font=t),s.hitCanvasActive&&(s.hitContext.font=t)};var c=s.drawOps;o.DNode.draw1d=function(t){var e=this.isSelected(),n=this.style;e&&(this.setStrokeStyle(s.highlightColor),this.setLineWidth(n.lineWidth+3),t()),this.setStrokeStyle(n.strokeStyle),this.setLineWidth(n.lineWidth),t()},o.DNode.draw2d=function(t,e){if(this.style){var n=this.style,r=n.fillStyle,o=n.strokeStyle,i=n.lineWidth;i||(i=1);var a=this.isSelected();r&&e&&(this.setFillStyle(r),e()),a&&t&&(this.setStrokeStyle(s.highlightColor),this.setLineWidth(i+2),t()),!t||!o||a&&r||(this.setStrokeStyle(o),this.setLineWidth(i),t())}},s.highlightColor="magenta",o.DNode.inWs=function(){if(this==s.wsRoot)return!0;var t=this.get("__parent__");return t?t.inWs():!1},o.LNode.inWs=o.DNode.inWs,o.DNode.select=function(t){if("canvas"==t&&o.unselect(),this.__selected__=1,this.deepSetProp("__selectedPart__",1),this.setPropForAncestors("__descendantSelected__",1,s.wsRoot),s.refresh(),"canvas"==t){this.expandToHere();var e=this.widgetDiv;e&&e.selectThisLine()}},o.LNode.select=o.DNode.select,s.mSelect=function(t){o.unselect(),t.forEach(function(t){t.select("tree")}),s.refresh()},s.allSelected=function(){var t=[];return e(t,s.wsRoot),t},o.DNode.unselect=function(){var t=this.__descendantSelected__;t&&(this.__descendantSelected__=0,this.__selected__&&(this.deepSetProp("__selectedPart__",0),this.__selected__=0),this.iterTreeItems(function(t){t.unselect()},!0))},o.LNode.unselect=o.DNode.unselect,o.unselect=function(){var t=s.wsRoot;t&&t.unselect()},s.clear=function(){var t=s.theCanvas.width(),e=s.theCanvas.height();c.clearRect(0,0,t,e)},s.setBkColor=function(){var t=s.theCanvas.width(),e=s.theCanvas.height(),n=s.theContext,r=s.hitContext;c.save(),s.mainCanvasActive&&(n.globalCompositeOperation="destination-over"),s.hitCanvasActive&&(r.globalCompositeOperation="destination-over"),s.mainCanvasActive&&(n.fillStyle=s.bkColor),s.hitCanvasActive&&(r.fillStyle="white"),c.fillRect(0,0,t,e),c.restore()},a.Transform.applyToContext=function(t){var e=this,n=e.translation;if(n)var r=n.x,o=n.y;var i=e.scale,a=e.rotation;n&&t.translate(r,o),i&&t.scale(i,i),"number"==typeof a&&t.rotate(a)},s.clearHitColors=function(){var t=s.shapesByHitColor;if(t)for(var e in t){var n=t[e];delete n.__hitColor__}s.shapesByHitColor={}},o.DNode.getTransform=function(){return this.get("transform")},o.LNode.getTransform=o.DNode.getTransform,o.DNode.deepDraw=function(t){if(t&&s.clearHitColors(),!this.style||!this.style.hidden){var e=this.getTransform();if(e){var n=s.theContext,r=s.hitContext;c.save(),s.mainCanvasActive&&e.applyToContext(n),s.hitCanvasActive&&e.applyToContext(r)}var i=o.hasMethod(this,"draw");if(i){if(this.style){var a=this.get("__hitColor__");a||(this.__hitColor__=a=s.randomRgb(),s.shapesByHitColor[a]=this);var u=this.draw;u.call(this)}}else this.shapeTreeIterate(function(t){o.isNode(t)&&t.deepDraw()});e&&c.restore()}},o.LNode.deepDraw=function(){var t=this.getTransform();if(t){alert("TRANSORM of LNODE");var e=s.theContext;c.save(),s.mainCanvasActive&&t.applyToContext(e)}this.shapeTreeIterate(function(t){o.isNode(t)&&t.deepDraw()}),t&&c.restore()},s.relCanvas=function(t,e){var n=t.offset();e.clientX-n.left,e.clientY-n.top;var r=e.pageX-n.left,o=e.pageY-n.top;return a.Point.mk(r,o)},s.dataDim=15,s.hitImageData=function(t){var e=Math.floor(s.dataDim/2);return s.hitContext.getImageData(t.x-e,t.y-e,s.dataDim,s.dataDim)},s.hitDim=400,s.hitDivs=40,s.computeBounds1=function(){function t(t,e,n){var r=4*(n*h+e);return 0==t[r]&&0==t[r+1]&&0==t[r+2]&&0==t[r+3]}var e=1/0,n=-1/0,r=1/0,o=-1/0,i=s.hitDim,c=s.hitDim,u=s.hitDivs,h=i/u,l=c/u;for(qx=0;u>qx;qx++)for(qy=0;u>qy;qy++)for(var d=qx*h,f=qy*l,p=s.hitContext.getImageData(d,f,h,l),_=p.data,v=0;h>v;v++)for(var m=0;l>m;m++){var g=t(_,v,m);if(!g){var y=v+d,b=m+f;e>y&&(e=y),y>n&&(n=y),r>b&&(r=b),b>o&&(o=b)}}return 1/0==e?void 0:a.Rectangle.mk({corner:[e,r],extent:[n-e,o-r]})},s.boundsTransform=a.Transform.mk({scale:.2,translation:[s.hitDim/2,s.hitDim/2]}),s.boundsTransformI=s.boundsTransform.inverse(),s.defaultBounds=a.Rectangle.mk({corner:[0,0],extent:[1e3,1e3]}),s.computeBounds=function(){var t=s.wsRoot;if(!s.computeBoundsFromHitCanvas){var e=t.deepBounds();return e?e:s.defaultBounds}if(!s.hitCanvasActive||!s.computeBoundsEnabled)return s.defaultBounds;t.transform,t.set("transform",s.boundsTransform),s.hitCanvas.attr({width:s.hitDim,height:s.hitDim}),s.mainCanvasActive=0,s.refresh();var n=s.computeBounds1(),r=t.deepBounds();if(o.log("draw","bounds from image ",n,"bounds from computation ",r),s.mainCanvasActive=1,s.hitCanvas.attr({width:s.canvasWidth,height:s.canvasHeight}),n)var n=n.applyTransform(s.boundsTransformI);else n=s.defaultBounds;return n},s.fitTransform=function(t){var e=t.deepBounds();if(e)return s.fitIntoCanvas(e,.95)},s.fitContents=function(){if(s.autoFit){var t=s.computeBounds();if(t){var e=s.fitIntoCanvas(t,.95);s.wsRoot.set("transform",e)}}},s.fitIntoPage=function(){var t=s.computeBounds();s.canvasWidth=$(window).width(),s.canvasHeight=$(window).height();var e=s.fitIntoCanvas(t,.8);s.wsRoot.set("transform",e),s.refresh()},s.refPoint=null,s.interpretedImageData=[],o.nodeMethod("draggableAncestor",function(){return this==t?void 0:this.draggable?this:this.__parent__.draggableAncestor()}),o.nodeMethod("uncomputedAncestor",function(){return this.isComputed()?this.__parent__.uncomputedAncestor():this}),s.interpretImageData=function(e){for(var n=e.length/4,r=s.dataDim,i=Math.floor(r/2),c=1/0,u=0;n>u;u++){var h=u%r-i,l=Math.floor(u/r)-i,d=h*h+l*l;if(c>d){var f=4*u,p=e[f],_=e[f+1],v=e[f+2],m=s.Rgb.mk(p,_,v).toString(),g=s.shapesByHitColor[m];if(g){if(a.Text.isPrototypeOf(g))return g;var y=g;c=d,o.log("untagged","cdist ",g.pathOf(t),c)}}}return y},s.rootTransform=function(){var t=s.wsRoot;if(t){var e=t.transform;return e||(e=a.Transform.mk(),t.set("transform",e)),e}},s.setZoom=function(t,e){var n=a.Point.mk(s.canvasWidth/2,s.canvasHeight/2),r=t.applyInverse(n);t.scale=e;var o=n.x-r.x*e,i=n.y-r.y*e,c=t.translation;c.x=o,c.y=i},s.adjustTransform=function(t,e){if(t){var n=Math.min(e.x,e.y),r=Math.min(s.canvasWidth,s.canvasHeight),o=t.scale,i=o*r/n,a=e.times(.5),c=t.applyInverse(a),u=.5*s.canvasWidth,h=.5*s.canvasHeight,l=u-c.x*i,d=h-c.y*i,f=t.translation;f.x=l,f.y=d,t.scale=i,c.applyTransform(t)}},s.init=function(){if(s.hitCanvasActive&&!s.hitCanvasDebug&&s.hitCanvas.css({display:"none"}),s.selectionEnabled||s.panEnabled){s.theCanvas.__element__.mousedown(function(t){i.unpop();var e=s.relCanvas(s.theCanvas.__element__,t);o.log("untagged","relCanvas",e.x,e.y),s.refPoint=e;var n=s.rootTransform(),r=n.translation;if(s.refTranslation=a.Point.mk(r.x,r.y),o.log("untagged",e.x,e.y),s.selectionEnabled){var c=s.hitImageData(e),u=c.data,h=s.interpretImageData(u);if(o.log("drag","SELECTED ",h),u=void 0,h){if(o.log("drag","selected",h.__name__),h.select("canvas"),s.dragEnabled&&h){var l=h.draggableAncestor();o.log("drag","DRAGGING ",l),l?(s.dragees=[l],s.refPos=[l.toGlobalCoords()],o.log("drag","refPos",s.refPos)):s.dragees=void 0}}else if(o.log("drag","No shape selected"),s.dragEnabled&&!s.panEnabled){var d=s.allSelected(),f=[],p=[];d.forEach(function(t){t.draggable&&(f.push(t),p.push(t.toGlobalCoords()))}),f.length?(s.dragees=f,s.refPos=p):s.dragees=void 0}if(s.dragEnabled&&(s.tree_of_selections=s.wsRoot.treeOfSelections()),s.dragees){var _="";s.dragees.forEach(function(t){_+=" "+t.__name__}),o.log("drag","starting drag of ",_)}}});var e=function(t){if(o.log("drag","doMove"),s.dragees)for(var e=s.relCanvas(s.theCanvas.__element__,t),n=e.difference(s.refPoint),r=s.dragees.length,i=0;r>i;i++){var a=s.dragees[i],c=s.refPos[i],u=c.plus(n);
o.log("drag",a.__name__,"delta",n,"npos",u),a.moveto(u);var h=a.transform;h.translation.transferToOverride(s.overrides,s.wsRoot,["x","y"]),h.transferToOverride(s.overrides,["scale","rotation"])}},n=function(t){var e=s.relCanvas(s.theCanvas.__element__,t),n=e.difference(s.refPoint);o.log("drag","doPan",n.x,n.y);var r=s.rootTransform(),i=r.translation;r.scale,i.x=s.refTranslation.x+n.x,i.y=s.refTranslation.y+n.y},r=function(){o.log("drag","mouseup"),s.refPoint=void 0,s.dragees=void 0,s.wsRoot&&(s.viewerMode||(s.wsRoot.deepUpdate(s.overrides),s.fitContents(),t.tree.adjust()),s.refresh())};s.theCanvas.__element__.mouseup(r),s.theCanvas.__element__.mouseleave(r),s.theCanvas.__element__.mousemove(function(t){s.dragees?(e(t),s.wsRoot.deepUpdate(s.overrides,s.tree_of_selections)):s.panEnabled&&s.refPoint&&n(t),s.refresh()})}},s.bkColor="rgb(10,10,30)",s.refresh=function(t){if(!t&&(s.clear(),s.mainCanvasActive&&s.theContext)){c.save();var e=s.theContext;if(s.wsRoot)var n=s.wsRoot.backgroundColor;n||(n=s.bkColor),e.fillStyle=n;var r=s.theCanvas.__element__.width(),o=s.theCanvas.__element__.height();e.fillRect(0,0,r,o),c.restore()}s.wsRoot&&s.wsRoot.deepDraw(1)},s.postFrame=function(t,e,n){this.theCanvas;var r=canvas.toDataURL("image/jpeg"),i="/api/addFrame",a={movie:t,frameNum:e,jpeg:r};o.log("untagged","posting Frame ",e),o.post(i,a,function(t){o.log("untagged","POSTED"),n&&n(t)})},s.postCanvas=function(t,e){this.theCanvas;var n=canvas.toDataURL("image/jpeg"),r="/api/postCanvas",i={path:t,jpeg:n};o.log("untagged","posting Frame ",t),o.ajaxPost(r,i,function(t){o.log("untagged","POSTED"),e&&e(t)})},s.emptyWs=function(e,n){if(n){var r=n.width,o=n.height,i=n.offset;if(i)var c=i.x,u=i.y;else c=0,u=0}var h=s.wsRoot=a.Shape.mk();if(t.set(e,h),n){var l=a.mkTranslation(a.Point.mk(c+r/2,u+o/2));h.set("transform",l),n.scale&&(l.scale=n.scale)}return h},s.clearWs=function(){var e=s.wsRoot;if(e){var n=e.__name__;delete t.top[n]}},s.update=function(){o.deepUpdate(o.root)},o.DNode.visibleProtoEffects1=function(t,e,n){if(o.hasMethod(this,"draw")){var r=void 0!==n;r?this.treeInheritsPropertyFrom(e,n)&&t.push(this):this.treeInheritsSomePropertyFrom(e)&&t.push(this)}else this.iterTreeItems(function(r){r.visibleProtoEffects1(t,e,n)},!0)},o.LNode.visibleProtoEffects1=o.DNode.visibleProtoEffects1,o.DNode.visibleProtoEffects=function(t){var e=[];return s.wsRoot.visibleProtoEffects1(e,this,t),e},o.DNode.drawnAncestor=function(){for(var t=this,e=void 0;t!==s.wsRoot;)o.hasMethod(t,"draw")&&(e=t),t=t.__parent__;return e},o.LNode.drawnAncestor=o.DNode.drawnAncestor,o.DNode.drawnDescendants1=function(t){return o.hasMethod(this,"draw")?(t.push(this),void 0):(this.iterTreeItems(function(e){e.drawnDescendants1(t)},!0),void 0)},o.LNode.drawnDescendants1=o.DNode.drawnDescendants1,o.DNode.drawnDescendants=function(){var t=[];return this.drawnDescendants1(t),t},o.LNode.drawnDescendants=o.DNode.drawnDescendants,s.fitIntoCanvas=function(t,e){var n=a.Point.mk(s.canvasWidth,s.canvasHeight).toRectangle().scaleCentered(e),r=t.transformTo(n);return r},o.DNode.hide=function(){var t=this.style;if(!t)var t=this.set("style",o.DNode.mk());return t.hidden=1,this},o.DNode.show=function(){var t=this.style;return t&&(t.hidden=0),this},s.animateStep=function(){var t=s.wsRoot.step;t&&"function"==typeof t&&(t(),s.refresh())},s.animate=function(){var t=s.wsRoot.framesPerSecond,e=s.wsRoot.frameCount,n=s.wsRoot.initialState(),r=0,o=1e3/t,i=function(){r+=1,e&&r>e||(n=s.wsRoot.step(n),s.refresh(),setTimeout(i,o))};i()},s.manimd=500,s.manimate=function(t){0!=t&&(s.animate(),setTimeout(function(){s.manimate(t-1)},s.manimd))};var u=!1,h=1.1,l=150;s.startZooming=function(){cZoomFactor=h,u||(u=1,r())},s.startUnZooming=function(){cZoomFactor=1/h,u||(u=1,r())},s.stopZooming=function(){u=0}}(__pj__),function(t){var e=t.om,n=t.geom,r=t.draw,o=r.drawOps;n.Point.setInputF("x",e,"checkNumber"),n.Point.setInputF("y",e,"checkNumber"),n.Transform.setInputF("scale",e,"checkPositiveNumber"),n.set("Line",n.Shape.mk()).namedType(),n.Line.set("style",r.Style.mk({strokeStyle:"black",lineWidth:1})),r.Style.setInputF("lineWidth",e,"checkPositiveNumber"),n.Line.mk=function(t){var e=n.toPoint(t.e0),r=n.toPoint(t.e1),o=n.Line.instantiate();return o.set("e0",e),o.set("e1",r),o.style.setProperties(t.style),o},n.Line.setTo=function(t){this.e0.setTo(t.e0),this.e1.setTo(t.e1)},n.Line.pathLength=function(){var t=this.e0,e=this.e1;return t.distance(e)},n.Line.pathPosition=function(t){var e=this.e0,n=this.e1,r=n.difference(e),o=r.times(t);return e.plus(o)},n.Line.pointAtDistance=function(t){var e=this.pathLength(),n=t/e;return this.pathPosition(n)},n.distanceToLine=function(t,e,n){var r=n.difference(t),o=e.difference(t),i=r.dotp(o);if(0>=i)return n.distance(t);var a=n.difference(e),s=a.dotp(o);if(s>=0)return n.distance(e);var c=o.normal().normalize(),u=Math.abs(r.dotp(c));return u},n.Line.draw=function(){var t=this.e0,e=this.e1,n=function(){o.beginPath(),o.moveTo(t.x,t.y),o.lineTo(e.x,e.y),o.stroke()};o.save(),this.draw1d(n),o.restore()},n.Rectangle.set("style",r.Style.mk({strokeStyle:"black",fillStyle:"red",lineWidth:1})),n.Rectangle.draw=function(){var t=this.style;if(t){var e=this.corner,n=this.extent,r=n.x,i=n.y,a=e.x,s=e.y;o.save();var c=function(){o.strokeRect(a,s,r,i)},u=function(){o.fillRect(a,s,r,i)};this.draw2d(c,u),o.restore()}},n.Rectangle.bounds=function(){return this},n.set("BezierSegment",n.Shape.mk()).namedType(),n.set("Bezier",n.Shape.mk()).namedType(),n.Bezier.set("style",r.Style.mk({strokeStyle:"black",lineWidth:1})),n.Bezier.draw=function(){var t=this.segments;if(t){var e=this.startPoint,n=t.length,r=function(){o.beginPath(),o.moveTo(e.x,e.y);for(var r=0;n>r;r++){var i=t[r],a=i.cp1,s=i.cp2,c=i.dest;o.bezierCurveTo(a.x,a.y,s.x,s.y,c.x,c.y)}o.stroke()};o.save(),this.draw1d(r),o.restore()}},n.set("Arc",n.Shape.mk()).namedType(),n.Arc.set("style",r.Style.mk({strokeStyle:"black",lineWidth:1})),n.Arc.radius=100,n.Arc.startAngle=0,n.Arc.endAngle=2*Math.PI,n.mkArcFromEndPoints=function(t,e,r){var o=e.difference(t),i=.5*o.length(),a=Math.sqrt(r*r-i*i);0>r&&(a=-a);var s=o.normalize(),c=s.normal(),u=t.plus(o.times(.5)),h=u.plus(c.times(a)),l=t.difference(h),d=e.difference(h),f=n.angle2normalRange(Math.atan2(l.y,l.x)),p=n.angle2normalRange(Math.atan2(d.y,d.x)),_=n.Arc.instantiate();return _.startAngle=f,_.endAngle=p,_.set("center",h),_.radius=Math.abs(r),_},n.Arc.mk=function(t){var e=n.Arc.instantiate();return e.setProperties(t,["startAngle","endAngle","radius"]),e.style.setProperties(t.style),e.setPoint("center",t.center),e},n.degreesToRadians=function(t){return Math.PI*(t/180)},n.radiansToDegrees=function(t){return 180*(t/Math.PI)},n.Arc.bounds=function(){for(var t=this.startAngle,e=this.endAngle,r=e-t,o=5,i=r/o,a=this.center,s=[],c=this.radius,u=0;o>u;u++){var h=t+u*i,l=n.Point.mk(Math.cos(h),Math.sin(h)),d=a.plus(l.times(c));s.push(d)}var f=n.boundingRectangle(s);return f},n.checkAngle=function(t){return e.check(t,"expected number in units of degrees",function(){return isNaN(t)?void 0:n.degreesToRadians(t)})},e.DNode.degreesField=function(t){this.setInputF(t,n,"checkAngle"),this.setOutputF(t,n,"radiansToDegrees")},n.Arc.degreesField("startAngle"),n.Arc.degreesField("endAngle"),n.Arc.setInputF("radius",e,"checkPositiveNumber"),n.Arc.pathLength=function(){var t=this.startAngle,e=this.endAngle,n=this.radius,r=Math.abs(e-t)*n;return r},n.Arc.pathPosition=function(t){var e=this.center,r=n.angle2normalRange(this.startAngle),o=n.angle2normalRange(this.endAngle),i=this.radius,a=t*(o-r),s=r+a,c=n.Point.mk(i*Math.cos(s),i*Math.sin(s)).plus(e);return c},n.angle2normalRange=function(t){if(t==2*Math.PI)return t;var e=2*Math.PI;if(0>t){var n=Math.floor(-t/e);t+=(n+1)*e}return t%e},n.angleIsBetween=function(t,e,r){var o=n.angle2normalRange(t-e),i=n.angle2normalRange(r-e);return i>o},n.Arc.draw=function(){var t=this.startAngle,e=this.endAngle,n=this.radius,r=this.center;if(r)var i=r.x,a=r.y;else i=0,a=0;var s=function(){o.beginPath(),o.arc(i,a,n,t,e,e>t?0:1),o.stroke()};o.save(),this.draw1d(s),o.restore()},n.set("Circle",n.Arc.instantiate()).namedType(),n.Circle.setf("startAngle",0),n.Circle.setf("endAngle",2*Math.PI),n.Circle.mk=function(t){var e=n.Circle.instantiate();return e.setProperties(t,["radius"]),e.style.setProperties(t.style),e.setPoint("center",t.center),e},n.Circle.xIntercepts=function(t,e){t||(t=0);var n=this,r=n.center,o=n.radius+e,i=r.x,a=r.y-t,s=Math.abs(a);if(s>o)return[];var c=Math.sqrt(o*o-a*a);return[i-c,i+c]},n.Circle.containsPoint=function(t){var e=this.center,n=this.radius,r=e.distance(t);return n>=r},n.Circle.draw=function(){if(0!=this.radius){var t=this.radius,e=this.center;if(e)var n=e.x,r=e.y;else n=0,r=0;var i=function(){o.beginPath(),o.arc(n,r,t,0,2*Math.PI,0),o.stroke()},a=function(){o.beginPath(),o.arc(n,r,t,0,2*Math.PI,0),o.fill()};o.save(),this.draw2d(i,a),o.restore()}},n.set("Text",n.Shape.mk()).namedType(),n.Text.set("style",r.Style.mk({align:"center",font:"arial",height:10})),n.Text.style.setInputF("height",e,"checkPositiveNumber"),n.Text.mk=function(t){var e=n.Text.instantiate();return e.text=t.text,t.pos?e.set("pos",n.toPoint(t.pos)):e.set("pos",n.Point.mk()),e.style.setProperties(t.style),e},n.Text.draw=function(){var t=this.pos,e=this.style,n=e.font,i=e.height,a=e.align;i&&(n=i+"px "+n);var s=this.text,c=this.isSelected();if(o.save(),o.setFont(n),c||"center"==a)var u=o.measureText(s).width;if("center"==a)var h=t.x-.5*u;else h=t.x;c&&(this.setFillStyle(r.highlightColor),o.fillRect(h,t.y-i,u,Math.floor(1.4*i))),this.setFillStyle(e.fillStyle),o.fillText(s,h,t.y),o.restore()}}(__pj__),function(t){function e(e,r){var o=e.toString(),i=t.mainPage.lightbox;i.pop(),i.setTopline(r+" = ");var a=o.split("\n"),s="";a.forEach(function(t){var e=t.replace(/ /g,"&nbsp;");s+="<div>"+e+"</div>"});var s="<pre>"+n.escapeHtml(o)+"</pre>";i.setContent(s)}var n=t.om,r=t.dom,o=t.draw,i=t.page,a=t.set("tree",n.DNode.mk());n.inspectEverything=1,a.showFunctions=0,a.showNonEditable=1,a.installType("TreeWidget"),a.newTreeWidget=function(t){this.setProperties(t,["textProto","rootPos"])};var s=t.jqPrototypes;t.mainPage,a.installType("WidgetLine",Object.create(r.JQ)),a.set("valueProto",r.newJQ({tag:"span"})),a.newWidgetLine=function(t){return r.newJQ(t,a.WidgetLine)};var c=a.newWidgetLine({tag:"div",style:{"font-size":"10pt",color:"black",width:"100%"}});s.set("widgetLine",c);var u=c.addChild("main",r.newJQ({tag:"div",style:{}}));u.addChild("toggle",r.newJQ({tag:"span",html:"&#x25BA;",cursor:"pointer",style:{color:"black"}})),u.addChild("theName",r.newJQ({tag:"span",style:{color:"black"}})),n.mline=u,a.wline=c;var h=r.newJQ({tag:"div",style:{color:"black"}});s.set("protoButton",a.newWidgetLine({tag:"span",html:"proto",style:{color:"black",width:"100px"}})),n.DNode.mkWidgetLine=function(e,n,r,o,i){if(!a.onlyShowEditable||!this.__mfrozen__){var s=c.instantiate(),u=s.selectChild("main");if(o){var h=u.selectChild("toggle");h.hide()}if(i)var l=this.pathOf(t),d=l?l.join("."):"";else d=r(this);var f=function(){s.toggle()};if(n)var p=function(){n(s)};if(!o){var _=u.selectChild("toggle");_.set("click",f),this.__leaf__&&(_.html=" ")}var v=u.selectChild("theName");v.html=d,this.hasTreeProto();var m="black";return v.style.color=m,p&&(v.click=p),o||(this.widgetDiv=s),s.forNode=this,s}},a.WidgetLine.treeChild=function(t){var e=this.selectChild("forChildren");return e?e.selectChild(t):void 0},a.WidgetLine.treeChildren=function(){var t=this.selectChild("forChildren");return t?t.theChildren:void 0},a.WidgetLine.treeParent=function(){var t=this.parent();return t?t.parent():void 0},a.WidgetLine.selectTreePath=function(t){for(var e=this,n=t.length,r=0;n>r;r++){var e=e[t[r]];if(!e)return void 0}return e},a.WidgetLine.treeTop=function(){if(this.__treeTop__)return this;var t=this.treeParent();return t.treeTop()},a.WidgetLine.treeChildren=function(){if(this.__prim__)return[];var t=this.selectChild("forChildren");return t?t.theChildren:[]},a.WidgetLine.childrenNames=function(){var t=[],e=this.treeChildren();return e.forEach(function(e){var n=e.id;void 0!==n&&t.push(n)}),t},a.WidgetLine.treeSelect=function(t){if(this.__prim__)return void 0;var e=this.selectChild("forChildren");if(e)for(var n=e.theChildren,r=n.length,o=0;r>o;o++){var i=n[o],a=i.id;if(a==t)return i}return void 0},a.WidgetLine.selectedLine=function(){var t=this.treeTop();return t.__selectedLine__},a.WidgetLine.highlightedPart=function(){return this.__prim__?this.cssSelect("#title"):this.__ref__?this:this.selectChild("main")},a.WidgetLine.unselectThisLine=function(){this.__selected__=0;var t=this.highlightedPart(),e=t.__element__;e.css({"background-color":"white"})},a.WidgetLine.selectThisLine=function(e){var r=this.forNode,i=this.forParentNode;this.forProp;var s=[];if(a.selectedLine=this,!this.__selected__){a.selectedNode=r;var c=this.treeTop(),u=c.protoTree,h=c.fileTree,l=!(u||h),d=!h&&"tree"==e;if(l&&a.clearProtoTree(),c.dpySelected,u){if(r){var f=n.pathOf(r,t);f.join("."),d&&(s=r.visibleProtoEffects())}}else if(l){if(r)var p=r;else p=i;if(r){var _=p.drawnAncestor();s=_?[_]:p.drawnDescendants()}}var v=c.__selectedLine__,m=c.__element__.parent().parent();this.__selected__=1,v&&v.unselectThisLine();var g=this.highlightedPart().__element__;g.css({"background-color":"rgb(100,140,255)"}),c.__selectedLine__=this;var y=m.height(),b=m.offset().top;n.log("tree","SELECTION STAGE 0 offset ",g.offset());var C=g.offset().top,N=m.scrollTop(),x=C-(b+y);x>-40?m.scrollTop(N+x+40):(x=b-C,x>-40&&m.scrollTop(N-x-40)),n.log("tree","SELECTION STAGE 1"),l&&(this.__prim__?a.showProtoChain(this.forParentNode,this.forProp):this.__ref__?a.showRef(this.forNode):(a.showProtoChain(this.forNode),this.expanded&&this.expandProtoChain())),d&&o.mSelect(s),n.log("tree","SELECTION DONE")}},a.WidgetLine.ancestorIsSelected=function(){if(this.__selected__)return 1;var t=this.treeParent();return t?t.ancestorIsSelected():0},a.showRef=function(t){var e=a.showProtoTop(t,0);return a.setProtoTitle("Reference"),a.protoPanelShowsRef=1,e.expand(),e},a.WidgetLine.expandLike=function(t){var e=t.childrenNames(),n=e.length;if(n){this.expand();var r=this;e.forEach(function(e){var n=t.treeSelect(e),o=r.treeSelect(e);o&&(n.__protoLine__=o,n.expanded&&o.expandLike(n))})}},a.WidgetLine.applyToProtoChain=function(t){for(var e=this.forNode;;){var e=Object.getPrototypeOf(e),n=e.__protoLine__;if(!n)return;t(n)}},a.WidgetLine.expandProtoChain=function(){this.applyToProtoChain(function(t){t.expand()})},a.WidgetLine.contractProtoChain=function(){this.applyToProtoChain(function(t){t.contract()})},n.LNode.mkWidgetLine=n.DNode.mkWidgetLine;var l={__record__:1,__isType__:1,__record_:1,__externalReferences__:1,__selected__:1,__selectedPart__:1,__notes__:1,__computed__:1,__descendantSelected__:1,__fieldStatus__:1,__source__:1,__about__:1,__overrides__:1,__mfrozen__:1,__inputFunctions__:1,__outputFunctions__:1,__current__:1,__canvasDimensions__:1,__beenModified__:1,__autonamed__:1,__origin__:1,__from__:1,__changedThisSession__:1,__topNote__:1,__saveCount__:1,__saveCountForNote__:1};a.hasEditableField=function(t,e){for(var r in t)if(!n.internal(r)&&!l[r]){var o=t[r];if("function"==typeof o)continue;var i=void 0;if(e)var i=e[r];var s=n.isNode(o);if(s){var c=a.hasEditableField(o,i);if(c)return!0}else if(!i&&!t.fieldIsFrozen(r))return!0}return!1},a.applyOutputF=function(t,e,n){var r=t.getOutputF(e);return r?r(n,t):n},a.WidgetLine.popNote=function(){var t=this.forNode,e=this.forParentNode,n=this.forProp,r="";if(e)var r=e.getNote(n),o=n;else{var i=t.__parent__;o=t.__name__,r=i.getNote(o)}r&&a.setNote(o,r)},a.mkPrimWidgetLine=function(c){function u(t){var e=r.measureSpan;if(!e){var e=$("<span></span>");e.css("font","8pt arial"),$("body").append(e),e.hide()}e.html(t);var n=e.width();return e.remove(),n}var h=c.node,l=c.property,d=c.clickFun;c.isProto;var f=c.overridden,p=c.noEdit,_=c.atFrontier,v=h.hasOwnProperty(l),m=h;if(n.DataSource.isPrototypeOf(h)&&"data"==l,m.__parent__&&!n.inStdLib(m)){var g=h.fieldIsFrozen(l);h.isComputed();var y=a.applyOutputF(h,l,h[l]);if("function"!=typeof y||v){var b="black",C=a.newWidgetLine({tag:"div",style:{color:b}});C.__prim__=1,C.forParentNode=h,C.forProp=l;var N,x="function"==typeof y,P=l;if(h.getNote(l)){var k=r.newJQ({tag:"span",html:"? ",style:{cursor:"pointer","font-weight":"bold"}});C.addChild("qm",k);var N=function(){C.popNote()};k.click=N;var T=r.newJQ({tag:"span",html:P,style:{cursor:"pointer",color:b}});T.click=N}else var T=r.newJQ({tag:"span",html:P,style:{color:b}});if(C.addChild("title",T),d){var D=function(){d(C)};C.click=D}var w=!(g||f||p);if(x){if(!a.showFunctions)return;var O=s.button.instantiate();O.html=" Function ",C.addChild("funb",O);var S=n.pathToString(h.pathOf(t).concat(l),".");O.click=function(){e(y,S)}}else{if(!v&&!_&&!p)var L=1;if(a.onlyShowEditable&&!w)return void 0;if(f)I="<b>overridden</b>";else if(L)var I="inherited";else I=n.nDigits(y,4);if(I||(I=""),w){var A=function(t){var e=u(t);return Math.max(50,e+20)},j=A(I),R=r.newJQ({tag:"input",type:"input",attributes:{value:I},style:{font:"8pt arial","background-color":"#e7e7ee",width:j+"px","margin-left":"10px"}}),M=function(){var t=a.applyOutputF(h,l,h[l]),e=R.__element__.prop("value");if(""==e)delete h[l];else{if("inherited"==e)return;var r=h.getInputF(l);if(r){var s=r(e,h);if(n.isObject(s))return i.alert(s.message),R.__element__.prop("value",t),void 0}else{var s=parseFloat(e);isNaN(s)&&(s=$.trim(e))}if(t==s)return n.log("tree",l+" UNCHANGED ",t,s),void 0;n.log("tree",l+" CHANGED",t,s),h[l]=s,h.transferToOverride(o.overrides,o.wsRoot,[l]);var c=A(String(s));R.css({width:c+"px"}),o.wsRoot.__changedThisSession__=1,h.isComputed()&&h.addOverride(o.overrides,l,o.wsRoot)}a.autoUpdate?a.updateAndShow("tree"):o.refresh()};R.blur=M,R.enter=M}else{var R=a.valueProto.instantiate();R.html=" "+I}C.addChild("val",R)}return C}}},a.mkRangeWidgetLine=function(t,e,n,r){var o="black",i=c.instantiate();i.__range__=1,i.forNode=t,i.lowerBound=e,i.upperBound=n,i.increment=r;var a="["+e+"..."+n+"]",s=i.selectChild("main"),u=s.selectChild("theName");u.html=a,i.id=a;var h=s.selectChild("toggle"),o=function(){i.toggle()};return h.click=o,i},a.mkRefWidgetLine=function(t,e,o){var i=n.refPath(o,t);if(!i)return void 0;var s="black",c=a.newWidgetLine({tag:"div",style:{color:s}});c.forNode=o;var u=r.newJQ({tag:"span",html:e+" REF "+i,style:{color:s}});return c.addChild("ttl",u),c.click=function(){c.selectThisLine("tree")},c.__ref__=1,c},a.WidgetLine.visible=function(){if(this.__treeTop__)return!0;var t=this.treeParent();return t.visible()&&t.expanded},a.WidgetLine.nonRangeParent=function(){var t=this.treeParent();return t?t.__range__?t.nonRangeParent():t:void 0},a.WidgetLine.checkRanges=function(){var t=this.rangesForSize;if(void 0==t)return!0;var e=this.forNode,r=t==e.length;return n.log("tree","checked range for",this.id," result=",r),r},a.WidgetLine.adjust=function(){var t=0,e=this.id;n.log("checking adjustment of",e);var r=this.__range__,o=this.nonRangeParent(),i=this.forNode,s=this.__prim__;if(s){var c=this.forParentNode,u=this.forProp,h=a.applyOutputF(c,u,c[u]),d=this.selectChild("val");return d.prop("value",h),n.log("tree","checked adjustment of ",e,"ok"),void 0}if(o)if(r){if(!o.checkRanges())return n.log("tree","checked adjustment of ",e,"ADJUSTMENT NEEDED"),!0}else{var f=o.forNode,i=f[e];if(!i||"object"!=typeof i)return n.log("tree","checked adjustment of ",e,"ADJUSTMENT NEEDED"),!0;i!=this.forNode&&n.log("tree","adjusted "+e),this.forNode=i,i.widgetDiv=this}else i=this.forNode;var p=this.treeChildren();return p&&p.forEach(function(e){e.__prim__&&(e.forParentNode=i),e.adjust()&&(n.log("tree",e.id,"needed adjustment"),t=1)}),r||!this.expanded||t||i.iterTreeItems(function(e){l[e.__name__]||e.widgetDiv||(n.log("tree","child without widgetDiv found:",e.__name__),t=1)},!0),t&&(n.log("tree","reExapanding ",i.__name__),this.reExpand()),n.log("tree","checked adjustment of ",e,"ok"),!1},a.WidgetLine.reExpand=function(){var t=this.selectChild("forChildren");t&&(t.removeChildren(),t.__reExpanding__=1,this.expanded=0,this.expand(),t.__reExpanding=0)},a.WidgetLine.expand=function(t,e,o){function i(r,i,s,c){if(!l[s]&&!r.selectChild(s)){var u=n.isNode(c);if(u&&!i.treeProperty(s)){if(!i.hasOwnProperty(s))return;var h=a.mkRefWidgetLine(d.forNode,s,c)}else if(u){if(a.onlyShowEditable&&!a.hasEditableField(i[s],t?t[s]:void 0))return;var h=c.mkWidgetLine(!0,d.__clickFun__,d.__textFun__,f)}else{var p=t&&t[s],_={node:i,property:s,clickFun:d.__clickFun__,isProto:f,overridden:p,noEdit:e,atFrontier:o};h=a.mkPrimWidgetLine(_)}return h&&r.addChild(s,h),h}}function s(t,e,n,r){var o=a.mkRangeWidgetLine(t,e,n,r);return _.addChild(b,o),o}function c(t,e,n,r){if(10>r)for(var o=e;n>=o;o++){var a=t[o];i(_,t,o,a)}else for(var c=e,u=e;n>u;){var u=Math.min(n,c+r-1);u+1>=n&&(u=n),s(t,c,u,r),c+=r}}function u(t){t.__element__&&t.install(),t.expanded=1,t.hasBeenExpanded=1}var h=this.forNode;if(!h)return!1;if(a.onlyShowEditable&&!a.hasEditableField(h,t))return!1;var d=this.treeTop(),f=d.protoTree&&!a.protoPanelShowsRef;d.fileTree,f&&h.__protoLine__;var p=n.LNode.isPrototypeOf(h);if(!this.expanded){var _=this.selectChild("forChildren");if(_)v=_.__reExpanding__,_.show();else{_=r.newJQ({tag:"div",style:{"margin-left":"20px"}}),this.addChild("forChildren",_);var v=!0}if(this.__range__&&v){var m=this.lowerBound,g=this.upperBound,y=this.increment,y=y/10;return c(h,m,g,y),u(this),void 0}if(rs=void 0,v)if(this.__multiRoot__){for(var b in h)if(h.hasOwnProperty(b)&&"widgetDiv"!=b&&!n.internal(b)){var C=h[b];ln=i(_,h,b,C)}}else{var N=function(t,e){i(_,h,e,t)};if(p){var x=h.length,P=Math.floor(Math.log(x)/Math.log(10)),y=Math.pow(10,P);2*y>x&&(y/=10),c(h,0,x-1,y),this.rangesForSize=x}else h.iterInheritedItems(N,a.showFunctions,!0)}else _.show();return u(this),f||this.expandProtoChain(),rs}},a.WidgetLine.fullyExpand=function(t,e,n){this.expand(t,e,n);var r=this.treeChildren();r&&r.forEach(function(r){if(!r.__prim__){var o=r.forNode,i=o.__name__,a=t?t[i]:void 0;r.fullyExpand(a,e,n)}})},n.DNode.ancestorWithWidgetLine=function(){for(var t=[],e=this;;){if(e.widgetDiv)return{node:e,path:t};if(t.unshift(e.__name__),e=n.getval(e,"__parent__"),!e)return void 0}},n.DNode.ancestorBelow=function(t){var e=n.getval(this,"__parent__");return e?e==t?this:e.ancestorBelow(t):void 0},n.DNode.addWidgetLine=function(e){if(!this.widgetDiv){var r=n.pathOf(this,t),o=this.ancestorWithWidgetLine();if(e)var i=e;if(e&&!o){var a=e.forNode,s=this.ancestorBelow(t);a[s.__name__]=s;var c=e.selectChild("forChildren")}else{var r=o.path,a=o.node,u=a.widgetDiv;i=u.treeTop(),r[0],c=u.selectChild("forChildren")}if(c){var h=this.mkWidgetLine(!0,i.__clickFun__,i.__textFun__);c.addChild(this.__name__,h),h.install()}}},a.WidgetLine.findRangeChild=function(t){var e=this.treeChildren();if(e&&e.length){var n=e[0],r=n.__range__;if(r)for(var o=e.length,i=0;o>i;i++){var a=e[i],s=a.lowerBound,c=a.upperBound;if(t>=s&&c>=t)return a}}return void 0},n.DNode.expandToHere=function(){var t=n.getval(this,"widgetDiv");if(!t||!t.visible()){var e=this.__parent__;e.expandToHere();var r=n.getval(e,"widgetDiv");r.expand();var o=n.LNode.isPrototypeOf(e);if(o)for(var i=this.__name__,a=r;a;){var a=a.findRangeChild(i);a&&a.expand()}}},n.LNode.expandToHere=n.DNode.expandToHere,a.WidgetLine.contract=function(){if(this.expanded){var t=this.selectChild("forChildren");t.hide(),this.expanded=!1,this.contractProtoChain()}},a.WidgetLine.toggle=function(){var t=this.cssSelect("#main>#toggle");this.expanded?(this.contract(),t.__element__.html("&#x25BA;")):(this.expand(),this.forNode,t.__element__.html("&#x25BC;"))},n.LNode.expandWidgetLine=n.DNode.expandWidgetLine,n.LNode.contractWidgetLine=n.DNode.contractWidgetLine,n.LNode.toggleWidgetLine=n.DNode.toggleWidgetLine,a.attachTreeWidgets=function(t,e,r,o,i,a){if(e.length,i){var s=n.DNode.mk();e.forEach(function(t){s[t.__name__]=t})}else s=e[0];var c=h.instantiate(),u=s.mkWidgetLine(!0,r,o,a,!0);return u.__treeTop__=1,u.__multiRoot__=i,c.install(t),u.install(t),u.__clickFun__=r,u.__textFun__=o,u.dpySelected=c,u},a.attachTreeWidget=function(t,e,n,r,o){return a.attachTreeWidgets(t,[e],n,r,!1,o)},n.DNode.atProtoFrontier=function(){return prnd=Object.getPrototypeOf(this),!prnd.__parent__||!prnd.inWs()},a.showProto=function(t,e,n,r){var o=t.inWs();if(o)var i=!Object.getPrototypeOf(t).inWs();else i=!1;var s=a.showProtoTop(t,n);t.__protoLine__=s,s.fullyExpand(r,!o,i)},a.showProtoChain=function(t,e){function r(t,e,o){var i=Object.getOwnPropertyNames(t);i.forEach(function(i){var a=t[i],c=e[i];if(n.isAtomic(a)||"function"==typeof a)o[i]=1;else if(t.treeProperty(i)){if(!c)return;var u=s[i];u||(s[i]=u={}),r(a,c,u)}})}a.protoPanelShowsRef=0,a.protoState={nd:t,k:e},a.setProtoTitle("Prototype Chain"),a.protoDivRest.empty();var o=t,i=0,s={};r(t,Object.getPrototypeOf(t),s);for(var c=!0;;){var u=Object.getPrototypeOf(o);if(!u.__parent__||u==o)return;var h=c&&!u.inWs();h&&(a.protoDivRest.__element__.append("<div style='margin-top:10pt;margin-bottom:10pt;width:100%;height:2px;color:white;background-color:red'>_</div>"),a.protoDivRest.__element__.append("<div style='font-size:8pt'>The prototypes below are outside the workspace and cannot be edited</div>"),c=!1),a.showProto(u,e,i++,s),o=u,r(o,Object.getPrototypeOf(o),s)}},a.refreshProtoChain=function(){var t=a.protoState;t&&a.showProtoChain(t.nd,t.k)},a.shapeTextFun=function(t){var e=t.__name__,n="undefined"==typeof e?"root":e,r=t.protoName();return"DNode"==r?n:n+" : "+r},a.setProtoTitle=function(t){a.protoDivTitle.__element__.html(t)},a.showProtoTop=function(t){var e=a.protoSubDiv.instantiate();a.protoDivRest.addChild(e),e.install();var r=function(t){n.log("tree","CLICKKK ",t),t.selectThisLine("tree")},o=a.attachTreeWidget(e.__element__,t,r,a.shapeTextFun,!0);return o.protoTree=1,o},a.clearProtoTree=function(){a.protoDivRest.__element__.empty()},a.attachShapeTree=function(t){var e=function(t){n.log("tree","CLICKKK ",t),t.selectThisLine("tree")};a.obDivRest.empty();var r=a.attachTreeWidgets(a.obDivRest.__element__,[t],e,a.shapeTextFun);n.shapeTree&&r.expandLike(n.shapeTree),n.shapeTree=r},n.attachProtoTrees=function(t){var e=function(t){n.log("tree","CLICKKK ",t),t.selectThisLine("tree")};a.protoTree=a.attachTreeWidgets($("#obDiv"),t,e,a.shapeTextFun,!0)},a.excludeFromProtos={om:1,fileTree:1,jqPrototypes:1,lightbox:1,geom:1,mainPage:1,top:1,trees:1,draw:1},a.initProtoTreeWidget=function(){var e=Object.keys(t),n=[];e.forEach(function(e){a.excludeFromProtos[e]||n.push(t[e])}),a.attachProtoTrees(n)},a.initShapeTreeWidget=function(){o.wsRoot.deepSetProp("widgetDiv",void 0),a.attachShapeTree(o.wsRoot)},a.adjust=function(){n.shapeTree.adjust()},a.openTop=function(){n.shapeTree.expand()}}(__pj__),function(t){var e=t.om,n=t.dom,r=t.jqPrototypes,o=t.set("lightbox",e.DNode.mk());o.set("template",n.newJQ({tag:"div",style:{border:"white black",position:"absolute","z-index":5e3,"background-color":"white",color:"black"}}));var i=o.template.addChild("topLine",n.newJQ({tag:"div",html:"&nbsp;",style:{width:"100%","z-indexx":2e3,"background-color":"white",color:"black",height:"30px"}}));i.addChild("content",n.newJQ({tag:"span"})),i.addChild("closeX",n.newJQ({tag:"div",html:"X",style:{padding:"3px",cursor:"pointer","background-color":"red","font-weight":"bold",border:"thin solid black","font-size":"12pt",color:"black","float":"right"}})),o.template.addChild("content",n.newJQ({tag:"div",style:{"padding-left":"30px","padding-right":"30px",overflow:"auto"}})),o.set("dialog",o.template.instantiate());var a=r.textInput.instantiate(),s=o.dialog.selectChild("content");s.addChild("inputField",a);var c=r.button.instantiate();c.html="OK",s.addChild("ok",c),o.dialog.setOkClick=function(t){this.cssSelect("#content>#ok").click=t},o.dialog.inputValue=function(){var t=this.cssSelect("#content>#inputField"),e=t.__element__;return e.prop("value")},c.click=o.dialog.okClick;var u=r.button.instantiate();u.html="Cancel",s.addChild("Cancel",u),o.shade=n.newJQ({tag:"div",style:{position:"absolute",top:"0px",left:"0px",width:"600px",height:"100px","z-index":500,opacity:.8,"background-color":"black",color:"white"}}),o.installType("Lightbox"),o.newLightbox=function(t,e,n){var r=Object.create(o.Lightbox);return r.set("shade",o.shade.instantiate()),r.set("element",n),r.set("box",e),r.closeX=n.cssSelect("#topLine>#closeX"),r.topLine=n.cssSelect("#topLine>#content"),r.content=n.selectChild("content"),r.container=t,r},o.Lightbox.setTopline=function(t){this.topLine.html(t)},o.Lightbox.dismiss=function(){var e=this.element;e.hide(),this.shade.hide(),navigator.userAgent.match("Firefox")&&t.mainPage.show(),$("body").css("background-color","rgb(238,238,238)")},o.Lightbox.pop=function(e,n){this.render();var r=$(document).width(),o=$(document).height(),i=$(window),a=i.scrollTop(),s=i.height(),c=i.width(),u=this.box,h=u.extent.x,l=Math.max((c-h)/2,50);if(n)var d=n;else d=Math.max(s-u.extent.y-50,50);var f=this.content;f.__element__.css({height:d+"px"});var p={width:h+"px",height:d+"px",top:a+35+"px",left:l+"px"},p={width:h+"px",top:a+35+"px",left:l+"px"};this.element.__element__.css(p),this.shade.__element__.css({width:r+"px",height:o+"px",top:"0px",left:"0px"}),this.iframe&&this.iframe.attr("width",this.width-25),e?this.dismiss():(navigator.userAgent.match("Firefox")?(t.mainPage.hide(),$("body").css("background-color","#444444")):this.shade.show(),this.element.show())},o.Lightbox.empty=function(){this.content.empty(),this.topLine.empty()},o.Lightbox.setHtml=function(t){var e=this.content.__element__;this.empty(),e.html(t)},o.Lightbox.setContent=function(t){var e=this.content.__element__;e.empty(),e.html(t)},o.Lightbox.installContent=function(t){var e=this.content.__element__;t.install(e)},o.Lightbox.setTextArea=function(t){var e=this.content.__element__;e.empty();var n=$('<textarea disabled="1" cols="100" rows="100"/>');n.prop("value",t),e.append(n),n.click(function(){n.select()})},o.Lightbox.afterClose=function(){this.afterCloseCallback&&this.afterCloseCallback()},o.Lightbox.addClose=function(t){var e=this;this.close=$(o.closeX),this.close.click(function(){e.dismiss(),e.afterClose(),t&&t()}),this.__element__.append(this.close)},o.Lightbox.render=function(){if(!this.element.__element){var t=this,e=this.element;this.container.width(),this.window?this.window.height():$("window").height();var n=this.shade;n.install($("body")),e.install($("body"));var t=this;this.closeX.__element__.click(function(){t.dismiss()}),e.hide(),this.shade.hide()}},o.Lightbox.popMessage=function(t,e){if(this.pop(),this.element.empty(),this.addClose(),"string"==typeof t){var n=$("<div/>");n.css({margin:"20px"}),e&&n.css({"text-align":"center"}),n.html(t)}else n=t;this.element.append(n)},o.setRect=function(t,e,n,r,o){var i=e.corner,a=e.extent,s={left:i.x+"px",top:i.y+"px",width:a.x+"px"};o||(s.height=a.y+"px"),t.css(s),n&&(n.attr("width",e.extent.x),n.attr("height",e.extent.y)),r&&(r.attr("width",e.extent.x),r.attr("height",e.extent.y))}}(__pj__),function(t){function e(){var t=.5,e=30,n=40,r=d.Point.mk(f.canvasWidth,f.canvasHeight),o=$(window).width(),i=$(window).height();if(y>o)var a=y,h=e;else if(t*y>i)var a=y,h=.5*(o-y)+e;else{var l=i/t;if(o>l)var h=.5*(o-l)+e,a=l;else var h=e,a=o}var _=t*a,g=a-2*e,C=_-n;if(v.includeDoc){var x=.8*C-20;C=.8*C;var P=i-C-30}var k=g/2,T=g/2,D=T/2,w=D-2*m;b.css({left:h+"px",width:g+"px"}),O.css({left:"0px",width:g+"px"}),j.css({top:"0px",left:k+"px",width:k+"px"}),M.css({"padding-top":"10px","padding-bottom":"20px","padding-right":"10px",left:k+"px",top:"0px"}),R.css({width:T+"px","padding-top":"10px","padding-bottom":"20px",left:"200px",top:"0px"});var S=R.__element__.outerHeight();N.css({height:S,width:g+"px",left:"0px"});var I=C-S-30;L.attr({width:k,height:I}),A.attr({width:k,height:I});var F=I-2*m;p.myWidth=w,p.obDiv.css({width:w+"px",height:F+"px",top:"0px",left:"0px"}),p.protoDiv.css({width:w+"px",height:F+"px",top:"0px",left:D+"px"}),f.canvasWidth=k,f.canvasHeight=I,s&&s.css({left:"0px",width:g+"px",top:x+"px",overflow:"auto",height:P+"px"}),c.css({left:k-50+"px"}),u.css({left:k-30+"px"});
var E=f.rootTransform();E&&!f.autoFit&&(f.adjustTransform(E,r),f.refresh())}function n(t){return'<a href="'+t+'">'+t+"</a>"}function r(){var t=f.wsRoot.__topNote__;if(t){var e=f.wsRoot.get("__saveCountForNote__");e==v.saveCount()&&D.setHtml(t)}}function o(t){if("fail"==t.status){if("collision"==t.msg)var e="An unlikely name collision took place. Please try your save again.";else if("busy"==t.msg)var e="The site is too busy to do the save. Please try again later";else if("noSession"==t.msg||"timedOut"==t.msg){var e="Your session has timed out. Please sign in again.";v.logout()}else var e="Error: "+t.msg;return e}return"ok"}function i(t){f.wsRoot.removeComputed(),f.wsRoot.deepUpdate(f.overrides),f.fitContents(),f.refresh(),"tree"!=t&&p.initShapeTreeWidget()}function a(){if(v.helpHtml)return v.helpHtml;if(v.includeDoc)var t="<p> Please see the explanations at the bottom of this  intro page first (after dismissing this lightbox).  Other topics are covered below.</p>";else var t='<p>Two panels, labeled "Workspace" and "Prototype Chain", appear on the right-hand side of the screen. The workspace panel displays the hierarchical structure of the JavaScript objects which represent the item. You can select a part of the item either by clicking on it in the graphical display, or in the workspace panel. The <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Inheritance_and_the_prototype_chain">prototype chain</a> of the selected object will be shown in rightmost panel. </p>';return v.helpHtml=t+'<p> The <b>View</b> pulldown allows you to choose which fields are displayed in the workspace and prototype browsers.  </p><p>The significance of the <b>Options</b> pulldowns is as  follows: In most applications, parts of the item are computed from a more compact description.  In auto-update mode, this computation is run every time something changes, but in manual mode, an update button appears for invoking the operation explicitly, and also a "remove computed" button, so you can see what is being recomputed.  (Many changes are seen immediately even in manual mode - those which have effect in a redraw, rather than a regeneration of the item).   ',v.helpHtml}var s,c,u,h=t.om,l=t.dom,d=t.geom,f=t.draw,p=t.tree,_=t.lightbox,v=t.page,m=10,g="white",y=1e3;v.elementsToHideOnError=[];var b;f.canvasWidth=600,f.canvasHeight=600,p.codeToSave="top";var C=t.jqPrototypes,N=l.newJQ({tag:"div",style:{position:"relative",left:"0px","background-color":g,margin:"0px",padding:"0px"}}),x=l.newJQ({tag:"div",html:"Prototype Jungle ",hoverIn:{color:"#777777"},hoverOut:{color:"black"},style:{color:"black",cursor:"pointer","float":"left",font:"bold 12pt arial"}}),P=l.newJQ({tag:"div",style:{color:"black","float":"left",font:"bold 12pt arial",width:"140px","padding-left":"60px","padding-top":"10px"}}),k=l.newJQ({tag:"div",html:"Inspector/Editor",style:{font:"10pt arial",left:"0px"}}),b=l.newJQ({tag:"div",style:{position:"absolute",margin:"0px",padding:"0px"}});b.addChild("topbar",N),N.addChild("title",P),P.addChild("maintitle",x),P.addChild("subtitle",k);var T=l.newJQ({tag:"div",html:"to Viewer",style:{font:"8pt arial",cursor:"pointer"}}),D=l.newJQ({tag:"div",style:{position:"absolute",top:"50px",left:"215px",font:"11pt arial italic",cursor:"pointer"}});N.addChild("topNote",D);var w=l.newJQ({tag:"div",style:{"text-align":"center","margin-left":"auto","margin-right":"auto","padding-bottom":"40px"}});b.addChild("error",w);var O=l.newJQ({tag:"div",style:{left:"0px",position:"relative"}});b.addChild("mainDiv",O),v.elementsToHideOnError.push(O);var S=l.newJQ({tag:"div",style:{postion:"absolute","background-color":"white",border:"solid thin green",display:"inline-block"}});O.addChild("canvasDiv",S),f.hitCanvasDebug?"50%":"100%";var L=l.newJQ({tag:"canvas",attributes:{border:"solid thin green",width:"200",height:"220"}});S.addChild("canvas",L),f.theCanvas=L;var I=C.button.instantiate();I.style.position="absolute",I.style.top="0px",I.style.left="10px",I.html="Viewer",S.addChild(I),I.click=function(){location.href=v.itemUrl},c=C.button.instantiate(),c.style.position="absolute",c.style.top="0px",c.html="+",S.addChild(c),u=C.button.instantiate(),u.style.position="absolute",u.style.top="0px",u.html="&#8722;",S.addChild(u);var A=l.newJQ({tag:"canvas",attributes:{border:"solid thin blue",width:200,height:200}});b.addChild("hitcanvas",A),f.hitCanvas=A;var j=l.newJQ({tag:"div",style:{position:"absolute","background-color":"white",margin:"0px",padding:"0px"}});O.addChild("uiDiv",j);var R=l.newJQ({tag:"div",style:{position:"absolute",margin:"0px",overflow:"none",padding:"5px",height:"20px"}});N.addChild("action",R),v.elementsToHideOnError.push(R);var M=l.newJQ({tag:"div",style:{"float":"right"}});N.addChild("ctop",M),p.obDiv=l.newJQ({tag:"div",style:{position:"absolute","background-color":"white",border:"solid thin black",overflow:"auto","vertical-align":"top",margin:"0px",padding:m+"px"}}),j.addChild("obDiv",p.obDiv);var F=l.newJQ({tag:"div",html:"Workspace",style:{"margin-bottom":"10px","border-bottom":"solid thin black"}});p.obDiv.addChild("title",F),p.obDivRest=l.newJQ({tag:"div",style:{overflow:"auto"}}),p.obDiv.addChild("rest",p.obDivRest),s=l.newJQ({tag:"iframe",attributes:{src:"chartdoc.html"},style:{border:"solid thin black",position:"absolute"}}),v.elementsToHideOnError.push(s),p.obDiv.click=function(){l.unpop()},p.protoDiv=l.newJQ({tag:"div",style:{position:"absolute","background-color":"white",margin:"0px",border:"solid thin black",overflow:"auto",padding:m+"px"}}),p.protoDivTitle=l.newJQ({tag:"div",html:"Prototype Chain",style:{"border-bottom":"solid thin black"}}),p.protoDiv.addChild("title",p.protoDivTitle),p.protoDivRest=l.newJQ({tag:"div",style:{overflow:"auto"}}),p.protoDiv.addChild("rest",p.protoDivRest),p.protoSubDiv=l.newJQ({tag:"div",style:{"background-color":"white","margin-top":"20px",border:"solid thin green",padding:"10px"}}),j.addChild("protoDiv",p.protoDiv),p.protoDiv.click=function(){l.unpop()},p.setNote=function(t,e){var n="<b>"+t+":</b> "+e;b.lightbox.pop(),b.lightbox.setHtml(n)};var E=l.newJQ({tag:"div"});E.addChild("caption",l.newJQ({tag:"div"})),E.addChild("link",l.newJQ({tag:"div"})),v.setTopNote=function(t){f.wsRoot.__topNote__=t,f.wsRoot.__saveCountForNote__=v.saveCount()+1},v.saveCount=function(){var t=f.wsRoot.__saveCount__;return"number"==typeof t?t:0},v.saveWS=function(){var t=localStorage.handle;if(!t)return b.lightbox.pop(),b.lightbox.setHtml("You must be logged in to save items. No registration is required - just use your twitter account or email address."),void 0;f.wsRoot.__beenModified__=1;var e=v.saveCount();f.wsRoot.__saveCount__=e+1,f.wsRoot.set("__canvasDimensions__",d.Point.mk(f.canvasWidth,f.canvasHeight));var n=f.wsRoot.computePaths(),r=n.host+"/"+localStorage.handle+"/"+"variant"+n.path+"/",i=h.randomName(),a="Save as <br/>"+r+"<input id='saveAs' type='text' style='width:200px' value='"+i+"'></input>";a+='<p><div class="button" id="saveButton">Save</div><div class="button" id="cancelButton">Cancel</div></p>',a+='<p id="lbError" class="error"></p>',b.lightbox.pop(),b.lightbox.setHtml(a),$("#cancelButton").click(function(){b.lightbox.dismiss()}),$("#saveButton").click(function(){var t=$("#saveAs").prop("value");if(!h.checkName(t))return $("#lbError").html("Error: the last part of the path must contain only letters, numerals, or the underbar, and may not start with a numeral."),void 0;var n=r+t,i=h.unpackUrl(n,!0);h.s3Save(f.wsRoot,i,function(t){f.wsRoot.__saveCount__=e,b.lightbox.pop();var n=o(t);if("ok"==n)var r=h.mkLinks(i,"saved");else r=n;b.lightbox.setHtml(r)},!0)})};var B=C.button.instantiate();B.html="Save",R.addChild("save",B),B.click=v.saveWS,v.saveImage=function(){var t=localStorage.handle;if(!t)return b.lightbox.pop(),b.lightbox.setHtml("You must be logged in to save images. No registration is required - just use your twitter account or email address."),void 0;var e=h.parseQuerystring(),r=e.item,i=h.unpackUrl(r),a=i.image,t=localStorage.handle;if(t==i.handle)var s="/"+t+a;else f.wsRoot.__autonamed__&&(i=h.unpackUrl(r,1)),s="/"+t+i.path+"/"+h.randomName()+".jpg";f.postCanvas(s,function(t){b.lightbox.pop();var e=o(t);if("ok"==e)var r=i.host+s,a="<div>The image has been stored at "+n(r)+"</div>";else a=e;b.lightbox.setHtml(a)})};var J=C.button.instantiate();J.html="Save Image",R.addChild("saveImage",J),J.click=v.saveImage;var W=C.button.instantiate();W.html="View...",R.addChild("view",W);var z=l.Select.mk();z.containerP=C.pulldown,z.optionP=C.pulldownEntry,z.options=["Only editable fields","All fields except functions","All fields, including functions"],z.optionIds=["editable","notFunctions","all"],z.onSelect=function(t){0==t?(p.onlyShowEditable=!0,p.showFunctions=!1):1==t?(p.onlyShowEditable=!1,p.showFunctions=!1):(p.onlyShowEditable=!1,p.showFunctions=!0),p.initShapeTreeWidget(),p.refreshProtoChain()},z.selected=1,p.onlyShowEditable=!1,p.showFunctions=!1;var Q=z.toJQ();v.vv=Q,b.addChild(Q),Q.hide(),v.popViews=function(){if(v.viewsPopped)return Q.hide(),v.viewsPopped=0,void 0;var t=b.offset(),e=W.height(),n=W.offset(),r=n.left-t.left,o=n.top-t.top;Q.css({display:"block",left:r+"px",top:o+e+"px"}),v.viewsPopped=1},v.hideViewsSel=function(){Q.hide()},W.click=function(){l.popFromButton("views",W,Q)};var H=C.button.instantiate();H.html="Options...",R.addChild("options",H);var U=l.Select.mk();U.containerP=C.pulldown,U.optionP=C.pulldownEntry,U.options=["Auto update","Manual update"],U.optionIds=["auto","manual"],U.onSelect=function(t){0==t?(p.autoUpdate=1,q.hide(),Z.hide()):1==t&&(p.autoUpdate=0,q.show(),Z.show())},p.autoUpdate=1,v.alert=function(t){b.lightbox.pop(),b.lightbox.setHtml(t)},U.selected=0;var G=U.toJQ();b.addChild(G),G.hide(),H.click=function(){l.popFromButton("options",H,G)};var q=C.button.instantiate();q.html="Update",R.addChild("update",q),q.click=function(){l.unpop(),i()},p.updateAndShow=i;var Z=C.button.instantiate();Z.html="Remove Computed",R.addChild("contract",Z),Z.click=function(){l.unpop(),f.wsRoot.removeComputed(),p.initShapeTreeWidget(),f.refresh()};var V=C.button.instantiate();V.html="About",R.addChild("about",V),V.click=function(){l.unpop();var t=f.wsRoot;b.lightbox.pop();var e=t.__about__,n='<p>The general <i>about</i> page for Prototype Jungle is <a href="http://prototypejungle.org/about.html">here</a>. This note concerns the current item.</p>',r=t.__source__;r&&(n+="<p>Source code: "+h.mkLink(r),t.__beenModified__&&(n+=" with subsequent modifications",n+="</p>")),t.__source__,e&&(n+="<div>"+e+"</div>"),b.lightbox.setHtml(n)};var X=C.button.instantiate();X.html="Help",R.addChild("help",X),X.click=function(){l.unpop(),b.lightbox.pop(),b.lightbox.setHtml(a())},x.click=function(){location.href="/"},T.click=function(){location.href=v.itemUrl},v.genMainPage=function(n){if(!t.mainPage){t.set("mainPage",b),v.includeDoc&&b.addChild("doc",s),b.install($("body")),c.__element__.mousedown(f.startZooming),c.__element__.mouseup(f.stopZooming),c.__element__.mouseleave(f.stopZooming),u.__element__.mousedown(f.startUnZooming),u.__element__.mouseup(f.stopZooming),u.__element__.mouseleave(f.stopZooming);var r=U.jq.__element__;r.mouseleave(function(){l.unpop()}),z.jq.__element__.mouseleave(function(){l.unpop()}),v.genButtons(M.__element__,{toExclude:"about"}),q.hide(),Z.hide(),f.theContext=f.theCanvas.__element__[0].getContext("2d"),f.hitCanvasEnabled?f.hitContext=f.hitCanvas.__element__[0].getContext("2d"):f.hitCanvasActive=0,$("body").css({"background-color":"#eeeeee"}),b.css({"background-color":"#444444","z-index":200}),e();var o=d.Rectangle.mk({corner:[0,0],extent:[700,200]}),o=d.Rectangle.mk({corner:[0,0],extent:[700,200]}),i=_.newLightbox($("body"),o,t.lightbox.template.instantiate());b.set("lightbox",i),n()}},v.initPage=function(n){var o=n.name,i=n.screen,a=n.wsSource;v.itemUrl=a;var s=n.noInst;a&&(0==a.indexOf("http:")||0==a.indexOf("https:"));var c=n.instantiate,u=n.callback;$("document").ready(function(){$("body").css({"background-color":"white",color:"black"}),h.disableBackspace(),v.genMainPage(function(){function n(t){var e=t.__overrides__;return e||(e={}),e&&delete t.__overrides__,e}function l(e){var o=e.length;if(o>0){var i=e[o-1];c=!i.__autonamed__&&!s;var a=n(i),l=t.set("ws",h.DNode.mk());if(c)var d=i.instantiate();else d=i;l.set(i.__name__,d),f.wsRoot=d,r(),f.overrides=a,d.deepUpdate(a);var _=d.backgroundColor;_||(d.backgroundColor="white"),h.loadTheDataSources([d],function(){f.wsRoot.deepUpdate(a),p.initShapeTreeWidget();var t=f.wsRoot.transform;if(t){var e=f.wsRoot.__canvasDimensions__;e&&f.adjustTransform(f.rootTransform(),e)}else t=f.fitTransform(f.wsRoot),f.wsRoot.set("transform",t);f.refresh(),p.openTop(),u&&u()})}}return f.init(),a?(o?(f.emptyWs(o,i),l()):(h.pathLast(a),h.install(a,l)),$(window).resize(function(){e(),f.fitContents(),f.refresh()}),void 0):(v.genError("<span class='errorTitle'>Error:</span> no item specified (ie no ?item=... )"),void 0)})})}}(__pj__),function(t){t.om;var e=t.page;e.genError=function(t){e.errorOccurred||(e.genTopbar($("#topbar"),{includeTitle:1}),e.elementsToHideOnError.forEach(function(t){t.hide()}),e.errorOccurred=1,$("#error").show(),$("#error").html(t))}}(__pj__),"undefined"==typeof __pj__)var __pj__={};!function(t){var e=t.om,n=t.page;n.genButtons=function(t,r){function o(e,n){var r=$('<div class="button">'+e+"</div>");return t.append(r),r.click(function(){location.href=n}),r}if(toExclude=r.toExclude,o("GitHub","https://github.com/chrisGoad/prototypejungle"),"build"!=toExclude&&o("Build","/build"),"tech"!=toExclude&&o("Tech Docs","/tech"),"about"!=toExclude&&o("About","/about"),"sign_in"!=toExclude){n.logoutButton=o("logout","/logout"),n.signInButton=o("Sign in","/sign_in");var i=e.storage?e.storage.sessionId:null;i?n.signInButton.hide():n.logoutButton.hide()}},n.genTopbar=function(t,e){t.empty(),t.append($('<div id="topbarOuter" style="padding-bottom:30px"><div id = "topbarInner" style="float:right;"></div>'));var r=$("#topbarInner");e.includeTitle&&n.genMainTitle($("#topbarOuter"),"Prototype Jungle"),n.genButtons(r,e)},n.genMainTitle=function(t,e){var n=$('<span class="mainTitle">'+e+"</span>");n.css({cursor:"pointer"}),t.append(n),n.click(function(){location.href="/"})},n.logout=function(){e.log("util","page.logout"),n.logoutButton.hide(),n.signInButton.show(),e.clearStorageOnLogout()}}(__pj__);