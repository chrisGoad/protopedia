<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PrototypeJungle</title>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<link rel="stylesheet" type="text/css"  href="/style.css"/> 
<body>

<script src="http://{{domain}}/js/pjloginout-{{pjloginout_version}}.js"></script>


<script>
// This is where twitter redirects after the user has authorized PrototypeJungle
var drs;// for debugging
(function () {
    var qs = om.parseQuerystring();
    var denied = qs.denied;
    if (denied) {
      location.href = "/denied";

      return;
    }
    var tokenForComparison = qs.oauth_token; // just for checking
    var tkj = localStorage.twitterToken;
    var tk = JSON.parse(tkj);
    tk.verifier =  qs.oauth_verifier;
    var url = "/api/setTwitterToken";
    if (localStorage.signingInWithTwitter) {
      tk.signingIn = 1;
    }
    var data = JSON.stringify(tk);
    
    om.ajaxPost(url,data,function (rs) {
      if (rs.status== "ok") {
        var vl = rs.value;
        if (vl.accepted_terms || 1) {
          localStorage.sessionId = vl.sessionId;
          localStorage.userName = vl.userName
          var newu = vl.new_user;
          if (newu) {
            location.href = '/handle'
          } else {
            localStorage.handle = vl.handle;
            location.href = om.homePage+"#signedIn=1&handle="+localStorage.handle
          }
          return;
        }
      } else {
        alert("Twitter sign in failure")
      }

    });
  })();
 
</script>
<div id="outerContainer"> 
  <div id="topbarOuter" style="padding-bottom:30px"><span class="mainTitle">Prototype Jungle</span>
        <div id = "topbarInner" style="float:right"></div>
   </div>
  <div id="error"></div>
  <div id="mainDiv">
    <b>You are now logged out.</b>
    <div style="width:100%;text-align:center">Redirecting ...</div>
  </div>
  <div id="results"></div>
</div>
</body>
</html>

  

