{{boilerplate}}

<script>
var newUsersAllowed = true;

pj.fb.initFirebase();
var auth = firebase.auth;

var setHandler = function (id,fn) {
		var element = document.getElementById(id);
    if (element) {
      element.addEventListener('click',fn);
		}
}


var message;
var signIn = function  (provider) {
  message.innerHTML  = '';
  purl = sessionStorage.getItem('preSigninUrl');
	dest = purl?purl:"/edit.html";
	var purl,dest;
	var au = auth();
  au.signInWithPopup(provider).then(function(result) {
    var uid = result.user.uid;
    pj.fb.getAccount(uid,function (err,account) {
      if (account) {
 	      location.href = dest;
      } else {
        location.href = "/account.html?new=1"
        // new user
        /*if (newUsersAllowed) {
          pj.fb.setAccountValue(uid,'x','x',function (err,val) {// create on account record (need something in it, hence x x)
            location.href = dest;
          });
        } else {
          au.signOut().then(function () {
            location.href = '/signupsDisabled.html'
          });
        }*/
      }
    });
  }).catch(function(error) {
    console.log('error signing in ',error);
    message.innerHTML = 'Sign in failed: '+error.message;
  });
}

function twitter_sign_in() {
	signIn(new auth.TwitterAuthProvider());
}

function google_sign_in() {
  	signIn(new auth.GoogleAuthProvider());
}

function facebook_sign_in() {
  	signIn(new auth.FacebookAuthProvider());
}

function github_sign_in() {
  	signIn(new auth.GithubAuthProvider());
}
var edgeCantSignIn = false;

pj.ready(function () {
  var badBrowserMessage = document.getElementById('badBrowser');
  var mainDiv = document.getElementById('mainDiv');
  var browser = pj.browser();
  if (edgeCantSignIn && (browser.browser === 'Edge')) {
    badBrowserMessage.style.display = 'block';
    mainDiv.style.display = 'none';
  }
  message = document.getElementById('message');
	setHandler('google',google_sign_in);
	setHandler('twitter',twitter_sign_in);
	setHandler('facebook',facebook_sign_in);
	setHandler('github',github_sign_in);
	pj.fb.setCurrentUser(function () {
		if (pj.fb.currentUser) {
      message.innerHTML = 'You are signed in';
    }
	})
});
</script>
<div id="badBrowser" style="display:none;padding:20px"> There is currently a problem for the Microsoft Edge browser with the Firebase sign-in system (which we use).
Please try again with another browser. Firefox, Chrome, Opera, and Safari all
support sign-ins. </div>
<div id="mainDiv">
<div>Sign in with: </div>
<div id='google' style="margin-top:20px" class='sign_in'>
<img  src="/images/sign_in_google.svg"/> <!--from https://www.gstatic.com/mobilesdk/160512_mobilesdk/auth_service_google.svg-->
<span>Google</span>
</div>
<div id='twitter' class='sign_in'>
<img  src="/images/sign_in_twitter.svg"/> <!--from https://www.gstatic.com/mobilesdk/160512_mobilesdk/auth_service_twitter.svg-->
<span>Twitter</span>
</div>
<div id='facebook' class='sign_in'>
<img  src="/images/sign_in_facebook.svg"/> <!--from https://www.gstatic.com/mobilesdk/160512_mobilesdk/auth_service_facebook.svg-->
<span>Facebook</span>
</div>
<div id='github' class='sign_in'>
<img  src="/images/sign_in_github.svg">
<span>Github</span>
</div>
<div id="message" style="padding-top:20px"></div>
</div>
{{endplate}}
